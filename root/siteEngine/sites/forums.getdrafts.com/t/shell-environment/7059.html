<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Shell environment - Scripting - Drafts Community</title>
    <meta name="description" content="I’ve done some experimenting with shell scripting in Drafts 19 and have run into a problem. This is long because I don’t want to leave out details that might be important. 
First, scripts run through the ShellScript.crea&amp;hellip;">
    <meta name="generator" content="Discourse 2.9.0.beta4 - https://github.com/discourse/discourse version f0d46c35493f4d01e4c1f9a3b32f867c1ade595e">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/25837d707e58349c1c1881afc1883055a203ac28_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/7/77d737820f07fbb0e980560a8c341a18432a7d92_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="7059.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.getdrafts.com","potentialAction":{"@type":"SearchAction","target":"https://forums.getdrafts.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Drafts Community Search">

    <link href="https://forums.getdrafts.com/stylesheets/color_definitions_base__2_3d1df61a71325940d683ff0221fd14dee6a802e5.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" class="light-scheme"/><link href="https://forums.getdrafts.com/stylesheets/color_definitions_simple-dark_1_2_ce13c571d5f0d2fac2c7d8164bf57e59bd0aa89f.css?__ws=forums.getdrafts.com" media="(prefers-color-scheme: dark)" rel="stylesheet" class="dark-scheme"/>

  <link href="https://forums.getdrafts.com/stylesheets/desktop_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="desktop"  />


  <link href="https://forums.getdrafts.com/stylesheets/discourse-details_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="discourse-details"  />
  <link href="https://forums.getdrafts.com/stylesheets/discourse-local-dates_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
  <link href="https://forums.getdrafts.com/stylesheets/discourse-narrative-bot_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
  <link href="https://forums.getdrafts.com/stylesheets/discourse-presence_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="discourse-presence"  />
  <link href="https://forums.getdrafts.com/stylesheets/lazy-yt_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="lazy-yt"  />
  <link href="https://forums.getdrafts.com/stylesheets/poll_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="poll"  />
  <link href="https://forums.getdrafts.com/stylesheets/poll_desktop_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://forums.getdrafts.com/stylesheets/desktop_theme_2_8a6535adb5ffcb37b246b8087d7136cfbc597ca9.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2" data-theme-name="default"/>

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Shell environment&#39;" href="https://forums.getdrafts.com/t/shell-environment/7059.rss" />
    <meta property="og:site_name" content="Drafts Community" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.getdrafts.com/uploads/default/original/2X/8/8028b40b2b5c46fe6a21aa3e1b9480b911b845df.png" />
<meta property="og:image" content="https://forums.getdrafts.com/uploads/default/original/2X/8/8028b40b2b5c46fe6a21aa3e1b9480b911b845df.png" />
<meta property="og:url" content="https://forums.getdrafts.com/t/shell-environment/7059" />
<meta name="twitter:url" content="https://forums.getdrafts.com/t/shell-environment/7059" />
<meta property="og:title" content="Shell environment" />
<meta name="twitter:title" content="Shell environment" />
<meta property="og:description" content="I’ve done some experimenting with shell scripting in Drafts 19 and have run into a problem. This is long because I don’t want to leave out details that might be important.  First, scripts run through the ShellScript.create and execute system described in the docs run in an non-interactive shell, which means they have a very restricted PATH, just  /usr/bin:/bin:/usr/sbin:/sbin  So if you want to use a Perl, Python, or Ruby that’s more advanced than what comes with macOS (the stock Python, for exa..." />
<meta name="twitter:description" content="I’ve done some experimenting with shell scripting in Drafts 19 and have run into a problem. This is long because I don’t want to leave out details that might be important.  First, scripts run through the ShellScript.create and execute system described in the docs run in an non-interactive shell, which means they have a very restricted PATH, just  /usr/bin:/bin:/usr/sbin:/sbin  So if you want to use a Perl, Python, or Ruby that’s more advanced than what comes with macOS (the stock Python, for exa..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="1 ❤" />
<meta property="article:published_time" content="2020-04-03T14:15:58+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
    <header>
  <a href="https://forums.getdrafts.com/">
    <h1>Drafts Community</h1>
  </a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="7059.html">Shell environment</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://forums.getdrafts.com/c/scripting/13" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #AB9364'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Scripting</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div id='post_1' itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Agile Tortoise, Inc.'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forums.getdrafts.com/uploads/default/original/2X/8/8ed1af80ec826f0860aad768f711c6b1b0fb32b4.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forums.getdrafts.com/u/drdrang'><span itemprop='name'>drdrang</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7059.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-04-03T14:15:58Z' class='post-time'>
                April 3, 2020,  2:15pm
              </time>
              <meta itemprop='dateModified' content='2020-04-03T14:15:58Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I’ve done some experimenting with shell scripting in Drafts 19 and have run into a problem. This is long because I don’t want to leave out details that might be important.</p>
<p>First, scripts run through the <code>ShellScript.create</code> and <code>execute</code> system described in <a href="../../../scripting.getdrafts.com/classes/shellscript.html" rel="nofollow noopener">the docs</a> run in an non-interactive shell, which means they have a very restricted <code>PATH</code>, just</p>
<pre><code class="lang-auto">/usr/bin:/bin:/usr/sbin:/sbin
</code></pre>
<p>So if you want to use a Perl, Python, or Ruby that’s more advanced than what comes with macOS (the stock Python, for example, is years out of date), you can’t simply start your script with a line like</p>
<pre><code class="lang-auto">#!/usr/bin/env ruby
</code></pre>
<p>as Greg does in the example in the docs, because <code>env</code> won’t see where you have the newer version of Ruby.</p>
<p>There are several ways to get around this, with varying degrees of flexibility. A method I’ve used is to give <code>env</code> a new <code>PATH</code>:</p>
<pre><code class="lang-auto">#!/usr/bin/env -S -P${HOME}/anaconda/bin:${HOME}/opt/anaconda3/bin:/usr/local/bin:${PATH} python
</code></pre>
<p>For me, this has two advantages:</p>
<ol>
<li>By using the <code>HOME</code> environment variable, it will start by looking in the user’s home directory without needing to know what the username is. This helps if you have two computers with different usernames and if you’re sharing a script with someone else.</li>
<li>By giving a new, multidirectory <code>PATH</code> to search, you can account for differing installations across machines.</li>
</ol>
<p>Unfortunately, when I’ve tried this in a single-step action using this script,</p>
<pre><code class="lang-auto">let script = `#!/usr/bin/env -S -P${HOME}/anaconda/bin:${HOME}/opt/anaconda3/bin:/usr/local/bin:${PATH} python
import sys
print('.'.join(str(x) for x in sys.version_info[:3]))`

let runner = ShellScript.create(script);
runner.execute();
alert(runner.standardOutput);
</code></pre>
<p>I get this error:</p>
<blockquote>
<p>Script Error: ReferenceError: Can’t find variable: HOME<br>
Line number: 1, Column 41</p>
</blockquote>
<p>This suggests that the <code>HOME</code> environment variable isn’t set, but if I run this script</p>
<pre><code class="lang-auto">let script = `#!/bin/bash
echo $HOME`;

let runner = ShellScript.create(script);
runner.execute();
alert(runner.standardOutput);
</code></pre>
<p>it gives the right answer, which means <code>HOME</code> <em>is</em> set.</p>
<p>Anyway, the shebang line I’m using here for Python is one that works in Keyboard Maestro, which is the closest analog to Drafts I can think of. There are definitely ways I can get around this problem, but it does seem wrong that it isn’t working the way I expect it to. Maybe there’s a difference between running <code>env</code> directly and running it by way of JavaScript?</p>
        </div>

        <meta itemprop='headline' content='Shell environment'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                    <a href="https://forums.getdrafts.com/t/drafts-19-macos-released-quick-search-applescript/7045/7" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='https://forums.getdrafts.com/t/drafts-19-macos-released-quick-search-applescript/7045/7'>
                      <span itemprop='name'>Drafts 19 (macOS) Released - Quick Search, AppleScript</span>
                    </a>
                    <meta itemprop='position' content='2'>
                  </div>
            </div>
      </div>
      <div id='post_2' itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Agile Tortoise, Inc.'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forums.getdrafts.com/uploads/default/original/2X/8/8ed1af80ec826f0860aad768f711c6b1b0fb32b4.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forums.getdrafts.com/u/agiletortoise'><span itemprop='name'>agiletortoise</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7059.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-04-03T15:55:51Z' class='post-time'>
                April 3, 2020,  3:55pm
              </time>
              <meta itemprop='dateModified' content='2020-04-03T15:55:51Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I expect there are aspects of this related to being Sandboxed (which Keyboard Maestro is not, I assume). Documentation for NSUserUnixScript is a bit scant. It was added specifically to support running a script outside the Sandboxed process in user space, but it does not really go into how it creates the environment used…and it does not support, as best as I’ve been able to ascertain, modifying the environment prior to execution.</p>
<p>I can get your result to work if setup the environment in bash and then run the python, like:</p>
<pre><code class="lang-javascript">let script = `#!/bin/bash
export PATH=/b/foo:$PATH
python -c "import sys;print('.'.join(str(x) for x in sys.version_info[:3]))"
`;
let runner = ShellScript.create(script);

if (runner.execute(["1", "2"])) {
	alert("STDOUT:\n" + runner.standardOutput);
}
else {
	alert("STDERR:\n" + runner.standardError);
}
</code></pre>
<p>I think the basic environment is the same or similar to what you would get using <code>do shell script</code> in AppleScript, which is also not loading in any bash_profile info, etc.</p>
        </div>

        <meta itemprop='headline' content='Shell environment'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                    <a href="https://forums.getdrafts.com/t/is-there-anyway-to-format-the-markdown/7850/5" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='https://forums.getdrafts.com/t/is-there-anyway-to-format-the-markdown/7850/5'>
                      <span itemprop='name'>Is there anyway to format the markdown?</span>
                    </a>
                    <meta itemprop='position' content='1'>
                  </div>
            </div>
      </div>
      <div id='post_3' itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Agile Tortoise, Inc.'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forums.getdrafts.com/uploads/default/original/2X/8/8ed1af80ec826f0860aad768f711c6b1b0fb32b4.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forums.getdrafts.com/u/drdrang'><span itemprop='name'>drdrang</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="7059.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-04-03T16:06:14Z' class='post-time'>
                April 3, 2020,  4:06pm
              </time>
              <meta itemprop='dateModified' content='2020-04-03T16:06:14Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Thanks! The sandboxing explanation makes sense. And I can handle different usernames by having that defined in a JavaScript variable at the beginning of the script and then interpolating it into the shebang line.</p>
        </div>

        <meta itemprop='headline' content='Shell environment'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forums.getdrafts.com/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forums.getdrafts.com/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forums.getdrafts.com/guidelines' itemprop="url">FAQ/Guidelines </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forums.getdrafts.com/tos' itemprop="url">Terms of Service </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forums.getdrafts.com/privacy' itemprop="url">Privacy Policy </a>
        </span>
      </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
