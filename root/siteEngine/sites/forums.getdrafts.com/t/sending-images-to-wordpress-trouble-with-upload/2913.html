<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Sending Images to Wordpress – Trouble With Upload - Actions - Help &amp; Questions - Drafts Community</title>
    <meta name="description" content="I was hoping someone here could help me with a bit of a round-about way I’m utilizing Drafts to (hopefully) upload an image to Wordpress. I think my issue might lie in a slight misunderstanding of what exactly the Wordpr&amp;hellip;">
    <meta name="generator" content="Discourse 2.9.0.beta4 - https://github.com/discourse/discourse version f0d46c35493f4d01e4c1f9a3b32f867c1ade595e">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/25837d707e58349c1c1881afc1883055a203ac28_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/7/77d737820f07fbb0e980560a8c341a18432a7d92_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="2913.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.getdrafts.com","potentialAction":{"@type":"SearchAction","target":"https://forums.getdrafts.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Drafts Community Search">

    <link href="https://forums.getdrafts.com/stylesheets/color_definitions_base__2_3d1df61a71325940d683ff0221fd14dee6a802e5.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" class="light-scheme"/><link href="https://forums.getdrafts.com/stylesheets/color_definitions_simple-dark_1_2_ce13c571d5f0d2fac2c7d8164bf57e59bd0aa89f.css?__ws=forums.getdrafts.com" media="(prefers-color-scheme: dark)" rel="stylesheet" class="dark-scheme"/>

  <link href="https://forums.getdrafts.com/stylesheets/desktop_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="desktop"  />


  <link href="https://forums.getdrafts.com/stylesheets/discourse-details_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="discourse-details"  />
  <link href="https://forums.getdrafts.com/stylesheets/discourse-local-dates_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
  <link href="https://forums.getdrafts.com/stylesheets/discourse-narrative-bot_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
  <link href="https://forums.getdrafts.com/stylesheets/discourse-presence_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="discourse-presence"  />
  <link href="https://forums.getdrafts.com/stylesheets/lazy-yt_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="lazy-yt"  />
  <link href="https://forums.getdrafts.com/stylesheets/poll_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="poll"  />
  <link href="https://forums.getdrafts.com/stylesheets/poll_desktop_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://forums.getdrafts.com/stylesheets/desktop_theme_2_8a6535adb5ffcb37b246b8087d7136cfbc597ca9.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2" data-theme-name="default"/>

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Sending Images to Wordpress – Trouble With Upload&#39;" href="2913.rss" />
    <meta property="og:site_name" content="Drafts Community" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://forums.getdrafts.com/uploads/default/original/2X/8/8028b40b2b5c46fe6a21aa3e1b9480b911b845df.png" />
<meta property="og:image" content="https://forums.getdrafts.com/uploads/default/original/2X/8/8028b40b2b5c46fe6a21aa3e1b9480b911b845df.png" />
<meta property="og:url" content="https://forums.getdrafts.com/t/sending-images-to-wordpress-trouble-with-upload/2913" />
<meta name="twitter:url" content="https://forums.getdrafts.com/t/sending-images-to-wordpress-trouble-with-upload/2913" />
<meta property="og:title" content="Sending Images to Wordpress – Trouble With Upload" />
<meta name="twitter:title" content="Sending Images to Wordpress – Trouble With Upload" />
<meta property="og:description" content="I was hoping someone here could help me with a bit of a round-about way I’m utilizing Drafts to (hopefully) upload an image to Wordpress. I think my issue might lie in a slight misunderstanding of what exactly the Wordpress XML-RPC expects when receiving a file.  So, the general workflow is this. The action is triggered and it immediately switches over to Shortcuts and runs a shortcut I’ve built to get the image and related information. Shortcuts passes a dictionary back to Drafts of format:  sh..." />
<meta name="twitter:description" content="I was hoping someone here could help me with a bit of a round-about way I’m utilizing Drafts to (hopefully) upload an image to Wordpress. I think my issue might lie in a slight misunderstanding of what exactly the Wordpress XML-RPC expects when receiving a file.  So, the general workflow is this. The action is triggered and it immediately switches over to Shortcuts and runs a shortcut I’ve built to get the image and related information. Shortcuts passes a dictionary back to Drafts of format:  sh..." />
<meta property="article:published_time" content="2018-10-22T17:58:16+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
    <header>
  <a href="https://forums.getdrafts.com/">
    <h1>Drafts Community</h1>
  </a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="2913.html">Sending Images to Wordpress – Trouble With Upload</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/actions.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #652D90'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Actions - Help &amp; Questions</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/wordpress.html' class='discourse-tag' rel="tag">wordpress</a>
        </div>
      </div>
  </div>

  


      <div id='post_1' itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Agile Tortoise, Inc.'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forums.getdrafts.com/uploads/default/original/2X/8/8ed1af80ec826f0860aad768f711c6b1b0fb32b4.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forums.getdrafts.com/u/buffaloseven'><span itemprop='name'>buffaloseven</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="2913.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-10-22T17:58:16Z' class='post-time'>
                October 22, 2018,  5:58pm
              </time>
              <meta itemprop='dateModified' content='2018-10-22T17:58:16Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I was hoping someone here could help me with a bit of a round-about way I’m utilizing Drafts to (hopefully) upload an image to Wordpress. I think my issue might lie in a slight misunderstanding of what exactly the Wordpress XML-RPC expects when receiving a file.</p>
<p>So, the general workflow is this. The action is triggered and it immediately switches over to Shortcuts and runs a shortcut I’ve built to get the image and related information. Shortcuts passes a dictionary back to Drafts of format:</p>
<pre><code class="lang-auto">shortcut_result = {
	string alt,
	string data,
	string name,
	string title,
	string type
}
</code></pre>
<p>Most of this is just metadata for the image. Key to this particular issue is that in the workflow, I let the user pick a photo, then I convert it to <code>base64</code> and store it in the <code>shortcut_result.data</code> dictionary entry as a string.</p>
<p>In Drafts, after setting up the credentials, I then construct the following request to send to Wordpress:</p>
<pre><code class="lang-auto">let the_image = JSON.parse(draft.getTemplateTag("shortcut_result"));
let method = "wp.uploadFile";
let params = [
	1,
	cred.getValue("username"),
	cred.getValue("password"),
	{
		bits: the_image.data,
		name: the_image.name + "." + the_image.type,
		type: MIMEtypes[the_image.type]
	}
];
</code></pre>
<p>While this successfully posts, the image file created on the server is corrupted and won’t display. I also tried adding polyfills into the script for <code>atob()</code> and <code>btoa()</code> support, which didn’t seem to work the way I tried. Lastly, I stole the <code>Base64</code> constructor from a Javascript XML-RPC library, converted the base64 back to binary to pass into the Base64 constructor, and then tried sending the object:</p>
<pre><code class="lang-auto">var Base64 = {
	binary bits,
	func encode,
	func decode
}
</code></pre>
<p>This didn’t work, nor did sending <code>Base64.encode()</code>.</p>
<p>I really think I’m just missing something on how to package the binary data for Wordpress to properly ingest. MIME types are correct, and if I paste the <code>base64</code> data Shortcuts returns into a <code>base64 → image</code> decoder the images appear properly, so it’s all in how I’m sending the data to Wordpress.</p>
<p>Anybody have any advice? Is there something with Drafts’ WordPress class I could be missing that is causing the problem? Some other way I could package the <code>base64</code> data?</p>
        </div>

        <meta itemprop='headline' content='Sending Images to Wordpress – Trouble With Upload'>
          <meta itemprop='keywords' content='wordpress'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div id='post_2' itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Agile Tortoise, Inc.'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forums.getdrafts.com/uploads/default/original/2X/8/8ed1af80ec826f0860aad768f711c6b1b0fb32b4.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forums.getdrafts.com/u/agiletortoise'><span itemprop='name'>agiletortoise</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="2913.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-10-22T21:16:34Z' class='post-time'>
                October 22, 2018,  9:16pm
              </time>
              <meta itemprop='dateModified' content='2018-10-22T21:16:34Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Just briefly looking at this, but based on a few Stack Overflow posts, it seems Wordpress is looking for the base64 string to be wrapped in <code>&lt;base64&gt;</code> tags…they have a class <a href="https://developer.wordpress.org/reference/classes/ixr_base64/">IXR_Base64</a> that just wraps it like that and is what they are looking for…</p>
<p>Untested, but maybe try:</p>
<pre><code class="lang-javascript">let params = [
	1,
	cred.getValue("username"),
	cred.getValue("password"),
	{
		bits: "&lt;base64&gt;" + the_image.data + "&lt;/base64&gt;",
		name: the_image.name + "." + the_image.type,
		type: MIMEtypes[the_image.type]
	}
];
</code></pre>
        </div>

        <meta itemprop='headline' content='Sending Images to Wordpress – Trouble With Upload'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div id='post_3' itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Agile Tortoise, Inc.'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forums.getdrafts.com/uploads/default/original/2X/8/8ed1af80ec826f0860aad768f711c6b1b0fb32b4.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forums.getdrafts.com/u/buffaloseven'><span itemprop='name'>buffaloseven</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="2913.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2018-10-22T22:14:25Z' class='post-time'>
                October 22, 2018, 10:14pm
              </time>
              <meta itemprop='dateModified' content='2018-10-22T22:16:29Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Gave it a try and no go :-/</p>
<p>Here’s the image Wordpress produced: <a href="https://www.aweathermoment.com/wordpress/wp-content/uploads/2018/10/img_4672.png" rel="nofollow noopener">https://www.aweathermoment.com/wordpress/wp-content/uploads/2018/10/img_4672.png</a></p>
<p>Maybe someone smarter in this than I can see what’s gone wrong.</p>
<p>The WP call in Drafts successfully executes, though. So that’s good?</p>
<p>My hope is doing it via scripting so that I can get the Post ID after the upload, then edit the post to add the various metadata (title, alt text, caption, etc.) within the Wordpress installation. After that’s the easy part of inserting a formatted markdown image link.</p>
<p>Edit: I’m a little curious if the problem could be rooted in a string encoding problem or something like that? Does Drafts do any encoding manipulation on what’s returned from Shortcuts?</p>
        </div>

        <meta itemprop='headline' content='Sending Images to Wordpress – Trouble With Upload'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forums.getdrafts.com/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forums.getdrafts.com/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forums.getdrafts.com/guidelines' itemprop="url">FAQ/Guidelines </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forums.getdrafts.com/tos' itemprop="url">Terms of Service </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forums.getdrafts.com/privacy' itemprop="url">Privacy Policy </a>
        </span>
      </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
