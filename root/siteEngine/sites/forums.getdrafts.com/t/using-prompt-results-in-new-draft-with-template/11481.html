<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Using prompt results in New Draft with Template - Actions - Help &amp; Questions - Drafts Community</title>
    <meta name="description" content="Hi. I’m having trouble combining prompts with a modified version of New Draft with Template. 
My goal is to have a single template file in Drafts; run an action, fill in two text prompts (project name and project descrip&amp;hellip;">
    <meta name="generator" content="Discourse 2.9.0.beta4 - https://github.com/discourse/discourse version f0d46c35493f4d01e4c1f9a3b32f867c1ade595e">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/25837d707e58349c1c1881afc1883055a203ac28_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/7/77d737820f07fbb0e980560a8c341a18432a7d92_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="11481.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forums.getdrafts.com","potentialAction":{"@type":"SearchAction","target":"https://forums.getdrafts.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="Drafts Community Search">

    <link href="https://forums.getdrafts.com/stylesheets/color_definitions_base__2_3d1df61a71325940d683ff0221fd14dee6a802e5.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" class="light-scheme"/><link href="https://forums.getdrafts.com/stylesheets/color_definitions_simple-dark_1_2_ce13c571d5f0d2fac2c7d8164bf57e59bd0aa89f.css?__ws=forums.getdrafts.com" media="(prefers-color-scheme: dark)" rel="stylesheet" class="dark-scheme"/>

  <link href="https://forums.getdrafts.com/stylesheets/desktop_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="desktop"  />


  <link href="https://forums.getdrafts.com/stylesheets/discourse-details_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="discourse-details"  />
  <link href="https://forums.getdrafts.com/stylesheets/discourse-local-dates_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="discourse-local-dates"  />
  <link href="https://forums.getdrafts.com/stylesheets/discourse-narrative-bot_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="discourse-narrative-bot"  />
  <link href="https://forums.getdrafts.com/stylesheets/discourse-presence_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="discourse-presence"  />
  <link href="https://forums.getdrafts.com/stylesheets/lazy-yt_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="lazy-yt"  />
  <link href="https://forums.getdrafts.com/stylesheets/poll_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="poll"  />
  <link href="https://forums.getdrafts.com/stylesheets/poll_desktop_efbc3607260bd3949bf9351692c294020d363176.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="poll_desktop"  />

  <link href="https://forums.getdrafts.com/stylesheets/desktop_theme_2_8a6535adb5ffcb37b246b8087d7136cfbc597ca9.css?__ws=forums.getdrafts.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2" data-theme-name="default"/>

    
    
        <link rel="alternate nofollow" type="application/rss+xml" title="RSS feed of &#39;Using prompt results in New Draft with Template&#39;" href="https://forums.getdrafts.com/t/using-prompt-results-in-new-draft-with-template/11481.rss" />
    <meta property="og:site_name" content="Drafts Community" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forums.getdrafts.com/uploads/default/original/2X/1/10752da87e35d3f274d6a2438229ff4f95e120be.png" />
<meta property="og:image" content="https://forums.getdrafts.com/uploads/default/original/2X/1/10752da87e35d3f274d6a2438229ff4f95e120be.png" />
<meta property="og:url" content="https://forums.getdrafts.com/t/using-prompt-results-in-new-draft-with-template/11481" />
<meta name="twitter:url" content="https://forums.getdrafts.com/t/using-prompt-results-in-new-draft-with-template/11481" />
<meta property="og:title" content="Using prompt results in New Draft with Template" />
<meta name="twitter:title" content="Using prompt results in New Draft with Template" />
<meta property="og:description" content="Hi. I’m having trouble combining prompts with a modified version of New Draft with Template.  My goal is to have a single template file in Drafts; run an action, fill in two text prompts (project name and project description), create a new draft from the template — and in the process, insert the project name and description into the new draft where the template has placeholders.  I am running into problems with replacing the template placeholders. When I run the action (more below), I get the ne..." />
<meta name="twitter:description" content="Hi. I’m having trouble combining prompts with a modified version of New Draft with Template.  My goal is to have a single template file in Drafts; run an action, fill in two text prompts (project name and project description), create a new draft from the template — and in the process, insert the project name and description into the new draft where the template has placeholders.  I am running into problems with replacing the template placeholders. When I run the action (more below), I get the ne..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="1 ❤" />
<meta property="article:published_time" content="2021-10-29T22:26:50+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
    <header>
  <a href="https://forums.getdrafts.com/">
    <h1>Drafts Community</h1>
  </a>
</header>

    <div id="main-outlet" class="wrap" role="main">
        <div id="topic-title">
    <h1>
      <a href="11481.html">Using prompt results in New Draft with Template</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/actions.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #652D90'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Actions - Help &amp; Questions</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='../../tag/actions.html' class='discourse-tag' rel="tag">actions</a>
        </div>
      </div>
  </div>

  


      <div id='post_1' itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Agile Tortoise, Inc.'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forums.getdrafts.com/uploads/default/original/2X/8/8ed1af80ec826f0860aad768f711c6b1b0fb32b4.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forums.getdrafts.com/u/tf2'><span itemprop='name'>tf2</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="11481.html">

            <link itemprop="image" href="https://forums.getdrafts.com/uploads/default/original/2X/1/10752da87e35d3f274d6a2438229ff4f95e120be.png">

          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-29T22:26:50Z' class='post-time'>
                October 29, 2021, 10:26pm
              </time>
              <meta itemprop='dateModified' content='2021-10-29T22:26:50Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Hi. I’m having trouble combining prompts with a modified version of New Draft with Template.</p>
<p>My goal is to have a single template file in Drafts; run an action, fill in two text prompts (project name and project description), create a new draft from the template — and in the process, insert the project name and description into the new draft where the template has placeholders.</p>
<p>I am running into problems with replacing the template placeholders. When I run the action (more below), I get the new draft, and the stock template tags (e.g., date and time) are correctly replaced (e.g., with the current date and time, in the right format); however, the placeholders for project name and description aren’t.</p>
<p>My only thought is that the script step doesn’t automatically receive the contents of the prompt, and so the tags aren’t filling in. Or maybe I’m misunderstanding how something else works.</p>
<p>Here are my action steps:</p>
<p><div class="lightbox-wrapper"><a class="lightbox" href="https://forums.getdrafts.com/uploads/default/original/2X/1/10752da87e35d3f274d6a2438229ff4f95e120be.png" data-download-href="https://forums.getdrafts.com/uploads/default/10752da87e35d3f274d6a2438229ff4f95e120be" title="image"><img src="../../uploads/default/optimized/2X/1/10752da87e35d3f274d6a2438229ff4f95e120be_2_287x250.png" alt="image" data-base62-sha1="2lAGXQGN9xH2D3ZkLmTwZbK3ELk" width="287" height="250" srcset="../../uploads/default/optimized/2X/1/10752da87e35d3f274d6a2438229ff4f95e120be_2_287x250.png, ../../uploads/default/optimized/2X/1/10752da87e35d3f274d6a2438229ff4f95e120be_2_430x375.png 1.5x, ../../uploads/default/optimized/2X/1/10752da87e35d3f274d6a2438229ff4f95e120be_2_574x500.png 2x" data-small-upload="https://forums.getdrafts.com/uploads/default/optimized/2X/1/10752da87e35d3f274d6a2438229ff4f95e120be_2_10x10.png"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename">image</span><span class="informations">650×566 37.8 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>Here’s the contents of my template (which has just one tag, ‘template’):</p>
<pre><code class="lang-auto">project note template
project: [[name_text]]
description: [[description_text]]
folder: 
created: 2021-10-29 @ 14:47
modified: 2021-10-29 @ 14:47
---
# [[name_text]]

&gt; [[description_text]]

## files &amp; folders

- [[[name_text]] project folder](file:/// XXX)
- [[[name_text]] tasks](file:/// XXX /todo.txt)
</code></pre>
<p>And below is my script — it’s just the New Draft with Template script, except I’ve commented out the template-picking part in favor of hard-coding a specific template by UUID, and set the omitTitle variable to true in a slightly roundabout way. I am deleting the commented-out portion here for brevity.</p>
<pre><code class="lang-auto">// modified from New Draft with Template action
// defaults
let omitFirstLineDefault = true;

// select from a list of drafts tagged "template" and create new draft based on selection.

let f = () =&gt; {

	// get the selected template draft
//	let selectedIndex = p.buttonPressed;
	let template = Draft.find('854E4F67-F60E-4E46-91B1-825BF1AA2C43');
	let content = template.content;
	let omitTitle = omitFirstLineDefault;

	if (omitTitle) {
		let lines = content.split('\n');
		if (lines.length &gt; 0) {
			lines.shift();
			content = lines.join('\n').replace(/^\s+/,"");
		}
	}

	// create new draft and assign content/tags/syntax
	let d = Draft.create();
	for (let tag of template.tags) {
		if (tag != "template") {
			d.addTag(tag);
		}
	}
	d.languageGrammar = template.languageGrammar;
	d.content = d.processTemplate(content);
	d.update();
	// load new draft
	editor.load(d);
	editor.activate();
	
	// look for &lt;|&gt; to set cursor location
	let loc = d.content.search("&lt;|&gt;");	
	editor.setText(editor.getText().replace("&lt;|&gt;", ""));
	editor.setSelectedRange(loc, 0);
	
	return true;
}

if (app.isPro) {
	if (!f()) {
		context.cancel();
	}
}
else {
	alert("Drafts Pro features required to use this action.")
}
</code></pre>
<p>Here’s the result of running the action recently — you’ll see that the custom tags are expanded, as it were, but the built-in ones are</p>
<pre><code class="lang-auto">project: [[name_text]]
description: [[description_text]]
folder: 
created: 2021-10-29 @ 18:14
modified: 2021-10-29 @ 18:14
---
# [[name_text]]

&gt; [[description_text]]

## files &amp; folders

- [[[name_text]] project folder](file:/// XXX)
- [[[name_text]] tasks](file:/// XXX /todo.txt)

</code></pre>
<p>Thanks in advance for any help!</p>
        </div>

        <meta itemprop='headline' content='Using prompt results in New Draft with Template'>
          <meta itemprop='keywords' content='actions'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                    <a href="https://forums.getdrafts.com/t/ipad-ios-widget-running-action-and-cursor-placement/12514/4" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='https://forums.getdrafts.com/t/ipad-ios-widget-running-action-and-cursor-placement/12514/4'>
                      <span itemprop='name'>iPad iOS Widget - Running Action and Cursor Placement</span>
                    </a>
                    <meta itemprop='position' content='2'>
                  </div>
            </div>
      </div>
      <div id='post_2' itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Agile Tortoise, Inc.'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forums.getdrafts.com/uploads/default/original/2X/8/8ed1af80ec826f0860aad768f711c6b1b0fb32b4.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forums.getdrafts.com/u/agiletortoise'><span itemprop='name'>agiletortoise</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="11481.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-29T23:23:28Z' class='post-time'>
                October 29, 2021, 11:23pm
              </time>
              <meta itemprop='dateModified' content='2021-10-29T23:23:28Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Custom template tags are specific to one draft.</p>
<p>When you use a prompt action step, the result becomes a custom template tag <em>of the current <code>draft</code> object</em> that is in context for the action. It’s the equivalent of calling <code>draft.setTemplateTag</code> (<a href="../../../scripting.getdrafts.com/classes/draft.html#settemplatetag">docs</a>) in script.</p>
<p>The script is process templates for a new draft (the variable <code>d</code>), which does not have those custom template tags set.</p>
<p>For this case, you would need to move those values over to the draft being processed, which you could do something like:</p>
<pre><code class="lang-javascript">d.languageGrammar = template.languageGrammar;
// ADD BELOW
d.setTemplateTag("name_text", draft.getTemplateTag("name_text"));
d.setTemplateTag("description_text", draft.getTemplateTag("description_text"));
// END ADD
d.content = d.processTemplate(content);
</code></pre>
<p>Hopefully that makes sense.</p>
        </div>

        <meta itemprop='headline' content='Using prompt results in New Draft with Template'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div id='post_3' itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Agile Tortoise, Inc.'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://forums.getdrafts.com/uploads/default/original/2X/8/8ed1af80ec826f0860aad768f711c6b1b0fb32b4.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://forums.getdrafts.com/u/tf2'><span itemprop='name'>tf2</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="11481.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-10-29T23:32:04Z' class='post-time'>
                October 29, 2021, 11:32pm
              </time>
              <meta itemprop='dateModified' content='2021-10-29T23:32:04Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I think so. You’ve said as much in other posts, but I didn’t get it — I think I do now.</p>
<p>The Prompt actions attach their results to the active draft. That’s great if you start with draft contents. But on my case, I’m not, and so they aren’t associated with any draft.</p>
<p>So I have to assign them to the draft I created to hold the results of the script.</p>
<p>Is that about right?</p>
        </div>

        <meta itemprop='headline' content='Using prompt results in New Draft with Template'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
  <nav class='crawler-nav'>
    <ul>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forums.getdrafts.com/' itemprop="url">Home </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forums.getdrafts.com/categories' itemprop="url">Categories </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forums.getdrafts.com/guidelines' itemprop="url">FAQ/Guidelines </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forums.getdrafts.com/tos' itemprop="url">Terms of Service </a>
        </span>
      </li>
      <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <span itemprop='name'>
          <a href='https://forums.getdrafts.com/privacy' itemprop="url">Privacy Policy </a>
        </span>
      </li>
    </ul>
  </nav>
  <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
</footer>

    
    
  </body>
  
</html>
