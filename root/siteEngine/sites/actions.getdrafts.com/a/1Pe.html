<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Write to Working Copy | Drafts Directory</title>
    <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="9ahCHiWJ6sbP8KkVreSQ/9b7y7VRla6b4ORUdMM5NamGt2SUQeJNI0CgEkX5p8vhcVgVTq9F5D3NlQYN6sGrWw==" />
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta http-equiv="content-language" content="en">
    <meta http-equiv="content-language" content="en-us">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta property="og:title" content="Drafts Directory: Write to Working Copy" />
    <meta property="og:url" content="https://actions.getdrafts.com/a/1Pe" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="Example actions and other extensions for Drafts, the quick-capture notes app." />
    <meta property="og:image" content="https://actions.getdrafts.com/assets/drafts-ogimage-action-d9c60102fd45e0cb516e1b49ed50a81e3c3a2b90f81f55df8f43d0feb0512978.png" />
    <meta property="twitter:title" content="Drafts Directory: Write to Working Copy" />
    <meta property="twitter:url" content="https://actions.getdrafts.com/a/1Pe" />
    <meta property="twitter:type" content="website" />
    <meta property="twitter:description" content="Example actions and other extensions for Drafts, the quick-capture notes app." />
    <meta property="twitter:image" content="https://actions.getdrafts.com/assets/drafts-ogimage-action-d9c60102fd45e0cb516e1b49ed50a81e3c3a2b90f81f55df8f43d0feb0512978.png" />

    <link rel="shortcut icon" type="image/x-icon" href="../assets/favicon-114dbb66b0ef0399a14fa5dfcad7e6210bb558c30cea665e04d49b59fec87f70.png" />

    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/default.min.css">
    <link rel="stylesheet" media="all" href="../assets/application-6e4f014b4c48cd673942dbfbbeb3e571a732b05562ddde5904f3a5c3833e54ff.css" />
    <script src="../assets/application-13492939cb10be5be76b5abb3e9ae0bef0bbae3202cec2b85cf6fca5bc8429c8.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script async defer data-domain="directory.getdrafts.com" src="https://plausible.io/js/plausible.js"></script>
  </head>

<body data-no-turbolink>

    <div class="page-wrap">
        <div class="side-bar">
            <a href="https://actions.getdrafts.com/index.html" class="site-title fs-6 lh-tight" title="{{ site.title }}">
                <img src="../assets/drafts-directory-header-4d826bd007f515c8e5a10f654e56ad76fbb3bd3103a67ce342283f701f1677fe.svg" alt="Drafts Directory" style="max-height: 30px;" />
            </a>
            <span class="fs-3"><button class="js-main-nav-trigger navigation-list-toggle btn btn-outline" type="button"
                    data-text-toggle="Hide">Menu</button></span>
            <div class="navigation main-nav js-main-nav">
              <ul class="navigation-list">
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://actions.getdrafts.com/index.html">Home</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://actions.getdrafts.com/drafts_actions.html">Actions</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://actions.getdrafts.com/drafts_action_groups.html">Action Groups</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://actions.getdrafts.com/syntax_definitions.html">Syntaxes</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://actions.getdrafts.com/theme_definitions.html">Themes</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://actions.getdrafts.com/workspaces.html">Workspaces</a>
                </li>
                <li class="navigation-list-item">
                  <hr style="margin:1em; padding: 0;" />
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://actions.getdrafts.com/search.html">Search</a>
                </li>
                <li class="navigation-list-item">
                  <hr style="margin:1em; padding: 0;" />
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="About Drafts" href="https://actions.getdrafts.com/getdrafts.com/index.html">Get Drafts &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Detailed documentation" href="https://actions.getdrafts.com/docs.getdrafts.com/index.html">User Guide &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Get your questions answered in the forums" href="https://forums.getdrafts.com/">Community &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Online tools and generators" href="https://actions.getdrafts.com/tools.getdrafts.com/index.html">Tools &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Scripting library reference" href="https://actions.getdrafts.com/scripting.getdrafts.com/index.html">Script Reference &#x2192;</a>
                </li>
              </ul>
            </div>
            <footer role="contentinfo" class="site-footer">
                <p class="text-small text-grey-dk-000 mb-0">
                    Download: <a href="https://itunes.apple.com/app/id1236254471?ls=1&mt=8&at=11l4Cf&ct=site">iOS</a> | <a href="https://itunes.apple.com/app/id1435957248?mt=12&at=11l4Cf&ct=site">Mac</a>
                </p>
            </footer>
        </div>
        <div class="main-content-wrap js-main-content" tabindex="0">
            <div class="page-header">
                <div class="main-content">
                    <div class="search js-search">
	<div class="search-input-wrap">
<form class="search-form" action="https://actions.getdrafts.com/search.html" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
	<button style='border:none;background-color:transparent;'>
	<svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"
		class="search-icon">
		<title>Search</title>
		<g fill-rule="nonzero">
			<path
				d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z" />
			<path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z" />
		</g>
	</svg>
	</button>
	<input type="text" name="q" id="q" class="js-search-input search-input search" size="12" tabindex="0" placeholder="Search" />
</form>	</div>
</div>
                    <ul class="list-style-none text-small mt-md-1 mb-md-1 pb-4 pb-md-0 js-aux-nav aux-nav">
                        <li class="d-inline-block my-0 mr-2">
                          <a href="https://actions.getdrafts.com/getdrafts.com/index.html">Get Drafts</a>
                        </li>
                        <li class="d-inline-block my-0">
                          <a href="https://forums.getdrafts.com">Community</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="main-content">
                <div id="main-content" class="page-content" role="main">
                  <div class="type">
                    <h4>Action</h4>
                  </div>
                  <div class="header">
                      <h1><img src="https://config.agiletortoise.com/drafts-icons/301-alien-ship.png" class="action-icon" />Write to Working Copy</h1>
                  </div>

                  <div class="content">
                    
<div class='caption'>
        Posted by @BoxOfSnoo,
    Last update
    over 3 years ago
</div>


    <div class='description'>
        <p>Write the Markdown draft to Working Copy.  It will handle files with the same name in different directories, and allow you to choose.</p>

<p>The script will prompt for your repository name and URL key at the first run, and will store these values in the Credentials for the script.  You can leave the “key” parameter empty if you have to URL key.</p>

    </div>

<div class="certification">
  
  
</div>

<div style="margin: 2em 0;">
    <a class="btn btn-blue" href="drafts5://action?identifier=1Pe&amp;data=%7B%22uuid%22:%22FD57AC01-1E5F-4F0D-802E-512D214FA7B4%22,%22steps%22:[%7B%22platforms%22:3,%22data%22:%7B%22script%22:%22%5Cn(()%20=%5Cu003e%20%7B%5Cn%5Cn%5Ctconst%20settings%20=%20Credential.create(%5C%22Working%20Copy%20Notes%5C%22,%5C%22Repo%20information%20and%20URL%20key%20for%20Working%20Copy%20notes%5C%22);%5Cn%5Cn%5Ctsettings.addTextField(%5C%22repo%5C%22,%20%5C%22Repository%5C%22);%5Cn%5Ctsettings.addTextField(%5C%22key%5C%22,%5C%22URL%20key%5C%22);%5Cn%5Cn%5Ctsettings.authorize();%5Cn%5Cn%5Ctconst%20repoName%20=%20settings.getValue(%5C%22repo%5C%22);%5Cn%5Ctconst%20urlAutomationKey%20=%20settings.getValue(%5C%22key%5C%22)%20%7C%7C%20%5C%22%5C%22;%5Cn%5Ct%5Cn%5Ct//%20Get%20the%20filename%20from%20the%20draft%5Cn%5Ct//%20This%20is%20probably%20not%20necessary,%20as%20Drafts%20invisibly%20removes%20the%20heading%20tag%5Cn%5Ctlet%20fileName%20=%20draft.title.replace(/%5E%23(%5C%5Cw?)/gi,%20&#39;$1&#39;)%20+%20%5C%22.md%5C%22;%5Cn%5Cn%5Ct//%20Get%20all%20details%20of%20the%20repo%20files%5Cn%5Ctlet%20cb%20=%20CallbackURL.create();%5Cn%5Cn%5Ctcb.baseURL%20=%20%5C%22working-copy://x-callback-url/status/%5C%22;%5Cn%5Ctcb.addParameter(%5C%22repo%5C%22,%20repoName);%5Cn%5Ctcb.addParameter(%5C%22path%5C%22,%20%5C%22/%5C%22);%5Cn%5Ctcb.addParameter(%5C%22unchanged%5C%22,%201);%5Cn%5Cn%5Ctlet%20success%20=%20cb.open();%5Cn%5Cn%5Ctif%20(success)%20%7B%5Cn%5Ct%5Ctlet%20repo%20=%20cb.callbackResponse;%5Cn%5Ct%5Ctlet%20filePath%20=%20%5C%22%5C%22;%5Cn%5Cn%5Ct%5Ct//%20Look%20for%20all%20instances%20of%20this%20file%20name%5Cn%5Ct%5Ctconst%20files%20=%20findObjectsByKey(%5Cn%5Ct%5Ct%5Ct%5CtJSON.parse(repo.json),%20%5Cn%5Ct%5Ct%5Ct%5Ct%5C%22name%5C%22,%5Cn%20%5Ct%5Ct%5Ct%5CtfileName);%5Cn%5Cn%5Ct%5Ctif%20(files.length%20==%201%20)%20%7B%5Cn%5Ct%5Ct%5CtfilePath%20=%20dirName(files[0].path);%5Cn%5Ct%5Ct%5Cn%5Ct%5Ct%7D%20else%20if(files.length%20%5Cu003e%201)%20%7B%5Cn%5Ct%5Ct%5Ctconst%20pr%20=%20Prompt.create();%5Cn%5Cn%5Ct%5Ct%5Ctpr.title%20=%20%5C%22Select%20correct%20path%5C%22;%5Cn%5Ct%5Ct%5Ctpr.message%20=%20%5C%22Multiple%20files%20with%20this%20filename%20located.%20%20%5C%22%20+%20%5Ct%5Ct%5Ct%5Ct%5C%22Please%20choose%20the%20correct%20path%20as%20save%20destination%5C%22;%5Cn%5Ct%5Ct%5Cn%5Ct%5Ct%5Ctconst%20paths%20=%20[];%5Cn%5Ct%5Ct%5Cn%5Ct%5Ct%5Ctfor%20(let%20i=0;%20i%20%5Cu003c%20files.length;%20i++)%20%7B%5Cn%5Ct%5Ct%5Ct%5Ctpaths.push(dirName(files[i].path));%5Cn%5Ct%5Ct%5Ct%7D%5Cn%5Cn%5Ct%5Ct%5Ctpr.addPicker(%5C%22chosenPath%5C%22,%20%5C%22%5C%22,%20[paths],%20null);%5Cn%5Ct%5Ct%5Ctpr.addButton(%5C%22OK%5C%22,%201);%5Cn%5Ct%5Ct%5Cn%5Ct%5Ct%5Ctlet%20didSelect%20=%20pr.show();%5Cn%5Ct%5Ct%5Cn%5Ct%5Ct%5Ctif%20(didSelect)%20%7B%5Cn%5Ct%5Ct%5Ct%5CtfilePath%20=%20paths[pr.fieldValues[%5C%22chosenPath%5C%22]];%5Cn%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%7D%5Cn%5Ct%5Cn%5Ct%5Ct//%20Write%20file%20to%20repo%5Cn%5Ct%5Ctlet%20wcUrl%20=%20%5C%22working-copy://x-callback-url/write/%5C%22%20+%5Cn%5Ct%5Ct%5Ct%5C%22?key=%5C%22%20+%20urlAutomationKey%20+%5Cn%5Ct%5Ct%5Ct%5C%22%5Cu0026repo=%5C%22%20+%20encodeURIComponent(repoName);%5Cn%5Ct%5Ct%5Cn%5Ct%5Ctif%20(files.length%20==%200)%20%7B%5Cn%5Ct%5Ct%5Ct//%20Nothing%20was%20found.%20%5Cn%5Ct%5Ct%5Ct//%20Working%20Copy%20should%20prompt%20you%20to%20Save%20As%5Cn%5Ct%5Ct%5Ct//%20path%20may%20be%20empty%20if%20the%20file%20exists%20at%20the%20root%5Cn%5Ct%5Ct%5CtwcUrl%20+=%20%5C%22%5Cu0026no_path=empty%5C%22%20+%5Cn%5Ct%5Ct%5Ct%5Ct%5C%22%5Cu0026filename=%5C%22%20+%20encodeURIComponent(fileName);%5Cn%5Ct%5Ct%7D%20else%20%7B%5Cn%5Ct%5Ct%5CtwcUrl%20+=%20%5C%22%5Cu0026path=%5C%22%20+%20encodeURIComponent(filePath%20+%20fileName);%5Cn%5Ct%5Ct%7D%5Cn%5Ct%5Cn%5Ct%5CtwcUrl%20+=%20%5C%22%5Cu0026x-source=Drafts%5Cu0026x-success=%5C%22+encodeURIComponent(%5C%22drafts5://%5C%22);%5Cn%5Ct%5CtwcUrl%20+=%20%5C%22%5Cu0026text=%5C%22%20+%20encodeURIComponent(draft.content);%5Cn%5Cn%5Ct%5Ctapp.openURL(wcUrl,%20false);%5Ct%5Cn%5Ct%7D%5Cn%7D)();%5Cn%5Cn//%20Support%20functions%5Cn%5Cn//%20Search%20the%20entire%20repo%20to%20find%20the%20filenames.%20%20Could%20be%20multiple.%5Cnfunction%20findObjectsByKey(array,%20key,%20value)%20%7B%5Cn%5Cn%5Ctvar%20fileList%20=%20[];%5Cn%5Ctfor%20(var%20i%20=%200;%20i%20%5Cu003c%20array.length;%20i++)%20%7B%5Cn%5Ct%5Ctif%20(array[i][key]%20===%20value)%20%7B%5Cn%5Ct%5Ct%5CtfileList.push(array[i]);%5Cn%5Ct%5Ct%7D%5Cn%5Ct%7D%5Cn%5Ctreturn%20fileList;%5Cn%7D%5Cn%5Cn//%20Get%20the%20path%20without%20the%20filename%5Cnfunction%20dirName(str)%20%7B%5Cn%5Ctvar%20base%20=%20new%20String(str).substring(0,%20str.lastIndexOf(&#39;/&#39;)%20+%201);%20%5Cn%5Ctreturn%20base;%5Cn%7D%22%7D,%22type%22:%22script%22,%22isEnabled%22:true,%22uuid%22:%22A56D7D59-905D-4B84-841F-9CF00AB8D7CC%22%7D],%22backingPlatforms%22:3,%22shortName%22:%22%E2%AC%86%EF%B8%8F%22,%22shouldConfirm%22:false,%22disposition%22:0,%22keyCommand%22:%7B%22optionKey%22:false,%22input%22:%22%22,%22controlKey%22:false,%22commandKey%22:false,%22type%22:%22action%22,%22discoverabilityTitle%22:%22Write%20to%20Working%20Copy%22,%22shiftKey%22:false%7D,%22logLevel%22:2,%22groupDisposition%22:0,%22notificationType%22:2,%22tintColor%22:%22blue%22,%22actionDescription%22:%22%22,%22keyUseIcon%22:true,%22icon%22:%22301-alien-ship%22,%22visibility%22:2,%22backingIsSeparator%22:false,%22groupUUID%22:%22EBA46D37-B3F7-45FE-8D3D-DA914D335ED1%22,%22assignTags%22:[],%22name%22:%22Write%20to%20Working%20Copy%22%7D">Install</a>
</div>

<div>
  <h4>Steps</h4>
<ul class='steps'>
  <li>
    <div class='step'><h3>script</h3><pre><code class='language-javascript'>
(() =&gt; {

	const settings = Credential.create(&quot;Working Copy Notes&quot;,&quot;Repo information and URL key for Working Copy notes&quot;);

	settings.addTextField(&quot;repo&quot;, &quot;Repository&quot;);
	settings.addTextField(&quot;key&quot;,&quot;URL key&quot;);

	settings.authorize();

	const repoName = settings.getValue(&quot;repo&quot;);
	const urlAutomationKey = settings.getValue(&quot;key&quot;) || &quot;&quot;;
	
	// Get the filename from the draft
	// This is probably not necessary, as Drafts invisibly removes the heading tag
	let fileName = draft.title.replace(/^#(\w?)/gi, &#39;$1&#39;) + &quot;.md&quot;;

	// Get all details of the repo files
	let cb = CallbackURL.create();

	cb.baseURL = &quot;working-copy://x-callback-url/status/&quot;;
	cb.addParameter(&quot;repo&quot;, repoName);
	cb.addParameter(&quot;path&quot;, &quot;/&quot;);
	cb.addParameter(&quot;unchanged&quot;, 1);

	let success = cb.open();

	if (success) {
		let repo = cb.callbackResponse;
		let filePath = &quot;&quot;;

		// Look for all instances of this file name
		const files = findObjectsByKey(
				JSON.parse(repo.json), 
				&quot;name&quot;,
 				fileName);

		if (files.length == 1 ) {
			filePath = dirName(files[0].path);
		
		} else if(files.length &gt; 1) {
			const pr = Prompt.create();

			pr.title = &quot;Select correct path&quot;;
			pr.message = &quot;Multiple files with this filename located.  &quot; + 				&quot;Please choose the correct path as save destination&quot;;
		
			const paths = [];
		
			for (let i=0; i &lt; files.length; i++) {
				paths.push(dirName(files[i].path));
			}

			pr.addPicker(&quot;chosenPath&quot;, &quot;&quot;, [paths], null);
			pr.addButton(&quot;OK&quot;, 1);
		
			let didSelect = pr.show();
		
			if (didSelect) {
				filePath = paths[pr.fieldValues[&quot;chosenPath&quot;]];
			}
		}
	
		// Write file to repo
		let wcUrl = &quot;working-copy://x-callback-url/write/&quot; +
			&quot;?key=&quot; + urlAutomationKey +
			&quot;&amp;repo=&quot; + encodeURIComponent(repoName);
		
		if (files.length == 0) {
			// Nothing was found. 
			// Working Copy should prompt you to Save As
			// path may be empty if the file exists at the root
			wcUrl += &quot;&amp;no_path=empty&quot; +
				&quot;&amp;filename=&quot; + encodeURIComponent(fileName);
		} else {
			wcUrl += &quot;&amp;path=&quot; + encodeURIComponent(filePath + fileName);
		}
	
		wcUrl += &quot;&amp;x-source=Drafts&amp;x-success=&quot;+encodeURIComponent(&quot;drafts5://&quot;);
		wcUrl += &quot;&amp;text=&quot; + encodeURIComponent(draft.content);

		app.openURL(wcUrl, false);	
	}
})();

// Support functions

// Search the entire repo to find the filenames.  Could be multiple.
function findObjectsByKey(array, key, value) {

	var fileList = [];
	for (var i = 0; i &lt; array.length; i++) {
		if (array[i][key] === value) {
			fileList.push(array[i]);
		}
	}
	return fileList;
}

// Get the path without the filename
function dirName(str) {
	var base = new String(str).substring(0, str.lastIndexOf(&#39;/&#39;) + 1); 
	return base;
}</code></pre></div>
  </li>
</ul>
</div>

<div>
  <h4>Options</h4>
  <ul class="steps">
    <li>
  <table class='action-detail'>
    <tr>
      <td class="cell-label">After Success</td>
      <td class="value">
        Nothing
        
      </td>
    </tr>
    <tr>
      <td class="cell-label">Notification</td>
      <td class="value">Info</td>
    </tr>
    <tr>
      <td class="cell-label">Log Level</td>
      <td class="value">Info</td>
    </tr>
  </table>
</li>
</ul>
</div>

<div class="disclaimer">
  Items available in the Drafts Directory are uploaded by community members. Use appropriate caution reviewing downloaded items before use.
</div>


                  </div>
                  <div class="footer-content">
                  <p>
                  <a href="https://itunes.apple.com/app/id1236254471?ls=1&mt=8&at=11l4Cf&ct=site">
                    <img alt="Download on App Store" src="../assets/appstore-deaf597bd57239c5054c59099e54ab9014f1e15eddb961085428e0ce94d4385b.svg" />
                  </a>
                  <a href="https://itunes.apple.com/app/id1435957248?mt=12&at=11l4Cf&ct=site">
                    <img alt="Download on Mac App Store" src="../assets/macappstore-05f5eed00e6bb26b68c1368217276158329862682e6d61b3ed193f819fe02f2f.svg" />
                  </a>
                  </p>
                    &copy; 2012-2022 by Agile Tortoise, Inc.<br/>
                    Drafts is a registered Trademark of Agile Tortoise, Inc.<br/>
                    <a href="https://actions.getdrafts.com/getdrafts.com/support/privacy.html">Privacy</a> | <a href="https://actions.getdrafts.com/getdrafts.com/support/terms.html">Terms</a>
                </div>
                </div>
            </div>
        </div>
    </div>

  </body>
  </html>
