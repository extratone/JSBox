<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>crosslink Todoist project &amp; Craft document | Drafts Directory</title>
    <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="AChdy4OaTPmynIBrNL4x8t4FiA7tPqXXlwzljjDW87NzN3tB5/HrHD3MOztg/WrseaZW9RPu73G6fbf3GS5tQQ==" />
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta http-equiv="content-language" content="en">
    <meta http-equiv="content-language" content="en-us">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta property="og:title" content="Drafts Directory: crosslink Todoist project &amp; Craft document" />
    <meta property="og:url" content="https://actions.getdrafts.com/a/1sk" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="Example actions and other extensions for Drafts, the quick-capture notes app." />
    <meta property="og:image" content="https://actions.getdrafts.com/assets/drafts-ogimage-action-d9c60102fd45e0cb516e1b49ed50a81e3c3a2b90f81f55df8f43d0feb0512978.png" />
    <meta property="twitter:title" content="Drafts Directory: crosslink Todoist project &amp; Craft document" />
    <meta property="twitter:url" content="https://actions.getdrafts.com/a/1sk" />
    <meta property="twitter:type" content="website" />
    <meta property="twitter:description" content="Example actions and other extensions for Drafts, the quick-capture notes app." />
    <meta property="twitter:image" content="https://actions.getdrafts.com/assets/drafts-ogimage-action-d9c60102fd45e0cb516e1b49ed50a81e3c3a2b90f81f55df8f43d0feb0512978.png" />

    <link rel="shortcut icon" type="image/x-icon" href="../assets/favicon-114dbb66b0ef0399a14fa5dfcad7e6210bb558c30cea665e04d49b59fec87f70.png" />

    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/default.min.css">
    <link rel="stylesheet" media="all" href="../assets/application-6e4f014b4c48cd673942dbfbbeb3e571a732b05562ddde5904f3a5c3833e54ff.css" />
    <script src="../assets/application-13492939cb10be5be76b5abb3e9ae0bef0bbae3202cec2b85cf6fca5bc8429c8.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script async defer data-domain="directory.getdrafts.com" src="https://plausible.io/js/plausible.js"></script>
  </head>

<body data-no-turbolink>

    <div class="page-wrap">
        <div class="side-bar">
            <a href="../index.html" class="site-title fs-6 lh-tight" title="{{ site.title }}">
                <img src="../assets/drafts-directory-header-4d826bd007f515c8e5a10f654e56ad76fbb3bd3103a67ce342283f701f1677fe.svg" alt="Drafts Directory" style="max-height: 30px;" />
            </a>
            <span class="fs-3"><button class="js-main-nav-trigger navigation-list-toggle btn btn-outline" type="button"
                    data-text-toggle="Hide">Menu</button></span>
            <div class="navigation main-nav js-main-nav">
              <ul class="navigation-list">
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="../index.html">Home</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="../drafts_actions.html">Actions</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="../drafts_action_groups.html">Action Groups</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="../syntax_definitions.html">Syntaxes</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="../theme_definitions.html">Themes</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="../workspaces.html">Workspaces</a>
                </li>
                <li class="navigation-list-item">
                  <hr style="margin:1em; padding: 0;" />
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="../search.html">Search</a>
                </li>
                <li class="navigation-list-item">
                  <hr style="margin:1em; padding: 0;" />
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="About Drafts" href="../../getdrafts.com/index.html">Get Drafts &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Detailed documentation" href="../../docs.getdrafts.com/index.html">User Guide &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Get your questions answered in the forums" href="https://forums.getdrafts.com/">Community &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Online tools and generators" href="../../tools.getdrafts.com/index.html">Tools &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Scripting library reference" href="../../scripting.getdrafts.com/index.html">Script Reference &#x2192;</a>
                </li>
              </ul>
            </div>
            <footer role="contentinfo" class="site-footer">
                <p class="text-small text-grey-dk-000 mb-0">
                    Download: <a href="https://itunes.apple.com/app/id1236254471?ls=1&mt=8&at=11l4Cf&ct=site">iOS</a> | <a href="https://itunes.apple.com/app/id1435957248?mt=12&at=11l4Cf&ct=site">Mac</a>
                </p>
            </footer>
        </div>
        <div class="main-content-wrap js-main-content" tabindex="0">
            <div class="page-header">
                <div class="main-content">
                    <div class="search js-search">
	<div class="search-input-wrap">
<form class="search-form" action="../search.html" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
	<button style='border:none;background-color:transparent;'>
	<svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"
		class="search-icon">
		<title>Search</title>
		<g fill-rule="nonzero">
			<path
				d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z" />
			<path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z" />
		</g>
	</svg>
	</button>
	<input type="text" name="q" id="q" class="js-search-input search-input search" size="12" tabindex="0" placeholder="Search" />
</form>	</div>
</div>
                    <ul class="list-style-none text-small mt-md-1 mb-md-1 pb-4 pb-md-0 js-aux-nav aux-nav">
                        <li class="d-inline-block my-0 mr-2">
                          <a href="../../getdrafts.com/index.html">Get Drafts</a>
                        </li>
                        <li class="d-inline-block my-0">
                          <a href="https://forums.getdrafts.com">Community</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="main-content">
                <div id="main-content" class="page-content" role="main">
                  <div class="type">
                    <h4>Action</h4>
                  </div>
                  <div class="header">
                      <h1><img src="https://config.agiletortoise.com/drafts-icons/circuit-board.png" class="action-icon" />crosslink Todoist project &amp; Craft document</h1>
                  </div>

                  <div class="content">
                    
<div class='caption'>
        Posted by FlohGro,
    Last update
    3 months ago
</div>

    <div class='update_notes'>
      <h3>UPDATES</h3>
      <div id="firstUpdateNote">
      <h4>3 months ago</h4>
      <p>changed default behavior to don’t use a template; added webview link</p>

      </div>
    </div>

    <div class='description'>
        <p><em>created by <a href="https://twitter.com/FlohGro">@FlohGro</a> / more on my <a href="http://www.flohgro.com/blog">Blog</a></em></p>

<h2>crosslink Todoist project &amp; Craft document</h2>

<p>This action will create a cross-linked project between Todoist and Craft.</p>

<p>The new project in Todoist will contain a link to the document in Craft and vice-versa. </p>

<p>The document in Craft will be created from a configurable template Draft.</p>

<p>Running the action will open a prompt asking you for the name of the project - this prompt will be prefilled with the current drafts content but you can set any name you like (the current draft will remain unchanged).</p>

<p><em>known &ldquo;issue&rdquo;: if you quickly open the link to the Todoist project after the action prepended the link to the project to the Craft document, your Todoist app may show an error telling you that the project could not be found. The reason for this is, that Todoist needs to sync the created project to your app first. After the project was synced, the error won&rsquo;t occur again.</em></p>

<h2>[Configuration]</h2>

<p>You need to follow these steps until you can use the action.</p>

<p><strong>Define the project template draft</strong></p>

<p>The action <strong>can</strong> be configured to use a template for all your project documents (if you want that all of them have the same structure).</p>

<p>If you don’t want to use a project template draft (the created Craft document will be empty besides the link to the Todoist project). There is no need to change something after installing the action since the template usage is disabled by default.</p>

<p>If you want to use a template for the project document in Craft, create a new draft and give it a meaningful title (first line) and maybe add some tags to the draft to keep your library structured.</p>

<p>Then setup the template in Markdown format (note that the title (first line) of the template draft will not be pushed to the Craft document)</p>

<p>When you finished the template tap the „info“ button in the <a href="../../docs.getdrafts.com/editor/index.html">editor</a> and then tap the button titled „UUID“. This will copy the UUID of that draft.</p>

<p>Next, edit the script step of this action and change the variable in line 3 to <code>true</code>: <code>const templateDraftAvailable = true;</code>. Then find line 5 <code>const templateDraftUUID = &quot;unconfigured“;</code> and select the word <code>unconfigured</code> and paste the UUID you just copied (attention: don&rsquo;t delete the quotation marks).</p>

<p>If you don’t want to use the (any of my) action for different Craft spaces there is no further configuration needed. When you first run any of my Craft actions it will ask you to store the space id of your Craft space. This is a one time action and you don’t need to do it for any other oof my Craft actions you install.</p>

<p>To retrieve your spaceId just copy the deeplink of any document in that space (refer to the <a href="https://support.craft.do/hc/en-us/articles/360020043878-How-to-link-into-a-specific-place-in-Craft-with-a-Deeplink">Craft Support Page</a> when you don&rsquo;t know how to do that). Paste the copied id into a draft and you will se a link similar to this: &ldquo;craftdocs://open?blockId=[the block id]&amp;spaceId=[the spaceId]&rdquo; - find the character combination &ldquo;[the spaceId]&rdquo; after the &ldquo;spaceId=&rdquo; and copy it and paste it into the prompt of this action.</p>

<p>To use these actions with different spaces you need to duplicate the action for each space you want to use it. I recommend to e.g. add a suffix to the action name to describe the space for which you configure it.<br><br>
The action uses Drafts possibility to store <a href="../../docs.getdrafts.com/docs/settings/credentials.html">credentials</a> to distinguish different spaces. When you duplicate the action for another space you have to change the name of the credential. Therefore you need edit this line <code>const spaceIdCredentialName = &quot;CraftDocumentSpace&quot;</code> in the script step of the action and change the <code>CraftDocumentSpace</code> to something different (e.g. describe the space in a suffix like „CraftDocumentSpacePersonal&quot; or „CraftDocumentSpaceWork“. If you use several of my Craft actions you should use the same credential name in all of them.</p>

<h2>[Usage]</h2>

<p>After you configured the action properly - just run it when you want to setup a new project from whatever draft you currently opened.</p>

<p>The prompt will appear and you can use either the content of the current draft as the project name or just type a new name.</p>

<p>The action will then create the project in Todoist, retrieve its id and create a new craft document (eventually with your configured template) and link that project in the document. Then the action will create an uncompletable task in the new Todoist project containing a clickable link to the project document in Craft.</p>

<p><em>note: the Craft document will actually contain two links to Todoist. The name of the project will be a link which can be used on mobile (iOS / iPadOS) to directly open the project in the Todoist app. the „Webview“ link is necessary for macOS since the mobile url is not working properly on the Mac.</em></p>

<hr>

<p><em>If you find this useful and want to support me you can</em> </p>

<p><a href="https://www.buymeacoffee.com/flohgro" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-blue.png" alt="Buy Me A Coffee" style="height: 51px !important;width: 209px !important;" ></a></p>

    </div>

<div class="certification">
  
  <a class='trusted' href='1sk.html#' title='From trusted community member'><img style="width:24px;height:24px;vertical-align:middle;" src="../assets/trusted-c3f95628f768e0a0ed09961d556a8012d1b1be6ae9e6adede683513eec0df814.svg" /> Trusted member</a>
</div>

<div style="margin: 2em 0;">
    <a class="btn btn-blue" href="drafts5://action?identifier=1sk&amp;data=%7B%22uuid%22:%22184AAE33-44F9-45E2-A239-C641C915ED7A%22,%22steps%22:[%7B%22platforms%22:3,%22data%22:%7B%22script%22:%22//%20is%20there%20an%20additional%20Draft%20Template%20which%20shall%20be%20added%20as%20content%20to%20the%20note?%5Cn//%20set%20this%20to%20true%20if%20you%20want%20to%20use%20a%20template%20draft%20/%20if%20you%20don&#39;t%20want%20to%20use%20a%20template,%20then%20set%20it%20to%20false%20(no%20%5C%22%5C%22%20around%20the%20true%20/%20false)%5Cnconst%20templateDraftAvailable%20=%20false;%5Cn//%20copy%20the%20uuid%20of%20your%20template%20draft%20for%20project%20documents%20and%20paste%20it%20between%20the%20quotation%20marks%5Cnconst%20templateDraftUUID%20=%20%5C%22unconfigured%5C%22;%5Cn%5Cn//%20------------------------------------------------------------------------%5Cn//%20END%20OF%20CONFIGURATION%5Cn//%20ANY%20CHANGES%20BELOW%20CAN%20LET%20THE%20ACTION%20FAIL%20-%20ONLY%20CHANGE%20THINGS%20IF%20YOU%20KNOW%20WHAT%20YOU%20ARE%20DOING%5Cn//%20------------------------------------------------------------------------%5Cn%5Cn%5Cn%5Cnif%20(templateDraftAvailable%20==%20true%20%5Cu0026%5Cu0026%20templateDraftUUID%20==%20%5C%22unconfigured%5C%22)%20%7B%5Cn%20%20%20%20let%20errStr%20=%20%5C%22template%20Draft%20should%20be%20used%20but%20uuid%20is%20unconfigured,%20read%20the%20description%20of%20the%20action%20and%20configure%20it%20correctly.%5C%22%5Cn%20%20%20%20context.fail(errStr);%5Cn%20%20%20%20app.displayErrorMessage(%5C%22invalid%20configuration%5C%22);%5Cn%7D%20else%20%7B%5Cn%5Cn%20%20%20%20var%20spaceId%20=%20getCraftSpaceIdToUse();%5Cn%20%20%20%20if%20(spaceId)%20%7B%5Cn%5Cn%20%20%20%20%20%20%20%20//%20create%20Todoist%20object%5Cn%20%20%20%20%20%20%20%20var%20todoist%20=%20Todoist.create();%5Cn%5Cn%20%20%20%20%20%20%20%20//%20define%20project%20name%5Cn%20%20%20%20%20%20%20%20let%20newProjectName%20=%20setProjectName()%5Cn%5Cn%20%20%20%20%20%20%20%20if%20(newProjectName)%20%7B%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20%20let%20createdProject%20=%20createTodoistProject(newProjectName);%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if%20(createdProject)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20projectLinkStringToDocument%20=%20createCraftDocumentAndLinkedprojectString(newProjectName,%20createdProject[%5C%22id%5C%22])%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(projectLinkStringToDocument)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20createTaskInTodoistProject(projectLinkStringToDocument,%20createdProject[%5C%22id%5C%22])%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20//%20do%20error%20handling%5Cn%20%20%20%20%20%20%20%20%20%20%20%20context.cancel(%5C%22no%20project%20name%20set%5C%22);%5Cn%20%20%20%20%20%20%20%20%20%20%20%20app.displayWarningMessage(%5C%22aborted;%20didn&#39;t%20select%20a%20project%20name%5C%22);%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%5Cn%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20//%20do%20error%20handling%5Cn%20%20%20%20%20%20%20%20context.cancel(%5C%22Craft%20spaceId%20is%20not%20configured%5C%22);%5Cn%20%20%20%20%20%20%20%20app.displayWarningMessage(%5C%22Craft%20spaceId%20is%20not%20configured%5C%22);%5Cn%20%20%20%20%7D%5Cn%7D%5Cn//%20------------------------------------------------------------------------%5Cn//%20FUNCTIONS%5Cn//%20------------------------------------------------------------------------%5Cn%5Cn%5Cnfunction%20setProjectName()%20%7B%5Cn%20%20%20%20let%20projectName%20=%20%5C%22%5C%22;%5Cn%20%20%20%20if%20(draft.content.length%20!=%200)%20%7B%5Cn%20%20%20%20%20%20%20%20projectName%20=%20draft.content;%5Cn%20%20%20%20%7D%5Cn%20%20%20%20var%20p%20=%20Prompt.create();%5Cn%20%20%20%20p.title%20=%20%5C%22Project%20Name%5C%22;%5Cn%5Cn%20%20%20%20p.addTextField(%5C%22userProjectName%5C%22,%20%5C%22%5C%22,%20projectName,%20%7B%5Cn%20%20%20%20%20%20%20%20wantsFocus:%20true%5Cn%20%20%20%20%7D);%5Cn%5Cn%20%20%20%20p.addButton(%5C%22Set%20Project%20Name%5C%22);%5Cn%5Cn%20%20%20%20if%20(p.show())%20%7B%5Cn%5Cn%20%20%20%20%20%20%20%20projectName%20=%20p.fieldValues[%5C%22userProjectName%5C%22]%5Cn%20%20%20%20%20%20%20%20return%20projectName%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20return%20false%5Cn%20%20%20%20%7D%5Cn%7D%5Cn%5Cn%5Cnfunction%20createTodoistProject(projectName)%20%7B%5Cn%5Cn%20%20%20%20//%20create%20the%20project%20in%20todoist%5Cn%20%20%20%20let%20createProjectResponse%20=%20todoist.createProject(%7B%5Cn%20%20%20%20%20%20%20%20%5C%22name%5C%22:%20projectName%5Cn%20%20%20%20%7D)%5Cn%5Cn%20%20%20%20if%20(!createProjectResponse)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20message%20=%20%5C%22Failed%20to%20add%20project%20to%20todoist:%20%5C%22%20+%20todoist.lastError;%5Cn%20%20%20%20%20%20%20%20console.log(message)%5Cn%20%20%20%20%20%20%20%20context.fail(message);%5Cn%20%20%20%20%20%20%20%20app.displayErrorMessage(message);%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20let%20message%20=%20%5C%22successfully%20added%20project%20in%20todoist%20with%20name:%20%5C%22%20+%20projectName;%5Cn%20%20%20%20%20%20%20%20console.log(message)%5Cn%20%20%20%20%20%20%20%20//%20return%20relevant%20parameters%20of%20the%5Cn%20%20%20%20%20%20%20%20return%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%5C%22id%5C%22:%20createProjectResponse[%5C%22id%5C%22],%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%5C%22url%5C%22:%20createProjectResponse[%5C%22url%5C%22]%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%7D%5Cn%5Cnfunction%20createCraftDocumentAndLinkedprojectString(projectName,%20todoistProjectID)%20%7B%5Cn%5Cn%20%20%20%20const%20craftCreateBaseURL%20=%20%5C%22craftdocs://x-callback-url/createdocument?%5C%22;%5Cn%5Cn%20%20%20%20const%20todoistShowProjectUrl%20=%20%5C%22todoist://project?id=%5C%22%20+%20todoistProjectID;%5Cn%5Cn%5Ctconst%20todoistShowProjectUrlWebView%20=%20%5C%22https://todoist.com/showProject?id=%5C%22%20+%20todoistProjectID;%5Cn%5Ct%5Cn%20%20%20%20const%20projectLinkText%20=%20%5C%22%5Cu003e%20Project%20in%20Todoist:%20[%5C%22%20+%20projectName%20+%20%5C%22](%5C%22%20+%20todoistShowProjectUrl%20+%20%5C%22)%20([Webview](%5C%22%20+%20todoistShowProjectUrlWebView%20+%20%5C%22))%5C%22;%5Cn%20%20%20%20let%20unencodedTitle%20=%20projectName;%5Cn%20%20%20%20let%20title%20=%20encodeURIComponent(projectName);%5Cn%5Cn%20%20%20%20let%20templateContent%20=%20%5C%22%5C%22;%5Cn%20%20%20%20if%20(templateDraftAvailable)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20templateDraft%20=%20Draft.find(templateDraftUUID);%5Cn%20%20%20%20%20%20%20%20templateContent%20=%20templateDraft.processTemplate(%5C%22[[body]]%5C%22)%5Cn%20%20%20%20%20%20%20%20templateContent%20=%20%5C%22%5C%5Cn%5C%22%20+%20templateContent%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20let%20content%20=%20encodeURIComponent(projectLinkText%20+%20templateContent);%5Cn%5Cn%20%20%20%20var%20cbCreateCraftNote%20=%20CallbackURL.create()%5Cn%20%20%20%20cbCreateCraftNote.baseURL%20=%20craftCreateBaseURL%5Cn%20%20%20%20cbCreateCraftNote.addParameter(%5C%22spaceId%5C%22,%20spaceId)%5Cn%20%20%20%20cbCreateCraftNote.addParameter(%5C%22title%5C%22,%20title)%5Cn%20%20%20%20cbCreateCraftNote.addParameter(%5C%22content%5C%22,%20content)%5Cn%20%20%20%20cbCreateCraftNote.addParameter(%5C%22folderId%5C%22,%20%5C%22%5C%22)%5Cn%20%20%20%20cbCreateCraftNote.waitForResponse%20=%20true%5Cn%5Cn%20%20%20%20let%20craftCreateReturn%20=%20cbCreateCraftNote.open()%5Cn%5Cn%20%20%20%20if%20(craftCreateReturn%20==%20true)%20%7B%5Cn%20%20%20%20%20%20%20%20console.log(%5C%22Craft%20note%20successfully%20created%5C%22)%5Cn%20%20%20%20%20%20%20%20let%20craftCreateResult%20=%20cbCreateCraftNote.callbackResponse%5Cn%20%20%20%20%20%20%20%20var%20craftNoteLink%20=%20craftCreateResult.link%5Cn%5Cn%20%20%20%20%20%20%20%20let%20projectNoteStr%20=%20%5C%22Craft%20Note:%20%5C%22%20+%20craftNoteLink%5Cn%20%20%20%20%20%20%20%20let%20projectTitle%20=%20%5C%22*%20**Craft%20Document:%20[%5C%22%20+%20unencodedTitle%20+%20%5C%22](%5C%22%20+%20craftNoteLink%20+%20%5C%22)**%5C%22%5Cn%20%20%20%20%20%20%20%20return%20projectTitle;%5Cn%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20console.log(%5C%22Craft%20note%20result:%5C%22%20+%20cb.status%20+%20%5C%22%20%5C%22%20+%20cb.callbackResponse)%5Cn%20%20%20%20%20%20%20%20if%20(cb.status%20==%20%5C%22cancelled%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20context.cancel()%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20context.fail()%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20return%5Cn%20%20%20%20%7D%5Cn%5Cn%7D%5Cn%5Cnfunction%20createTaskInTodoistProject(projectContent,%20projectId)%20%7B%5Cn%20%20%20%20//%20create%20the%20task%20in%20todoist%5Cn%20%20%20%20let%20createprojectResponse%20=%20todoist.createTask(%7B%5Cn%20%20%20%20%20%20%20%20%5C%22content%5C%22:%20projectContent,%5Cn%20%20%20%20%20%20%20%20%5C%22project_id%5C%22:%20projectId%5Cn%20%20%20%20%7D)%5Cn%5Cn%20%20%20%20if%20(!createprojectResponse)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20message%20=%20%5C%22Failed%20to%20add%20project%20to%20todoist:%20%5C%22%20+%20todoist.lastError;%5Cn%20%20%20%20%20%20%20%20console.log(message)%5Cn%20%20%20%20%20%20%20%20context.fail(message);%5Cn%20%20%20%20%20%20%20%20app.displayErrorMessage(message);%5Cn%20%20%20%20%20%20%20%20return%20false;%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20let%20message%20=%20%5C%22successfully%20added%20project%20in%20todoist%20with%20content:%20%5C%22%20+%20projectContent%20+%20%5C%22to%20project%20with%20id:%20%5C%22%20+%20projectId;%5Cn%20%20%20%20%20%20%20%20console.log(message)%5Cn%20%20%20%20%20%20%20%20//%20return%20relevant%20parameters%20of%20the%5Cn%20%20%20%20%20%20%20%20return%20true;%5Cn%20%20%20%20%7D%5Cn%7D%5Cn%5Cnfunction%20getCraftSpaceIdToUse()%20%7B%5Cn%20%20%20%20let%20credential%20=%20Credential.create(%5C%22CraftDocumentSpace%5C%22,%20%5C%22Credential%20to%20store%20the%20spaceId%20of%20the%20space%20you%20want%20to%20use%20in%20Drafts.%5C%5Cninsert%20your%20spaceId%20into%20the%20TextField%20below.%20%5C%5Cn%5C%5CnNOTES:%20%5C%5Cn-%20this%20is%20a%20one%20time%20action,%20you%20don&#39;t%20need%20to%20do%20it%20everytime%5C%5Cn-%20Multiple%20spaces%20are%20currently%20not%20supported%20with%20this%20spaceId%20credential%20helper%5C%22);%5Cn%20%20%20%20credential.addTextField(%5C%22spaceId%5C%22,%20%5C%22spaceId%5C%22);%5Cn%20%20%20%20if%20(credential.authorize())%20%7B%5Cn%20%20%20%20%20%20%20%20return%20credential.getValue(%5C%22spaceId%5C%22);%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20let%20errorStr%20=%20%5C%22failed%20storing%20/%20retrieving%20space%20Id%20with%20credential%5C%22%5Cn%20%20%20%20%20%20%20%20app.displayErrorMessage(errorStr);%5Cn%20%20%20%20%20%20%20%20context.fail(errorStr);%5Cn%20%20%20%20%20%20%20%20console.log(errorStr);%5Cn%20%20%20%20%20%20%20%20return%20false;%5Cn%20%20%20%20%7D%5Cn%7D%22,%22allowAsync%22:%22false%22%7D,%22type%22:%22script%22,%22isEnabled%22:true,%22uuid%22:%2218938A9B-1349-4740-9CF7-E9044BC1A354%22%7D],%22backingPlatforms%22:3,%22shortName%22:%22%22,%22shouldConfirm%22:false,%22disposition%22:3,%22keyCommand%22:%7B%22optionKey%22:false,%22input%22:%22%22,%22controlKey%22:false,%22commandKey%22:false,%22type%22:%22action%22,%22discoverabilityTitle%22:%22crosslink%20Todoist%20project%20%5Cu0026%20Craft%20document%22,%22shiftKey%22:false%7D,%22logLevel%22:2,%22groupDisposition%22:0,%22notificationType%22:2,%22tintColor%22:%22violet%22,%22actionDescription%22:%22*created%20by%20[@FlohGro](https://twitter.com/FlohGro)%20/%20more%20on%20my%20[Blog](http://www.flohgro.com/blog)*%5Cn%5Cn%23%23%20crosslink%20Todoist%20project%20%5Cu0026%20Craft%20document%5Cn%5CnThis%20action%20will%20create%20a%20cross-linked%20project%20between%20Todoist%20and%20Craft.%5Cn%5CnThe%20new%20project%20in%20Todoist%20will%20contain%20a%20link%20to%20the%20document%20in%20Craft%20and%20vice-versa.%20%5Cn%5CnThe%20document%20in%20Craft%20will%20be%20created%20from%20a%20configurable%20template%20Draft.%5Cn%5CnRunning%20the%20action%20will%20open%20a%20prompt%20asking%20you%20for%20the%20name%20of%20the%20project%20-%20this%20prompt%20will%20be%20prefilled%20with%20the%20current%20drafts%20content%20but%20you%20can%20set%20any%20name%20you%20like%20(the%20current%20draft%20will%20remain%20unchanged).%5Cn%5Cn*known%20%5C%22issue%5C%22:%20if%20you%20quickly%20open%20the%20link%20to%20the%20Todoist%20project%20after%20the%20action%20prepended%20the%20link%20to%20the%20project%20to%20the%20Craft%20document,%20your%20Todoist%20app%20may%20show%20an%20error%20telling%20you%20that%20the%20project%20could%20not%20be%20found.%20The%20reason%20for%20this%20is,%20that%20Todoist%20needs%20to%20sync%20the%20created%20project%20to%20your%20app%20first.%20After%20the%20project%20was%20synced,%20the%20error%20won&#39;t%20occur%20again.*%5Cn%5Cn%23%23%20[Configuration]%5Cn%5Cn%5CnYou%20need%20to%20follow%20these%20steps%20until%20you%20can%20use%20the%20action.%5Cn%5Cn**Define%20the%20project%20template%20draft**%5Cn%5CnThe%20action%20**can**%20be%20configured%20to%20use%20a%20template%20for%20all%20your%20project%20documents%20(if%20you%20want%20that%20all%20of%20them%20have%20the%20same%20structure).%5Cn%5CnIf%20you%20don%E2%80%99t%20want%20to%20use%20a%20project%20template%20draft%20(the%20created%20Craft%20document%20will%20be%20empty%20besides%20the%20link%20to%20the%20Todoist%20project).%20There%20is%20no%20need%20to%20change%20something%20after%20installing%20the%20action%20since%20the%20template%20usage%20is%20disabled%20by%20default.%5Cn%5CnIf%20you%20want%20to%20use%20a%20template%20for%20the%20project%20document%20in%20Craft,%20create%20a%20new%20draft%20and%20give%20it%20a%20meaningful%20title%20(first%20line)%20and%20maybe%20add%20some%20tags%20to%20the%20draft%20to%20keep%20your%20library%20structured.%5Cn%5CnThen%20setup%20the%20template%20in%20Markdown%20format%20(note%20that%20the%20title%20(first%20line)%20of%20the%20template%20draft%20will%20not%20be%20pushed%20to%20the%20Craft%20document)%5Cn%5CnWhen%20you%20finished%20the%20template%20tap%20the%20%E2%80%9Einfo%E2%80%9C%20button%20in%20the%20[editor](https://docs.getdrafts.com/editor/)%20and%20then%20tap%20the%20button%20titled%20%E2%80%9EUUID%E2%80%9C.%20This%20will%20copy%20the%20UUID%20of%20that%20draft.%5Cn%5CnNext,%20edit%20the%20script%20step%20of%20this%20action%20and%20change%20the%20variable%20in%20line%203%20to%20%60true%60:%20%60const%20templateDraftAvailable%20=%20true;%60.%20Then%20find%20line%205%20%60const%20templateDraftUUID%20=%20%5C%22unconfigured%E2%80%9C;%60%20and%20select%20the%20word%20%60unconfigured%60%20and%20paste%20the%20UUID%20you%20just%20copied%20(attention:%20don&#39;t%20delete%20the%20quotation%20marks).%5Cn%5CnIf%20you%20don%E2%80%99t%20want%20to%20use%20the%20(any%20of%20my)%20action%20for%20different%20Craft%20spaces%20there%20is%20no%20further%20configuration%20needed.%20When%20you%20first%20run%20any%20of%20my%20Craft%20actions%20it%20will%20ask%20you%20to%20store%20the%20space%20id%20of%20your%20Craft%20space.%20This%20is%20a%20one%20time%20action%20and%20you%20don%E2%80%99t%20need%20to%20do%20it%20for%20any%20other%20oof%20my%20Craft%20actions%20you%20install.%5Cn%5CnTo%20retrieve%20your%20spaceId%20just%20copy%20the%20deeplink%20of%20any%20document%20in%20that%20space%20(refer%20to%20the%20[Craft%20Support%20Page](https://support.craft.do/hc/en-us/articles/360020043878-How-to-link-into-a-specific-place-in-Craft-with-a-Deeplink)%20when%20you%20don&#39;t%20know%20how%20to%20do%20that).%20Paste%20the%20copied%20id%20into%20a%20draft%20and%20you%20will%20se%20a%20link%20similar%20to%20this:%20%5C%22craftdocs://open?blockId=[the%20block%20id]%5Cu0026spaceId=[the%20spaceId]%5C%22%20-%20find%20the%20character%20combination%20%5C%22[the%20spaceId]%5C%22%20after%20the%20%5C%22spaceId=%5C%22%20and%20copy%20it%20and%20paste%20it%20into%20the%20prompt%20of%20this%20action.%5Cn%5CnTo%20use%20these%20actions%20with%20different%20spaces%20you%20need%20to%20duplicate%20the%20action%20for%20each%20space%20you%20want%20to%20use%20it.%20I%20recommend%20to%20e.g.%20add%20a%20suffix%20to%20the%20action%20name%20to%20describe%20the%20space%20for%20which%20you%20configure%20it.%20%20%5CnThe%20action%20uses%20Drafts%20possibility%20to%20store%20[credentials](https://docs.getdrafts.com/docs/settings/credentials)%20to%20distinguish%20different%20spaces.%20When%20you%20duplicate%20the%20action%20for%20another%20space%20you%20have%20to%20change%20the%20name%20of%20the%20credential.%20Therefore%20you%20need%20edit%20this%20line%20%60const%20spaceIdCredentialName%20=%20%5C%22CraftDocumentSpace%5C%22%60%20in%20the%20script%20step%20of%20the%20action%20and%20change%20the%20%60CraftDocumentSpace%60%20to%20something%20different%20(e.g.%20describe%20the%20space%20in%20a%20suffix%20like%20%E2%80%9ECraftDocumentSpacePersonal%5C%22%20or%20%E2%80%9ECraftDocumentSpaceWork%E2%80%9C.%20If%20you%20use%20several%20of%20my%20Craft%20actions%20you%20should%20use%20the%20same%20credential%20name%20in%20all%20of%20them.%5Cn%5Cn%23%23%20[Usage]%5Cn%5Cn%5CnAfter%20you%20configured%20the%20action%20properly%20-%20just%20run%20it%20when%20you%20want%20to%20setup%20a%20new%20project%20from%20whatever%20draft%20you%20currently%20opened.%5Cn%5CnThe%20prompt%20will%20appear%20and%20you%20can%20use%20either%20the%20content%20of%20the%20current%20draft%20as%20the%20project%20name%20or%20just%20type%20a%20new%20name.%5Cn%5CnThe%20action%20will%20then%20create%20the%20project%20in%20Todoist,%20retrieve%20its%20id%20and%20create%20a%20new%20craft%20document%20(eventually%20with%20your%20configured%20template)%20and%20link%20that%20project%20in%20the%20document.%20Then%20the%20action%20will%20create%20an%20uncompletable%20task%20in%20the%20new%20Todoist%20project%20containing%20a%20clickable%20link%20to%20the%20project%20document%20in%20Craft.%5Cn%5Cn*note:%20the%20Craft%20document%20will%20actually%20contain%20two%20links%20to%20Todoist.%20The%20name%20of%20the%20project%20will%20be%20a%20link%20which%20can%20be%20used%20on%20mobile%20(iOS%20/%20iPadOS)%20to%20directly%20open%20the%20project%20in%20the%20Todoist%20app.%20the%20%E2%80%9EWebview%E2%80%9C%20link%20is%20necessary%20for%20macOS%20since%20the%20mobile%20url%20is%20not%20working%20properly%20on%20the%20Mac.*%5Cn%5Cn%5Cn---%5Cn%5Cn*If%20you%20find%20this%20useful%20and%20want%20to%20support%20me%20you%20can*%20%5Cn%5Cn%5Cu003ca%20href=%5C%22https://www.buymeacoffee.com/flohgro%5C%22%20target=%5C%22_blank%5C%22%5Cu003e%5Cu003cimg%20src=%5C%22https://cdn.buymeacoffee.com/buttons/v2/default-blue.png%5C%22%20alt=%5C%22Buy%20Me%20A%20Coffee%5C%22%20style=%5C%22height:%2051px%20!important;width:%20209px%20!important;%5C%22%20%5Cu003e%5Cu003c/a%5Cu003e%22,%22keyUseIcon%22:false,%22icon%22:%22circuit-board%22,%22visibility%22:480,%22backingIsSeparator%22:false,%22groupUUID%22:%2225801B11-1228-4E40-A9E9-460EE3D1E84D%22,%22assignTags%22:[],%22name%22:%22crosslink%20Todoist%20project%20%5Cu0026%20Craft%20document%22%7D">Install</a>
</div>

<div>
  <h4>Steps</h4>
<ul class='steps'>
  <li>
    <div class='step'><h3>script</h3><pre><code class='language-javascript'>// is there an additional Draft Template which shall be added as content to the note?
// set this to true if you want to use a template draft / if you don&#39;t want to use a template, then set it to false (no &quot;&quot; around the true / false)
const templateDraftAvailable = false;
// copy the uuid of your template draft for project documents and paste it between the quotation marks
const templateDraftUUID = &quot;unconfigured&quot;;

// ------------------------------------------------------------------------
// END OF CONFIGURATION
// ANY CHANGES BELOW CAN LET THE ACTION FAIL - ONLY CHANGE THINGS IF YOU KNOW WHAT YOU ARE DOING
// ------------------------------------------------------------------------



if (templateDraftAvailable == true &amp;&amp; templateDraftUUID == &quot;unconfigured&quot;) {
    let errStr = &quot;template Draft should be used but uuid is unconfigured, read the description of the action and configure it correctly.&quot;
    context.fail(errStr);
    app.displayErrorMessage(&quot;invalid configuration&quot;);
} else {

    var spaceId = getCraftSpaceIdToUse();
    if (spaceId) {

        // create Todoist object
        var todoist = Todoist.create();

        // define project name
        let newProjectName = setProjectName()

        if (newProjectName) {

            let createdProject = createTodoistProject(newProjectName);

            if (createdProject) {
                let projectLinkStringToDocument = createCraftDocumentAndLinkedprojectString(newProjectName, createdProject[&quot;id&quot;])
                if (projectLinkStringToDocument) {
                    createTaskInTodoistProject(projectLinkStringToDocument, createdProject[&quot;id&quot;])
                }
            }
        } else {
            // do error handling
            context.cancel(&quot;no project name set&quot;);
            app.displayWarningMessage(&quot;aborted; didn&#39;t select a project name&quot;);
        }


    } else {
        // do error handling
        context.cancel(&quot;Craft spaceId is not configured&quot;);
        app.displayWarningMessage(&quot;Craft spaceId is not configured&quot;);
    }
}
// ------------------------------------------------------------------------
// FUNCTIONS
// ------------------------------------------------------------------------


function setProjectName() {
    let projectName = &quot;&quot;;
    if (draft.content.length != 0) {
        projectName = draft.content;
    }
    var p = Prompt.create();
    p.title = &quot;Project Name&quot;;

    p.addTextField(&quot;userProjectName&quot;, &quot;&quot;, projectName, {
        wantsFocus: true
    });

    p.addButton(&quot;Set Project Name&quot;);

    if (p.show()) {

        projectName = p.fieldValues[&quot;userProjectName&quot;]
        return projectName
    } else {
        return false
    }
}


function createTodoistProject(projectName) {

    // create the project in todoist
    let createProjectResponse = todoist.createProject({
        &quot;name&quot;: projectName
    })

    if (!createProjectResponse) {
        let message = &quot;Failed to add project to todoist: &quot; + todoist.lastError;
        console.log(message)
        context.fail(message);
        app.displayErrorMessage(message);
    } else {
        let message = &quot;successfully added project in todoist with name: &quot; + projectName;
        console.log(message)
        // return relevant parameters of the
        return {
            &quot;id&quot;: createProjectResponse[&quot;id&quot;],
            &quot;url&quot;: createProjectResponse[&quot;url&quot;]
        }
    }
}

function createCraftDocumentAndLinkedprojectString(projectName, todoistProjectID) {

    const craftCreateBaseURL = &quot;craftdocs://x-callback-url/createdocument?&quot;;

    const todoistShowProjectUrl = &quot;todoist://project?id=&quot; + todoistProjectID;

	const todoistShowProjectUrlWebView = &quot;https://todoist.com/showProject?id=&quot; + todoistProjectID;
	
    const projectLinkText = &quot;&gt; Project in Todoist: [&quot; + projectName + &quot;](&quot; + todoistShowProjectUrl + &quot;) ([Webview](&quot; + todoistShowProjectUrlWebView + &quot;))&quot;;
    let unencodedTitle = projectName;
    let title = encodeURIComponent(projectName);

    let templateContent = &quot;&quot;;
    if (templateDraftAvailable) {
        let templateDraft = Draft.find(templateDraftUUID);
        templateContent = templateDraft.processTemplate(&quot;[[body]]&quot;)
        templateContent = &quot;\n&quot; + templateContent
    }

    let content = encodeURIComponent(projectLinkText + templateContent);

    var cbCreateCraftNote = CallbackURL.create()
    cbCreateCraftNote.baseURL = craftCreateBaseURL
    cbCreateCraftNote.addParameter(&quot;spaceId&quot;, spaceId)
    cbCreateCraftNote.addParameter(&quot;title&quot;, title)
    cbCreateCraftNote.addParameter(&quot;content&quot;, content)
    cbCreateCraftNote.addParameter(&quot;folderId&quot;, &quot;&quot;)
    cbCreateCraftNote.waitForResponse = true

    let craftCreateReturn = cbCreateCraftNote.open()

    if (craftCreateReturn == true) {
        console.log(&quot;Craft note successfully created&quot;)
        let craftCreateResult = cbCreateCraftNote.callbackResponse
        var craftNoteLink = craftCreateResult.link

        let projectNoteStr = &quot;Craft Note: &quot; + craftNoteLink
        let projectTitle = &quot;* **Craft Document: [&quot; + unencodedTitle + &quot;](&quot; + craftNoteLink + &quot;)**&quot;
        return projectTitle;

    } else {
        console.log(&quot;Craft note result:&quot; + cb.status + &quot; &quot; + cb.callbackResponse)
        if (cb.status == &quot;cancelled&quot;) {
            context.cancel()
        } else {
            context.fail()
        }
        return
    }

}

function createTaskInTodoistProject(projectContent, projectId) {
    // create the task in todoist
    let createprojectResponse = todoist.createTask({
        &quot;content&quot;: projectContent,
        &quot;project_id&quot;: projectId
    })

    if (!createprojectResponse) {
        let message = &quot;Failed to add project to todoist: &quot; + todoist.lastError;
        console.log(message)
        context.fail(message);
        app.displayErrorMessage(message);
        return false;
    } else {
        let message = &quot;successfully added project in todoist with content: &quot; + projectContent + &quot;to project with id: &quot; + projectId;
        console.log(message)
        // return relevant parameters of the
        return true;
    }
}

function getCraftSpaceIdToUse() {
    let credential = Credential.create(&quot;CraftDocumentSpace&quot;, &quot;Credential to store the spaceId of the space you want to use in Drafts.\ninsert your spaceId into the TextField below. \n\nNOTES: \n- this is a one time action, you don&#39;t need to do it everytime\n- Multiple spaces are currently not supported with this spaceId credential helper&quot;);
    credential.addTextField(&quot;spaceId&quot;, &quot;spaceId&quot;);
    if (credential.authorize()) {
        return credential.getValue(&quot;spaceId&quot;);
    } else {
        let errorStr = &quot;failed storing / retrieving space Id with credential&quot;
        app.displayErrorMessage(errorStr);
        context.fail(errorStr);
        console.log(errorStr);
        return false;
    }
}</code></pre></div>
  </li>
</ul>
</div>

<div>
  <h4>Options</h4>
  <ul class="steps">
    <li>
  <table class='action-detail'>
    <tr>
      <td class="cell-label">After Success</td>
      <td class="value">
        Default
        
      </td>
    </tr>
    <tr>
      <td class="cell-label">Notification</td>
      <td class="value">Info</td>
    </tr>
    <tr>
      <td class="cell-label">Log Level</td>
      <td class="value">Info</td>
    </tr>
  </table>
</li>
</ul>
</div>

<div class="disclaimer">
  Items available in the Drafts Directory are uploaded by community members. Use appropriate caution reviewing downloaded items before use.
</div>


                  </div>
                  <div class="footer-content">
                  <p>
                  <a href="https://itunes.apple.com/app/id1236254471?ls=1&mt=8&at=11l4Cf&ct=site">
                    <img alt="Download on App Store" src="../assets/appstore-deaf597bd57239c5054c59099e54ab9014f1e15eddb961085428e0ce94d4385b.svg" />
                  </a>
                  <a href="https://itunes.apple.com/app/id1435957248?mt=12&at=11l4Cf&ct=site">
                    <img alt="Download on Mac App Store" src="../assets/macappstore-05f5eed00e6bb26b68c1368217276158329862682e6d61b3ed193f819fe02f2f.svg" />
                  </a>
                  </p>
                    &copy; 2012-2022 by Agile Tortoise, Inc.<br/>
                    Drafts is a registered Trademark of Agile Tortoise, Inc.<br/>
                    <a href="../../getdrafts.com/support/privacy.html">Privacy</a> | <a href="../../getdrafts.com/support/terms.html">Terms</a>
                </div>
                </div>
            </div>
        </div>
    </div>

  </body>
  </html>
