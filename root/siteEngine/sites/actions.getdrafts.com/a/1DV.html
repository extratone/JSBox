<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Things Parser | Drafts Directory</title>
    <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="App0h0QsaioSBccc2kFLkeKPaI6NLquDsmgwRZIgR7lxhVINIEfNz51VfEyOAhCPRSy2dXP+4SWfGWI8u9jZSw==" />
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta http-equiv="content-language" content="en">
    <meta http-equiv="content-language" content="en-us">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta property="og:title" content="Drafts Directory: Things Parser" />
    <meta property="og:url" content="https://actions.getdrafts.com/a/1DV" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="Example actions and other extensions for Drafts, the quick-capture notes app." />
    <meta property="og:image" content="https://actions.getdrafts.com/assets/drafts-ogimage-action-d9c60102fd45e0cb516e1b49ed50a81e3c3a2b90f81f55df8f43d0feb0512978.png" />
    <meta property="twitter:title" content="Drafts Directory: Things Parser" />
    <meta property="twitter:url" content="https://actions.getdrafts.com/a/1DV" />
    <meta property="twitter:type" content="website" />
    <meta property="twitter:description" content="Example actions and other extensions for Drafts, the quick-capture notes app." />
    <meta property="twitter:image" content="https://actions.getdrafts.com/assets/drafts-ogimage-action-d9c60102fd45e0cb516e1b49ed50a81e3c3a2b90f81f55df8f43d0feb0512978.png" />

    <link rel="shortcut icon" type="image/x-icon" href="../assets/favicon-114dbb66b0ef0399a14fa5dfcad7e6210bb558c30cea665e04d49b59fec87f70.png" />

    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/default.min.css">
    <link rel="stylesheet" media="all" href="../assets/application-6e4f014b4c48cd673942dbfbbeb3e571a732b05562ddde5904f3a5c3833e54ff.css" />
    <script src="../assets/application-13492939cb10be5be76b5abb3e9ae0bef0bbae3202cec2b85cf6fca5bc8429c8.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script async defer data-domain="directory.getdrafts.com" src="https://plausible.io/js/plausible.js"></script>
  </head>

<body data-no-turbolink>

    <div class="page-wrap">
        <div class="side-bar">
            <a href="https://actions.getdrafts.com/index.html" class="site-title fs-6 lh-tight" title="{{ site.title }}">
                <img src="../assets/drafts-directory-header-4d826bd007f515c8e5a10f654e56ad76fbb3bd3103a67ce342283f701f1677fe.svg" alt="Drafts Directory" style="max-height: 30px;" />
            </a>
            <span class="fs-3"><button class="js-main-nav-trigger navigation-list-toggle btn btn-outline" type="button"
                    data-text-toggle="Hide">Menu</button></span>
            <div class="navigation main-nav js-main-nav">
              <ul class="navigation-list">
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://actions.getdrafts.com/index.html">Home</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://actions.getdrafts.com/drafts_actions.html">Actions</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://actions.getdrafts.com/drafts_action_groups.html">Action Groups</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://actions.getdrafts.com/syntax_definitions.html">Syntaxes</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://actions.getdrafts.com/theme_definitions.html">Themes</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://actions.getdrafts.com/workspaces.html">Workspaces</a>
                </li>
                <li class="navigation-list-item">
                  <hr style="margin:1em; padding: 0;" />
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://actions.getdrafts.com/search.html">Search</a>
                </li>
                <li class="navigation-list-item">
                  <hr style="margin:1em; padding: 0;" />
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="About Drafts" href="https://actions.getdrafts.com/getdrafts.com/index.html">Get Drafts &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Detailed documentation" href="https://actions.getdrafts.com/docs.getdrafts.com/index.html">User Guide &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Get your questions answered in the forums" href="https://forums.getdrafts.com/">Community &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Online tools and generators" href="https://actions.getdrafts.com/tools.getdrafts.com/index.html">Tools &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Scripting library reference" href="https://actions.getdrafts.com/scripting.getdrafts.com/index.html">Script Reference &#x2192;</a>
                </li>
              </ul>
            </div>
            <footer role="contentinfo" class="site-footer">
                <p class="text-small text-grey-dk-000 mb-0">
                    Download: <a href="https://itunes.apple.com/app/id1236254471?ls=1&mt=8&at=11l4Cf&ct=site">iOS</a> | <a href="https://itunes.apple.com/app/id1435957248?mt=12&at=11l4Cf&ct=site">Mac</a>
                </p>
            </footer>
        </div>
        <div class="main-content-wrap js-main-content" tabindex="0">
            <div class="page-header">
                <div class="main-content">
                    <div class="search js-search">
	<div class="search-input-wrap">
<form class="search-form" action="https://actions.getdrafts.com/search.html" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
	<button style='border:none;background-color:transparent;'>
	<svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"
		class="search-icon">
		<title>Search</title>
		<g fill-rule="nonzero">
			<path
				d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z" />
			<path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z" />
		</g>
	</svg>
	</button>
	<input type="text" name="q" id="q" class="js-search-input search-input search" size="12" tabindex="0" placeholder="Search" />
</form>	</div>
</div>
                    <ul class="list-style-none text-small mt-md-1 mb-md-1 pb-4 pb-md-0 js-aux-nav aux-nav">
                        <li class="d-inline-block my-0 mr-2">
                          <a href="https://actions.getdrafts.com/getdrafts.com/index.html">Get Drafts</a>
                        </li>
                        <li class="d-inline-block my-0">
                          <a href="https://forums.getdrafts.com">Community</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="main-content">
                <div id="main-content" class="page-content" role="main">
                  <div class="type">
                    <h4>Action</h4>
                  </div>
                  <div class="header">
                      <h1><img src="https://config.agiletortoise.com/drafts-icons/inbox-full.png" class="action-icon" />Things Parser</h1>
                  </div>

                  <div class="content">
                    
<div class='caption'>
        Posted by @pdavisonreiber,
    Last update
    over 1 year ago
</div>


    <div class='description'>
        <p>Things Parser 3 turns TaskPaper documents into Things tasks and projects. See below for examples of the syntax, or <a href="https://polymaths.blog/2020/12/things-parser-3-for-drafts">read my blog post</a> for more details.</p>

<p>In addition, to this, it also allows the use of variables using the <a href="https://actions.getdrafts.com/a/1fT.html">Mustache Prompt</a> system, which you can read about in <a href="https://polymaths.blog/2020/12/mustache-prompt-for-drafts">this blog post</a>.</p>

<p><strong>Update 2020-12-22:</strong> Now supports multi-line notes for tasks and projects.</p>

<p><em>For Things Parser 2 (legacy version) <a href="https://actions.getdrafts.com/a/1fU.html">see here</a>.</em></p>

<h3>Tasks</h3>

<pre><code>- Tasks outside projects
- with date @when(2020-12-13)
- alternatively @defer(2020-12-13)
- with natural language date @when(tomorrow)

- with deadline @deadline(2020-12-25)
- alternatively @due(2020-12-25)

- Canceled task @canceled
- British cancelled task @cancelled

- Tasks can be @done
- Or @completed

- Tasks can be assigned to a @list(name)
- alternatively @project(name)
- or using list ID @listID(id)
- and within a project to a @heading(name)

- Tasks can have a @tag(name)
- Or more than one @tags(tag1, tag2, tag3)

- Tasks can have notes
    which are indented text
- And subtasks
    - which are indented tasks
    - like this
</code></pre>

<h3>Projects</h3>

<pre><code>Projects can have dates too: @when(today)
    - also supports @defer(today)

They can have deadlines: @deadline(2020-12-25)
    - also supports @due(2020-12-25)

They can be: @canceled
    - or if they are British @cancelled

They can be: @completed
    - or @done

They can be assigned to an: @area(name)

Or using an id: @areaID(id)

They can have a: @tag(name)
    - or multiple @tags(tag1, tag2, tag3)

They can have notes:
    which are indented text

They can obviously have tasks:
    - like this one
    - and this one

But they can also have headings:
    which are written like sub-projects:
        - and tasks within the headings will be added to those headings
</code></pre>

    </div>

<div class="certification">
  
  <a class='trusted' href='https://actions.getdrafts.com/a/1dV.html#' title='From trusted community member'><img style="width:24px;height:24px;vertical-align:middle;" src="../assets/trusted-c3f95628f768e0a0ed09961d556a8012d1b1be6ae9e6adede683513eec0df814.svg" /> Trusted member</a>
</div>

<div style="margin: 2em 0;">
    <a class="btn btn-blue" href="drafts5://action?identifier=1DV&amp;data=%7B%22uuid%22:%22B5EC4F1E-C448-4D7C-80CD-9617F96E9074%22,%22steps%22:[%7B%22platforms%22:3,%22data%22:%7B%22script%22:%22function%20libraryIsInstalled(name)%20%7B%5Cn%20%20let%20fm%20=%20FileManager.createCloud()%5Cn%20%20if%20(fm.readString(%5C%22/Library/Scripts/%5C%22%20+%20name))%20%7B%5Cn%20%20%20%20return%20true%5Cn%20%20%7D%20else%20%7B%5Cn%20%20%20%20return%20false%5Cn%20%20%7D%5Cn%7D%5Cn%5CnHTTP.prototype.getContent%20=%20function(url)%20%7B%5Cn%20%20let%20r%20=%20this.request(%7B%5C%22url%5C%22:%20url,%20%5C%22method%5C%22:%20%5C%22GET%5C%22%7D)%5Cn%20%20if%20(r.success)%20%7B%5Cn%20%20%20%20return%20r.responseText%5Cn%20%20%7D%20else%20%7B%5Cn%20%20%20%20alert(%5C%22Error%20%5C%22%20+%20r.statusCode%20+%20%5C%22:%20%5C%22%20+%20r.error)%5Cn%20%20%7D%5Cn%7D%5Cn%5CnHTTP.prototype.downloadLibrary%20=%20function(url,%20filename)%20%7B%5Cn%20%20let%20fm%20=%20FileManager.createCloud()%5Cn%20%20let%20path%20=%20%5C%22/Library/Scripts/%5C%22%20+%20filename%5Cn%20%20let%20content%20=%20this.getContent(url)%5Cn%20%20if%20(content)%20%7B%5Cn%20%20%20%20fm.writeString(path,%20content)%5Cn%20%20%20%20return%20true%5Cn%20%20%7D%20else%20%7B%5Cn%20%20%20%20return%20false%5Cn%20%20%7D%5Cn%7D%5Cn%5Cnconst%20url%20=%20%5C%22https://raw.githubusercontent.com/pdavisonreiber/Public-Drafts-Scripts/master/Things%2520Parser%25203/birchoutline.js%5C%22%5Cn%5Cnif%20(libraryIsInstalled(%5C%22birchoutline.js%5C%22))%20%7B%5Cn%20%20require(%5C%22birchoutline.js%5C%22)%5Cn%7D%20else%20%7B%5Cn%20%20let%20p1%20=%20Prompt.create()%5Cn%20%20p1.title%20=%20%5C%22Confirm%20Download%5C%22%5Cn%20%20p1.message%20=%20%5C%22Things%20Parser%203%20requires%20the%20installation%20of%20the%20Birch%20Outline%20library.%20Press%20OK%20to%20download.%5C%22%5Cn%20%20p1.addButton(%5C%22OK%5C%22)%5Cn%20%20%5Cn%20%20if%20(p1.show())%20%7B%5Cn%20%20%20%20let%20http%20=%20HTTP.create()%5Cn%20%20%20%20let%20success%20=%20http.downloadLibrary(url,%20%5C%22birchoutline.js%5C%22)%5Cn%20%20%20%20%5Cn%20%20%20%20if%20(success)%20%7B%5Cn%20%20%20%20%20%20let%20p2%20=%20Prompt.create()%5Cn%20%20%20%20%20%20p2.isCancellable%20=%20false%5Cn%20%20%20%20%20%20p2.title%20=%20%5C%22Success%5C%22%5Cn%20%20%20%20%20%20p2.message%20=%20%5C%22Birch%20Outline%20successfully%20installed%20to%20iCloud/Drafts/Library/Scripts/birchoutline.js%5C%22%5Cn%20%20%20%20%20%20p2.addButton(%5C%22OK%5C%22)%5Cn%20%20%20%20%20%20p2.show()%5Cn%20%20%20%20%20%20require(%5C%22birchoutline.js%5C%22)%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%7D%22,%22allowAsync%22:%22false%22%7D,%22type%22:%22script%22,%22isEnabled%22:true,%22uuid%22:%225E067FB2-54E9-41B2-8FDD-43B5C195082A%22%7D,%7B%22platforms%22:3,%22data%22:%7B%22script%22:%22function%20mustachePrompt(text,%20dateFormat)%20%7B%5Cn%20%20dateFormat%20=%20(dateFormat%20===%20undefined)%20?%20%5C%22%25Y-%25m-%25d%5C%22%20:%20dateFormat%5Cn%20%20%5Cn%20%20const%20variableRegex%20=%20/%7B%7B(?:(date%7Cbool):)?(%23%7C%5E)?(%5C%5Cw+)%5C%5C??([+%7C-]%5C%5Cd+[d%7Cw%7Cm])?%7D%7D/g%5Cn%20%20const%20variableMatches%20=%20text.matchAll(variableRegex)%5Cn%20%20%5Cn%20%20variables%20=%20%7B%7D%5Cn%20%20%5Cn%20%20for%20(match%20of%20variableMatches)%20%7B%5Cn%20%20%20%20let%20instance%20=%20new%20Object()%5Cn%20%20%20%20instance.string%20=%20match[0]%5Cn%20%20%20%20instance.type%20=%20match[1]%5Cn%20%20%20%20instance.modifier%20=%20match[2]%5Cn%20%20%20%20instance.name%20=%20match[3]%5Cn%20%20%20%20instance.offset%20=%20match[4]%5Cn%20%20%20%20%5Cn%20%20%20%20if%20(!variables.hasOwnProperty(instance.name))%20%7B%5Cn%20%20%20%20%20%20let%20variable%20=%20new%20Object()%5Cn%20%20%20%20%20%20variable.type%20=%20instance.type%5Cn%20%20%20%20%20%20variable.modifier%20=%20instance.modifier%5Cn%20%20%20%20%20%20variable.instances%20=%20[instance]%5Cn%20%20%20%20%20%20variables[instance.name]%20=%20variable%5Cn%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20variables[instance.name].instances.push(instance)%5Cn%20%20%20%20%20%20if%20(!variables[instance.name].type)%20%7B%5Cn%20%20%20%20%20%20%20%20variables[instance.name].type%20=%20instance.type%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20if%20(!variables[instance.name].modifier)%20%7B%5Cn%20%20%20%20%20%20%20%20variables[instance.name].modifier%20=%20instance.modifier%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20//alert(JSON.stringify(variables))%5Cn%20%20%5Cn%20%20let%20p%20=%20Prompt.create()%5Cn%20%20%5Cn%20%20for%20(name%20in%20variables)%20%7B%5Cn%20%20%20%20let%20variable%20=%20variables[name]%5Cn%20%20%20%20%5Cn%20%20%20%20if%20(!variable.type)%20%7B%5Cn%20%20%20%20%20%20p.addTextField(name,%20name,%20%5C%22%5C%22)%5Cn%20%20%20%20%7D%20else%20if%20(variable.type%20==%20%5C%22date%5C%22)%20%7B%5Cn%20%20%20%20%20%20p.addDatePicker(name,%20name,%20new%20Date(),%20%7Bmode:%20%5C%22date%5C%22%7D)%5Cn%20%20%20%20%7D%20else%20if%20(variable.type%20==%20%5C%22bool%5C%22)%20%7B%5Cn%20%20%20%20%20%20p.addSwitch(name,%20name,%20false)%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20p.addButton(%5C%22OK%5C%22)%5Cn%20%20data%20=%20%7B%7D%5Cn%20%20%5Cn%20%20let%20cancel%20=%20true%5Cn%20%20if%20(Object.keys(variables).length%20!==%200)%20%7B%5Cn%20%20%20%20cancel%20=%20!p.show()%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20if%20(!cancel)%20%7B%5Cn%20%20%20%20for%20(key%20in%20p.fieldValues)%20%7B%5Cn%20%20%20%20%20%20let%20fieldValue%20=%20p.fieldValues[key]%5Cn%20%20%20%20%20%20if%20(fieldValue%20instanceof%20Date)%20%7B%5Cn%20%20%20%20%20%20%20%20data[key]%20=%20strftime(fieldValue,%20dateFormat)%5Cn%20%20%20%20%20%20%7D%20else%20if%20(typeof%20fieldValue%20==%20%5C%22string%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20if%20(fieldValue.includes(%5C%22,%5C%22)%20%5Cu0026%5Cu0026%20variables[key].modifier%20==%20%5C%22%23%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20data[key]%20=%20fieldValue.split(%5C%22,%5C%22).map(s%20=%5Cu003e%20s.trim())%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20data[key]%20=%20fieldValue%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20data[key]%20=%20fieldValue%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%5Cn%20%20%20%20%20%20for%20(instance%20of%20variables[key].instances)%20%7B%5Cn%20%20%20%20%20%20%20%20if%20(!instance.type%20%5Cu0026%5Cu0026%20!instance.offset)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20continue%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20if%20(instance.offset)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20text%20=%20text.replace(instance.string,%20instance.string.replace(instance.type%20+%20%5C%22:%5C%22,%20%5C%22%5C%22).replace(instance.offset,%20snakify(instance.offset)))%5Cn%20%20%20%20%20%20%20%20%20%20data[key%20+%20snakify(instance.offset)]%20=%20offsetDate(fieldValue,%20instance.offset,%20dateFormat)%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20text%20=%20text.replace(instance.string,%20instance.string.replace(instance.type%20+%20%5C%22:%5C%22,%20%5C%22%5C%22))%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%20%20//alert(JSON.stringify(data,%202))%5Cn%20%20%20%20%5Cn%20%20%20%20let%20template%20=%20MustacheTemplate.createWithTemplate(text)%5Cn%20%20%20%20let%20result%20=%20template.render(data)%5Cn%20%20%20%20return%20result%5Cn%20%20%20%20%5Cn%20%20%7D%20else%20%7B%5Cn%20%20%20%20context.cancel()%5Cn%20%20%7D%20%20%5Cn%7D%5Cn%5Cnfunction%20offsetDate(date,%20string,%20dateFormat)%20%7B%5Cn%20%20let%20d%20=%20new%20Date(date)%5Cn%20%20let%20offsetRegex%20=%20/(%5C%5C+%7C-)(%5C%5Cd+)(d%7Cw%7Cm)/%5Cn%20%20let%20match%20=%20string.match(offsetRegex)%5Cn%20%20let%20multiplier%20=%20(match[1]%20==%20%5C%22+%5C%22%20?%201%20:%20-1)%5Cn%20%20%5Cn%20%20if%20(match[3]%20==%20%5C%22d%5C%22)%20%7B%5Cn%20%20%20%20d.setDate(d.getDate()%20+%20multiplier%20*%20parseInt(match[2]))%5Cn%20%20%7D%20else%20if%20(match[3]%20==%20%5C%22w%5C%22)%20%7B%5Cn%20%20%20%20d.setDate(d.getDate()%20+%20multiplier%20*%207%20*%20parseInt(match[2]))%5Cn%20%20%7D%20else%20if%20(match[3]%20==%20%5C%22m%5C%22)%20%7B%5Cn%20%20%20%20d%20=%20addMonths(d,%20multiplier%20*%20parseInt(match[2]))%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20return%20strftime(d,%20dateFormat)%5Cn%7D%5Cn%5Cnfunction%20addMonths(date,%20months)%20%7B%5Cn%20%20var%20d%20=%20date.getDate();%5Cn%20%20date.setMonth(date.getMonth()%20+%20+months);%5Cn%20%20if%20(date.getDate()%20!=%20d)%20%7B%5Cn%20%20%20%20date.setDate(0);%5Cn%20%20%7D%5Cn%20%20return%20date;%5Cn%7D%5Cn%5Cnfunction%20snakify(offset)%20%7B%5Cn%20%20return%20offset.replace(%5C%22+%5C%22,%20%5C%22_offset_forward_%5C%22).replace(%5C%22-%5C%22,%20%5C%22_offset_backwards_%5C%22)%5Cn%7D%22,%22allowAsync%22:%22false%22%7D,%22type%22:%22script%22,%22isEnabled%22:true,%22uuid%22:%220F5CE548-15DE-4F72-9E32-2373C3510573%22%7D,%7B%22platforms%22:3,%22data%22:%7B%22script%22:%22let%20text%20=%20draft.content%5Cn%5Cnif%20(text.includes(%5C%22%7B%7B%5C%22))%20%7B%5Cn%20%20let%20mustache%20=%20mustachePrompt(text)%5Cn%20%20if%20(mustache)%20%7B%5Cn%20%20%20%20text%20=%20mustache%5Cn%20%20%7D%5Cn%7D%5Cn%5Cn%5Cnvar%20taskPaperOutline%20=%20new%20birchoutline.Outline.createTaskPaperOutline(draft.processTemplate(text))%5Cnvar%20rootChildren%20=%20taskPaperOutline.root.children%5Cn%5Cnvar%20tjsArray%20=%20[]%5Cn%5Cnfor%20(child%20of%20rootChildren)%20%7B%5Cn%20%20if%20(child.getAttribute(%5C%22data-type%5C%22)%20==%20%5C%22project%5C%22)%20%7B%5Cn%20%20%20%20tjsArray.push(processProject(child))%5Cn%20%20%7D%20else%20if%20(child.getAttribute(%5C%22data-type%5C%22)%20==%20%5C%22task%5C%22)%20%7B%5Cn%20%20%20%20tjsArray.push(processTask(child))%5Cn%20%20%7D%5Cn%7D%5Cn%5Cnvar%20container%20=%20TJSContainer.create(tjsArray)%5Cn%5Cnvar%20cb%20=%20CallbackURL.create()%5Cncb.baseURL%20=%20container.url%5Cncb.addParameter(%5C%22reveal%5C%22,%20true)%5Cnif%20(text%20%5Cu0026%5Cu0026%20tjsArray.length%20!=%200)%20%7B%5Cn%20%20app.openURL(cb.url)%5Cn%7D%20else%20%7B%5Cn%20%20context.cancel()%5Cn%7D%5Cn%5Cnfunction%20processSubTask(item)%20%7B%5Cn%20%20var%20subtask%20=%20TJSChecklistItem.create()%5Cn%20%20subtask.title%20=%20item.bodyContentString.trim()%5Cn%20%20subtask.canceled%20=%20item.hasAttribute(%5C%22data-canceled%5C%22)%20%7C%7C%20item.hasAttribute(%5C%22data-cancelled%5C%22)%5Cn%20%20subtask.completed%20=%20item.hasAttribute(%5C%22data-completed%5C%22)%20%7C%7C%20item.hasAttribute(%5C%22data-done%5C%22)%5Cn%20%20return%20subtask%5Cn%7D%5Cn%5Cnfunction%20processTask(item)%20%7B%5Cn%20%20var%20task%20=%20TJSTodo.create()%5Cn%20%20task.title%20=%20item.bodyContentString.trim()%5Cn%20%20%5Cn%20%20if%20(item.hasAttribute(%5C%22data-when%5C%22))%20%7B%5Cn%20%20%20%20task.when%20=%20item.getAttribute(%5C%22data-when%5C%22)%20%20%5Cn%20%20%7D%20else%20if%20(item.hasAttribute(%5C%22data-defer%5C%22))%20%7B%5Cn%20%20%20%20task.when%20=%20item.getAttribute(%5C%22data-defer%5C%22)%20%20%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20if%20(item.hasAttribute(%5C%22data-due%5C%22))%20%7B%5Cn%20%20%20%20task.deadline%20=%20item.getAttribute(%5C%22data-due%5C%22)%20%20%5Cn%20%20%7D%20else%20if%20(item.hasAttribute(%5C%22data-deadline%5C%22))%20%7B%5Cn%20%20%20%20task.deadline%20=%20item.getAttribute(%5C%22data-deadline%5C%22)%20%20%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20task.canceled%20=%20item.hasAttribute(%5C%22data-canceled%5C%22)%20%7C%7C%20item.hasAttribute(%5C%22data-cancelled%5C%22)%5Cn%20%20task.completed%20=%20item.hasAttribute(%5C%22data-completed%5C%22)%20%7C%7C%20item.hasAttribute(%5C%22data-done%5C%22)%5Cn%20%20%5Cn%20%20if%20(item.hasAttribute(%5C%22data-heading%5C%22))%20%7B%5Cn%20%20%20%20task.heading%20=%20item.getAttribute(%5C%22data-heading%5C%22)%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20if%20(item.hasAttribute(%5C%22data-list%5C%22))%20%7B%5Cn%20%20%20%20task.list%20=%20item.getAttribute(%5C%22data-list%5C%22)%5Cn%20%20%7D%20else%20if%20(item.hasAttribute(%5C%22data-project%5C%22))%20%7B%5Cn%20%20%20%20task.list%20=%20item.getAttribute(%5C%22data-project%5C%22)%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20if%20(item.hasAttribute(%5C%22data-listID%5C%22))%20%7B%5Cn%20%20%20%20task.listID%20=%20item.getAttribute(%5C%22data-listID%5C%22)%5Cn%20%20%7D%20else%20if%20(item.hasAttribute(%5C%22data-listid%5C%22))%20%7B%5Cn%20%20%20%20task.listID%20=%20item.getAttribute(%5C%22data-listid%5C%22)%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20if%20(item.hasAttribute(%5C%22data-tag%5C%22))%20%7B%5Cn%20%20%20%20task.tags%20=%20[item.getAttribute(%5C%22data-tag%5C%22)]%5Cn%20%20%7D%20else%20if%20(item.hasAttribute(%5C%22data-tags%5C%22))%20%7B%5Cn%20%20%20%20task.tags%20=%20item.getAttribute(%5C%22data-tags%5C%22).split(%5C%22,%5C%22).map(t%20=%5Cu003e%20t.trim())%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20if%20(item.hasChildren)%20%7B%5Cn%20%20%20%20for%20(child%20of%20item.children)%20%7B%5Cn%20%20%20%20%20%20if%20(child.getAttribute(%5C%22data-type%5C%22)%20==%20%5C%22task%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20task.addChecklistItem(processSubTask(child))%20%5Cn%20%20%20%20%20%20%7D%20else%20if%20(child.getAttribute(%5C%22data-type%5C%22)%20==%20%5C%22note%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20if%20(task.notes)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20task.notes%20+=%20%5C%22%5C%5Cn%5C%22%20+%20child.bodyContentString%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20task.notes%20=%20child.bodyContentString%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20return%20task%5Cn%7D%5Cn%5Cnfunction%20processHeading(item)%20%7B%5Cn%20%20var%20heading%20=%20TJSHeading.create()%5Cn%20%20heading.title%20=%20item.bodyContentString.trim()%5Cn%20%20heading.archived%20=%20item.hasAttribute(%5C%22data-archived%5C%22)%20%7C%7C%20item.hasAttribute(%5C%22data-done%5C%22)%5Cn%20%20%5Cn%20%20return%20heading%5Cn%7D%5Cn%5Cnfunction%20processProject(item)%20%7B%5Cn%20%20var%20project%20=%20TJSProject.create()%5Cn%20%20project.title%20=%20item.bodyContentString.trim()%5Cn%20%20%5Cn%20%20if%20(item.hasAttribute(%5C%22data-when%5C%22))%20%7B%5Cn%20%20%20%20project.when%20=%20item.getAttribute(%5C%22data-when%5C%22)%20%20%5Cn%20%20%7D%20else%20if%20(item.hasAttribute(%5C%22data-defer%5C%22))%20%7B%5Cn%20%20%20%20project.when%20=%20item.getAttribute(%5C%22data-defer%5C%22)%20%20%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20if%20(item.hasAttribute(%5C%22data-due%5C%22))%20%7B%5Cn%20%20%20%20project.deadline%20=%20item.getAttribute(%5C%22data-due%5C%22)%20%20%5Cn%20%20%7D%20else%20if%20(item.hasAttribute(%5C%22data-deadline%5C%22))%20%7B%5Cn%20%20%20%20project.deadline%20=%20item.getAttribute(%5C%22data-deadline%5C%22)%20%20%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20project.canceled%20=%20item.hasAttribute(%5C%22data-canceled%5C%22)%20%7C%7C%20item.hasAttribute(%5C%22data-cancelled%5C%22)%5Cn%20%20project.completed%20=%20item.hasAttribute(%5C%22data-completed%5C%22)%20%7C%7C%20item.hasAttribute(%5C%22data-done%5C%22)%5Cn%20%20%5Cn%20%20if%20(item.hasAttribute(%5C%22data-area%5C%22))%20%7B%5Cn%20%20%20%20project.area%20=%20item.getAttribute(%5C%22data-area%5C%22)%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20if%20(item.hasAttribute(%5C%22data-areaID%5C%22))%20%7B%5Cn%20%20%20%20project.areaID%20=%20item.getAttribute(%5C%22data-areaID%5C%22)%5Cn%20%20%7D%20else%20if%20(item.hasAttribute(%5C%22data-areaid%5C%22))%20%7B%5Cn%20%20%20%20project.areaID%20=%20item.getAttribute(%5C%22data-areaid%5C%22)%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20if%20(item.hasAttribute(%5C%22data-tag%5C%22))%20%7B%5Cn%20%20%20%20project.tags%20=%20[item.getAttribute(%5C%22data-tag%5C%22)]%5Cn%20%20%7D%20else%20if%20(item.hasAttribute(%5C%22data-tags%5C%22))%20%7B%5Cn%20%20%20%20project.tags%20=%20item.getAttribute(%5C%22data-tags%5C%22).split(%5C%22,%5C%22).map(t%20=%5Cu003e%20t.trim())%5Cn%20%20%7D%5Cn%20%20%5Cn%20%20if%20(item.hasChildren)%20%7B%20%5Cn%20%20%20%20%5Cn%20%20%20%20for%20(child%20of%20item.children)%20%7B%5Cn%20%20%20%20%20%20if%20(child.getAttribute(%5C%22data-type%5C%22)%20==%20%5C%22task%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20project.addTodo(processTask(child))%20%5Cn%20%20%20%20%20%20%7D%20else%20if%20(child.getAttribute(%5C%22data-type%5C%22)%20==%20%5C%22note%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20if%20(project.notes)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20project.notes%20+=%20%5C%22%5C%5Cn%5C%22%20+%20child.bodyContentString%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20project.notes%20=%20child.bodyContentString%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%20else%20if%20(child.getAttribute(%5C%22data-type%5C%22)%20==%20%5C%22project%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20let%20heading%20=%20processHeading(child)%5Cn%20%20%20%20%20%20%20%20project.addHeading(heading)%5Cn%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%20%20%20%20if%20(child.hasChildren)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20for%20(grandchild%20of%20child.children)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if%20(grandchild.getAttribute(%5C%22data-type%5C%22)%20==%20%5C%22task%5C%22)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20task%20=%20processTask(grandchild)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20task.heading%20=%20heading.title%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20project.addTodo(task)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20return%20project%5Cn%20%20%5Cn%7D%5Cn%20%20%22,%22allowAsync%22:%22false%22%7D,%22type%22:%22script%22,%22isEnabled%22:true,%22uuid%22:%223CB6C09F-87A8-44AD-9D2F-54867E187F72%22%7D],%22groupDisposition%22:0,%22shortName%22:%22%22,%22shouldConfirm%22:false,%22disposition%22:1,%22keyCommand%22:%7B%22optionKey%22:false,%22input%22:%22%22,%22controlKey%22:false,%22commandKey%22:false,%22type%22:%22action%22,%22discoverabilityTitle%22:%22Things%20Parser%22,%22shiftKey%22:false%7D,%22logLevel%22:2,%22notificationType%22:2,%22tintColor%22:%22orange%22,%22actionDescription%22:%22Things%20Parser%203%20turns%20TaskPaper%20documents%20into%20Things%20tasks%20and%20projects.%20See%20below%20for%20examples%20of%20the%20syntax,%20or%20[read%20my%20blog%20post](https://polymaths.blog/2020/12/things-parser-3-for-drafts)%20for%20more%20details.%5Cn%5CnIn%20addition,%20to%20this,%20it%20also%20allows%20the%20use%20of%20variables%20using%20the%20[Mustache%20Prompt](https://actions.getdrafts.com/a/1fT)%20system,%20which%20you%20can%20read%20about%20in%20[this%20blog%20post](https://polymaths.blog/2020/12/mustache-prompt-for-drafts).%5Cn%5Cn_For%20Things%20Parser%202%20(legacy%20version)%20[see%20here](https://actions.getdrafts.com/a/1fU)._%5Cn%5Cn%23%23%23%20Tasks%5Cn%60%60%60%5Cn-%20Tasks%20outside%20projects%5Cn-%20with%20date%20@when(2020-12-13)%5Cn-%20alternatively%20@defer(2020-12-13)%5Cn-%20with%20natural%20language%20date%20@when(tomorrow)%5Cn%5Cn-%20with%20deadline%20@deadline(2020-12-25)%5Cn-%20alternatively%20@due(2020-12-25)%5Cn%5Cn-%20Canceled%20task%20@canceled%5Cn-%20British%20cancelled%20task%20@cancelled%5Cn%5Cn-%20Tasks%20can%20be%20@done%5Cn-%20Or%20@completed%5Cn%5Cn-%20Tasks%20can%20be%20assigned%20to%20a%20@list(name)%5Cn-%20alternatively%20@project(name)%5Cn-%20or%20using%20list%20ID%20@listID(id)%5Cn-%20and%20within%20a%20project%20to%20a%20@heading(name)%5Cn%5Cn-%20Tasks%20can%20have%20a%20@tag(name)%5Cn-%20Or%20more%20than%20one%20@tags(tag1,%20tag2,%20tag3)%5Cn%5Cn-%20Tasks%20can%20have%20notes%5Cn%5Ctwhich%20are%20intended%20text%5Cn-%20And%20subtasks%5Cn%5Ct-%20which%20are%20intended%20tasks%5Cn%5Ct-%20like%20this%5Cn%60%60%60%5Cn%5Cn%23%23%23%20Projects%5Cn%60%60%60%5CnProjects%20can%20have%20dates%20too:%20@when(today)%5Cn%5Ct-%20also%20supports%20@defer(today)%5Cn%5CnThey%20can%20have%20deadlines:%20@deadline(2020-12-25)%5Cn%5Ct-%20also%20supports%20@due(2020-12-25)%5Cn%5CnThey%20can%20be:%20@canceled%5Cn%5Ct-%20or%20if%20they%20are%20British%20@cancelled%5Cn%5CnThey%20can%20be:%20@completed%5Cn%5Ct-%20or%20@done%5Cn%5CnThey%20can%20be%20assigned%20to%20an:%20@area(name)%5Cn%5CnOr%20using%20an%20id:%20@areaID(id)%5Cn%5CnThey%20can%20have%20a:%20@tag(name)%5Cn%5Ct-%20or%20multiple%20@tags(tag1,%20tag2,%20tag3)%5Cn%5CnThey%20can%20have%20notes:%5Cn%5Ctwhich%20are%20indented%20text%5Cn%5CnThey%20can%20obviously%20have%20tasks:%5Cn%5Ct-%20like%20this%20one%5Cn%5Ct-%20and%20this%20one%5Cn%5CnBut%20they%20can%20also%20have%20headings:%5Cn%5Ctwhich%20are%20written%20like%20sub-projects:%5Cn%5Ct%5Ct-%20and%20tasks%20within%20the%20headings%20will%20be%20added%20to%20those%20headings%5Cn%60%60%60%5Cn%22,%22keyUseIcon%22:false,%22icon%22:%22inbox-full%22,%22visibility%22:224,%22groupUUID%22:%225EA63C8E-32CB-49DA-BC70-D9EF5CF1502A%22,%22assignTags%22:[],%22name%22:%22Things%20Parser%22%7D">Install</a>
</div>

<div>
  <h4>Steps</h4>
<ul class='steps'>
  <li>
    <div class='step'><h3>script</h3><pre><code class='language-javascript'>function libraryIsInstalled(name) {
  let fm = FileManager.createCloud()
  if (fm.readString(&quot;/Library/Scripts/&quot; + name)) {
    return true
  } else {
    return false
  }
}

HTTP.prototype.getContent = function(url) {
  let r = this.request({&quot;url&quot;: url, &quot;method&quot;: &quot;GET&quot;})
  if (r.success) {
    return r.responseText
  } else {
    alert(&quot;Error &quot; + r.statusCode + &quot;: &quot; + r.error)
  }
}

HTTP.prototype.downloadLibrary = function(url, filename) {
  let fm = FileManager.createCloud()
  let path = &quot;/Library/Scripts/&quot; + filename
  let content = this.getContent(url)
  if (content) {
    fm.writeString(path, content)
    return true
  } else {
    return false
  }
}

const url = &quot;https://raw.githubusercontent.com/pdavisonreiber/Public-Drafts-Scripts/master/Things%20Parser%203/birchoutline.js&quot;

if (libraryIsInstalled(&quot;birchoutline.js&quot;)) {
  require(&quot;birchoutline.js&quot;)
} else {
  let p1 = Prompt.create()
  p1.title = &quot;Confirm Download&quot;
  p1.message = &quot;Things Parser 3 requires the installation of the Birch Outline library. Press OK to download.&quot;
  p1.addButton(&quot;OK&quot;)
  
  if (p1.show()) {
    let http = HTTP.create()
    let success = http.downloadLibrary(url, &quot;birchoutline.js&quot;)
    
    if (success) {
      let p2 = Prompt.create()
      p2.isCancellable = false
      p2.title = &quot;Success&quot;
      p2.message = &quot;Birch Outline successfully installed to iCloud/Drafts/Library/Scripts/birchoutline.js&quot;
      p2.addButton(&quot;OK&quot;)
      p2.show()
      require(&quot;birchoutline.js&quot;)
    }
  }
}</code></pre></div>
  </li>
  <li>
    <div class='step'><h3>script</h3><pre><code class='language-javascript'>function mustachePrompt(text, dateFormat) {
  dateFormat = (dateFormat === undefined) ? &quot;%Y-%m-%d&quot; : dateFormat
  
  const variableRegex = /{{(?:(date|bool):)?(#|^)?(\w+)\??([+|-]\d+[d|w|m])?}}/g
  const variableMatches = text.matchAll(variableRegex)
  
  variables = {}
  
  for (match of variableMatches) {
    let instance = new Object()
    instance.string = match[0]
    instance.type = match[1]
    instance.modifier = match[2]
    instance.name = match[3]
    instance.offset = match[4]
    
    if (!variables.hasOwnProperty(instance.name)) {
      let variable = new Object()
      variable.type = instance.type
      variable.modifier = instance.modifier
      variable.instances = [instance]
      variables[instance.name] = variable
    } else {
      variables[instance.name].instances.push(instance)
      if (!variables[instance.name].type) {
        variables[instance.name].type = instance.type
      }
      if (!variables[instance.name].modifier) {
        variables[instance.name].modifier = instance.modifier
      }
    }
  }
  
  //alert(JSON.stringify(variables))
  
  let p = Prompt.create()
  
  for (name in variables) {
    let variable = variables[name]
    
    if (!variable.type) {
      p.addTextField(name, name, &quot;&quot;)
    } else if (variable.type == &quot;date&quot;) {
      p.addDatePicker(name, name, new Date(), {mode: &quot;date&quot;})
    } else if (variable.type == &quot;bool&quot;) {
      p.addSwitch(name, name, false)
    }
  }
  
  p.addButton(&quot;OK&quot;)
  data = {}
  
  let cancel = true
  if (Object.keys(variables).length !== 0) {
    cancel = !p.show()
  }
  
  if (!cancel) {
    for (key in p.fieldValues) {
      let fieldValue = p.fieldValues[key]
      if (fieldValue instanceof Date) {
        data[key] = strftime(fieldValue, dateFormat)
      } else if (typeof fieldValue == &quot;string&quot;) {
        if (fieldValue.includes(&quot;,&quot;) &amp;&amp; variables[key].modifier == &quot;#&quot;) {
          data[key] = fieldValue.split(&quot;,&quot;).map(s =&gt; s.trim())
        } else {
          data[key] = fieldValue
        }
      } else {
        data[key] = fieldValue
      }
      
      for (instance of variables[key].instances) {
        if (!instance.type &amp;&amp; !instance.offset) {
          continue
        }
        
        if (instance.offset) {
          text = text.replace(instance.string, instance.string.replace(instance.type + &quot;:&quot;, &quot;&quot;).replace(instance.offset, snakify(instance.offset)))
          data[key + snakify(instance.offset)] = offsetDate(fieldValue, instance.offset, dateFormat)
        } else {
          text = text.replace(instance.string, instance.string.replace(instance.type + &quot;:&quot;, &quot;&quot;))
        }
      }
    }
    //alert(JSON.stringify(data, 2))
    
    let template = MustacheTemplate.createWithTemplate(text)
    let result = template.render(data)
    return result
    
  } else {
    context.cancel()
  }  
}

function offsetDate(date, string, dateFormat) {
  let d = new Date(date)
  let offsetRegex = /(\+|-)(\d+)(d|w|m)/
  let match = string.match(offsetRegex)
  let multiplier = (match[1] == &quot;+&quot; ? 1 : -1)
  
  if (match[3] == &quot;d&quot;) {
    d.setDate(d.getDate() + multiplier * parseInt(match[2]))
  } else if (match[3] == &quot;w&quot;) {
    d.setDate(d.getDate() + multiplier * 7 * parseInt(match[2]))
  } else if (match[3] == &quot;m&quot;) {
    d = addMonths(d, multiplier * parseInt(match[2]))
  }
  
  return strftime(d, dateFormat)
}

function addMonths(date, months) {
  var d = date.getDate();
  date.setMonth(date.getMonth() + +months);
  if (date.getDate() != d) {
    date.setDate(0);
  }
  return date;
}

function snakify(offset) {
  return offset.replace(&quot;+&quot;, &quot;_offset_forward_&quot;).replace(&quot;-&quot;, &quot;_offset_backwards_&quot;)
}</code></pre></div>
  </li>
  <li>
    <div class='step'><h3>script</h3><pre><code class='language-javascript'>let text = draft.content

if (text.includes(&quot;{{&quot;)) {
  let mustache = mustachePrompt(text)
  if (mustache) {
    text = mustache
  }
}


var taskPaperOutline = new birchoutline.Outline.createTaskPaperOutline(draft.processTemplate(text))
var rootChildren = taskPaperOutline.root.children

var tjsArray = []

for (child of rootChildren) {
  if (child.getAttribute(&quot;data-type&quot;) == &quot;project&quot;) {
    tjsArray.push(processProject(child))
  } else if (child.getAttribute(&quot;data-type&quot;) == &quot;task&quot;) {
    tjsArray.push(processTask(child))
  }
}

var container = TJSContainer.create(tjsArray)

var cb = CallbackURL.create()
cb.baseURL = container.url
cb.addParameter(&quot;reveal&quot;, true)
if (text &amp;&amp; tjsArray.length != 0) {
  app.openURL(cb.url)
} else {
  context.cancel()
}

function processSubTask(item) {
  var subtask = TJSChecklistItem.create()
  subtask.title = item.bodyContentString.trim()
  subtask.canceled = item.hasAttribute(&quot;data-canceled&quot;) || item.hasAttribute(&quot;data-cancelled&quot;)
  subtask.completed = item.hasAttribute(&quot;data-completed&quot;) || item.hasAttribute(&quot;data-done&quot;)
  return subtask
}

function processTask(item) {
  var task = TJSTodo.create()
  task.title = item.bodyContentString.trim()
  
  if (item.hasAttribute(&quot;data-when&quot;)) {
    task.when = item.getAttribute(&quot;data-when&quot;)  
  } else if (item.hasAttribute(&quot;data-defer&quot;)) {
    task.when = item.getAttribute(&quot;data-defer&quot;)  
  }
  
  if (item.hasAttribute(&quot;data-due&quot;)) {
    task.deadline = item.getAttribute(&quot;data-due&quot;)  
  } else if (item.hasAttribute(&quot;data-deadline&quot;)) {
    task.deadline = item.getAttribute(&quot;data-deadline&quot;)  
  }
  
  task.canceled = item.hasAttribute(&quot;data-canceled&quot;) || item.hasAttribute(&quot;data-cancelled&quot;)
  task.completed = item.hasAttribute(&quot;data-completed&quot;) || item.hasAttribute(&quot;data-done&quot;)
  
  if (item.hasAttribute(&quot;data-heading&quot;)) {
    task.heading = item.getAttribute(&quot;data-heading&quot;)
  }
  
  if (item.hasAttribute(&quot;data-list&quot;)) {
    task.list = item.getAttribute(&quot;data-list&quot;)
  } else if (item.hasAttribute(&quot;data-project&quot;)) {
    task.list = item.getAttribute(&quot;data-project&quot;)
  }
  
  if (item.hasAttribute(&quot;data-listID&quot;)) {
    task.listID = item.getAttribute(&quot;data-listID&quot;)
  } else if (item.hasAttribute(&quot;data-listid&quot;)) {
    task.listID = item.getAttribute(&quot;data-listid&quot;)
  }
  
  if (item.hasAttribute(&quot;data-tag&quot;)) {
    task.tags = [item.getAttribute(&quot;data-tag&quot;)]
  } else if (item.hasAttribute(&quot;data-tags&quot;)) {
    task.tags = item.getAttribute(&quot;data-tags&quot;).split(&quot;,&quot;).map(t =&gt; t.trim())
  }
  
  if (item.hasChildren) {
    for (child of item.children) {
      if (child.getAttribute(&quot;data-type&quot;) == &quot;task&quot;) {
       task.addChecklistItem(processSubTask(child)) 
      } else if (child.getAttribute(&quot;data-type&quot;) == &quot;note&quot;) {
        if (task.notes) {
          task.notes += &quot;\n&quot; + child.bodyContentString
        } else {
          task.notes = child.bodyContentString
        }
      }
    }
  }
  return task
}

function processHeading(item) {
  var heading = TJSHeading.create()
  heading.title = item.bodyContentString.trim()
  heading.archived = item.hasAttribute(&quot;data-archived&quot;) || item.hasAttribute(&quot;data-done&quot;)
  
  return heading
}

function processProject(item) {
  var project = TJSProject.create()
  project.title = item.bodyContentString.trim()
  
  if (item.hasAttribute(&quot;data-when&quot;)) {
    project.when = item.getAttribute(&quot;data-when&quot;)  
  } else if (item.hasAttribute(&quot;data-defer&quot;)) {
    project.when = item.getAttribute(&quot;data-defer&quot;)  
  }
  
  if (item.hasAttribute(&quot;data-due&quot;)) {
    project.deadline = item.getAttribute(&quot;data-due&quot;)  
  } else if (item.hasAttribute(&quot;data-deadline&quot;)) {
    project.deadline = item.getAttribute(&quot;data-deadline&quot;)  
  }
  
  project.canceled = item.hasAttribute(&quot;data-canceled&quot;) || item.hasAttribute(&quot;data-cancelled&quot;)
  project.completed = item.hasAttribute(&quot;data-completed&quot;) || item.hasAttribute(&quot;data-done&quot;)
  
  if (item.hasAttribute(&quot;data-area&quot;)) {
    project.area = item.getAttribute(&quot;data-area&quot;)
  }
  
  if (item.hasAttribute(&quot;data-areaID&quot;)) {
    project.areaID = item.getAttribute(&quot;data-areaID&quot;)
  } else if (item.hasAttribute(&quot;data-areaid&quot;)) {
    project.areaID = item.getAttribute(&quot;data-areaid&quot;)
  }
  
  if (item.hasAttribute(&quot;data-tag&quot;)) {
    project.tags = [item.getAttribute(&quot;data-tag&quot;)]
  } else if (item.hasAttribute(&quot;data-tags&quot;)) {
    project.tags = item.getAttribute(&quot;data-tags&quot;).split(&quot;,&quot;).map(t =&gt; t.trim())
  }
  
  if (item.hasChildren) { 
    
    for (child of item.children) {
      if (child.getAttribute(&quot;data-type&quot;) == &quot;task&quot;) {
       project.addTodo(processTask(child)) 
      } else if (child.getAttribute(&quot;data-type&quot;) == &quot;note&quot;) {
        if (project.notes) {
          project.notes += &quot;\n&quot; + child.bodyContentString
        } else {
          project.notes = child.bodyContentString
        }
      } else if (child.getAttribute(&quot;data-type&quot;) == &quot;project&quot;) {
        let heading = processHeading(child)
        project.addHeading(heading)
        
        if (child.hasChildren) {
          for (grandchild of child.children) {
            if (grandchild.getAttribute(&quot;data-type&quot;) == &quot;task&quot;) {
              let task = processTask(grandchild)
              task.heading = heading.title
              project.addTodo(task)
            }
          }
        }
      }
    }
  }
  return project
  
}
  </code></pre></div>
  </li>
</ul>
</div>

<div>
  <h4>Options</h4>
  <ul class="steps">
    <li>
  <table class='action-detail'>
    <tr>
      <td class="cell-label">After Success</td>
      <td class="value">
        Archive
        
      </td>
    </tr>
    <tr>
      <td class="cell-label">Notification</td>
      <td class="value">Info</td>
    </tr>
    <tr>
      <td class="cell-label">Log Level</td>
      <td class="value">Info</td>
    </tr>
  </table>
</li>
</ul>
</div>

<div class="disclaimer">
  Items available in the Drafts Directory are uploaded by community members. Use appropriate caution reviewing downloaded items before use.
</div>


                  </div>
                  <div class="footer-content">
                  <p>
                  <a href="https://itunes.apple.com/app/id1236254471?ls=1&mt=8&at=11l4Cf&ct=site">
                    <img alt="Download on App Store" src="../assets/appstore-deaf597bd57239c5054c59099e54ab9014f1e15eddb961085428e0ce94d4385b.svg" />
                  </a>
                  <a href="https://itunes.apple.com/app/id1435957248?mt=12&at=11l4Cf&ct=site">
                    <img alt="Download on Mac App Store" src="../assets/macappstore-05f5eed00e6bb26b68c1368217276158329862682e6d61b3ed193f819fe02f2f.svg" />
                  </a>
                  </p>
                    &copy; 2012-2022 by Agile Tortoise, Inc.<br/>
                    Drafts is a registered Trademark of Agile Tortoise, Inc.<br/>
                    <a href="https://actions.getdrafts.com/getdrafts.com/support/privacy.html">Privacy</a> | <a href="https://actions.getdrafts.com/getdrafts.com/support/terms.html">Terms</a>
                </div>
                </div>
            </div>
        </div>
    </div>

  </body>
  </html>
