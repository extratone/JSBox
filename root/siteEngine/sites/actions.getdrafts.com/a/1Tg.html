<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Double Bracket Search | Drafts Directory</title>
    <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="7DLLVV8kBkLboqb4OBEpE+3oF1gKAZNLa8pZRB7lTBWfLe3fO0+hp1TyHahsUnINSkvJo/TR2e1Guws9Nx3S5w==" />
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta http-equiv="content-language" content="en">
    <meta http-equiv="content-language" content="en-us">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta property="og:title" content="Drafts Directory: Double Bracket Search" />
    <meta property="og:url" content="https://actions.getdrafts.com/a/1Tg" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="Example actions and other extensions for Drafts, the quick-capture notes app." />
    <meta property="og:image" content="https://actions.getdrafts.com/assets/drafts-ogimage-action-d9c60102fd45e0cb516e1b49ed50a81e3c3a2b90f81f55df8f43d0feb0512978.png" />
    <meta property="twitter:title" content="Drafts Directory: Double Bracket Search" />
    <meta property="twitter:url" content="https://actions.getdrafts.com/a/1Tg" />
    <meta property="twitter:type" content="website" />
    <meta property="twitter:description" content="Example actions and other extensions for Drafts, the quick-capture notes app." />
    <meta property="twitter:image" content="https://actions.getdrafts.com/assets/drafts-ogimage-action-d9c60102fd45e0cb516e1b49ed50a81e3c3a2b90f81f55df8f43d0feb0512978.png" />

    <link rel="shortcut icon" type="image/x-icon" href="../assets/favicon-114dbb66b0ef0399a14fa5dfcad7e6210bb558c30cea665e04d49b59fec87f70.png" />

    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/default.min.css">
    <link rel="stylesheet" media="all" href="../assets/application-6e4f014b4c48cd673942dbfbbeb3e571a732b05562ddde5904f3a5c3833e54ff.css" />
    <script src="../assets/application-13492939cb10be5be76b5abb3e9ae0bef0bbae3202cec2b85cf6fca5bc8429c8.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script async defer data-domain="directory.getdrafts.com" src="https://plausible.io/js/plausible.js"></script>
  </head>

<body data-no-turbolink>

    <div class="page-wrap">
        <div class="side-bar">
            <a href="../index.html" class="site-title fs-6 lh-tight" title="{{ site.title }}">
                <img src="../assets/drafts-directory-header-4d826bd007f515c8e5a10f654e56ad76fbb3bd3103a67ce342283f701f1677fe.svg" alt="Drafts Directory" style="max-height: 30px;" />
            </a>
            <span class="fs-3"><button class="js-main-nav-trigger navigation-list-toggle btn btn-outline" type="button"
                    data-text-toggle="Hide">Menu</button></span>
            <div class="navigation main-nav js-main-nav">
              <ul class="navigation-list">
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="../index.html">Home</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="../drafts_actions.html">Actions</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="../drafts_action_groups.html">Action Groups</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="../syntax_definitions.html">Syntaxes</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="../theme_definitions.html">Themes</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="../workspaces.html">Workspaces</a>
                </li>
                <li class="navigation-list-item">
                  <hr style="margin:1em; padding: 0;" />
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="../search.html">Search</a>
                </li>
                <li class="navigation-list-item">
                  <hr style="margin:1em; padding: 0;" />
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="About Drafts" href="../../getdrafts.com/index.html">Get Drafts &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Detailed documentation" href="../../docs.getdrafts.com/index.html">User Guide &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Get your questions answered in the forums" href="https://forums.getdrafts.com/">Community &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Online tools and generators" href="../../tools.getdrafts.com/index.html">Tools &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Scripting library reference" href="../../scripting.getdrafts.com/index.html">Script Reference &#x2192;</a>
                </li>
              </ul>
            </div>
            <footer role="contentinfo" class="site-footer">
                <p class="text-small text-grey-dk-000 mb-0">
                    Download: <a href="https://itunes.apple.com/app/id1236254471?ls=1&mt=8&at=11l4Cf&ct=site">iOS</a> | <a href="https://itunes.apple.com/app/id1435957248?mt=12&at=11l4Cf&ct=site">Mac</a>
                </p>
            </footer>
        </div>
        <div class="main-content-wrap js-main-content" tabindex="0">
            <div class="page-header">
                <div class="main-content">
                    <div class="search js-search">
	<div class="search-input-wrap">
<form class="search-form" action="../search.html" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
	<button style='border:none;background-color:transparent;'>
	<svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"
		class="search-icon">
		<title>Search</title>
		<g fill-rule="nonzero">
			<path
				d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z" />
			<path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z" />
		</g>
	</svg>
	</button>
	<input type="text" name="q" id="q" class="js-search-input search-input search" size="12" tabindex="0" placeholder="Search" />
</form>	</div>
</div>
                    <ul class="list-style-none text-small mt-md-1 mb-md-1 pb-4 pb-md-0 js-aux-nav aux-nav">
                        <li class="d-inline-block my-0 mr-2">
                          <a href="../../getdrafts.com/index.html">Get Drafts</a>
                        </li>
                        <li class="d-inline-block my-0">
                          <a href="https://forums.getdrafts.com">Community</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="main-content">
                <div id="main-content" class="page-content" role="main">
                  <div class="type">
                    <h4>Action</h4>
                  </div>
                  <div class="header">
                      <h1><img src="https://config.agiletortoise.com/drafts-icons/search.png" class="action-icon" />Double Bracket Search</h1>
                  </div>

                  <div class="content">
                    
<div class='caption'>
        Posted by David_Crandall,
    Last update
    about 3 years ago
</div>


    <div class='description'>
        <h1>Description</h1>

<p>This action is an advanced search function meant to mimic the double bracket searching found in applications like nvALT and Bear. Note however, it overrides the double bracket search if any text is selected and prompts for a search term if no other conditions are found.</p>

<h1>Search Order</h1>

<p>The search order is as follows:</p>

<ol>
<li>If a selection is made, search for that</li>
<li>If no selection is made but one double bracket exists, search for that</li>
<li>If multiple double brackets exist, prompt for which one to search</li>
<li>Else, prompt for a search term</li>
</ol>

<h1>Recommendation</h1>

<p>I recommend mapping this action to a hot key combo like command+alt+F. It makes it easier to use quickly. At least, that’s what I’ve done.</p>

    </div>

<div class="certification">
  
  
</div>

<div style="margin: 2em 0;">
    <a class="btn btn-blue" href="drafts5://action?identifier=1Tg&amp;data=%7B%22uuid%22:%22A112356D-F75B-4D68-9FA7-367A821FDAE6%22,%22steps%22:[%7B%22platforms%22:3,%22data%22:%7B%22script%22:%22//%20Double%20Bracket%20Search%5Cn//%20Search%20for%20selected%20text%20first,%20then%20double%20brackets%5Cn%5Cn//%20Modifiable%20parameters%5Cnlet%20workspaceName%20=%20%5C%22[[?]]%5C%22;%20//%20Name%20of%20the%20search%20workspace%5Cnlet%20tagFilter%20=%20%5C%22!script%5C%22;%20//%20tag%20filters;%20use%20%5C%22!%5C%22%20to%20omit%20tags%5Cn%5Cn//%20Identify%20selection%5Cnvar%20sel%20=%20editor.getSelectedText();%5Cnvar%20selRange%20=%20editor.getSelectedRange();%5Cnvar%20dContent%20=%20draft.content;%5Cn%5Cn//%20Bracket%20Regex%5Cnconst%20findRegex%20=%20/%5C%5C[%5C%5C[(.*?)%5C%5C]%5C%5C]/g;%20//%20%20/(%5C%5C[%5C%5C[)([0-9]%7B1,8%7D)(%5C%5C]%5C%5C])/g;%5Cnvar%20findRegexS%20=%20String(findRegex);%5Cnvar%20matches%20=%20dContent.match(findRegex)%5Cnvar%20search%20=%20String(matches);%5Cn%5Cn//%20Search%20scenarios%5Cn//%201.%20Use%20selection%20if%20available%5Cnif%20(sel.length%20%5Cu003e%200)%20%7B%5Cn%5Ctvar%20queryTerm%20=%20sel;%5Cn%5Ct%7D%5Cn%5Cn//%202.%20Look%20for%20double%20brackets%5Cnelse%20if%20(matches%20!==%20null)%20%7B%5Cn%5Ct//%202a.%20If%20multiple%20sets%20of%20double%20brackets,%20prompt%20for%20which%20one%20to%20search%5Cn%5Ctif%20(matches.length%20%5Cu003e%201)%20%7B%5Cn%5Ct%5Ctvar%20p%20=%20Prompt.create();%5Cn%5Ct%5Ctp.title%20=%20%5C%22Choose%5C%22;%5Cn%5Ct%5Ctp.message%20=%20%5C%22Pick%20a%20phrase%20to%20search%20for%5C%22;%5Cn%5Cn%5Ct%5Ct//%20Parse%20multiple%20brackets%20into%20separate%20options%20for%20prompt%5Cn%5Ct%5Ctfor(i=0;%20i%5Cu003cmatches.length;%20i++)%20%7B%5Cn%5Ct%5Ct%5Ctp.addButton(matches[i])%5Cn%5Ct%5Ct%5Ct%7D%5Cn%5Cn%5Ct%5Ct//%20Show%20prompt%5Cn%5Ct%5Ctp.show();%5Cn%5Ct%5Ctvar%20queryTerm%20=%20p.buttonPressed;%5Cn%5Ct%5CtqueryTerm%20=%20queryTerm.substring(2,%20queryTerm.length%20-%202);%5Cn%5Ct%5Ct%7D%5Cn%5Cn%5Ct//%202b.%20If%20only%20one%20set%20of%20double%20brackets,%20skip%20prompt%5Cn%5Ctelse%20if%20(matches.length%20==%201)%20%7B%5Cn%5Ct%5Ctvar%20queryTerm%20=%20search.substring(2,%20search.length%20-%202);%5Cn%5Ct%5Ct%7D%5Cn%7D%5Cn%5Cn//%203.%20If%20no%20selection%20and%20no%20double%20brackets,%20prompt%20for%20search%20term%5Cnelse%20if%20(!sel%20%7C%7C%20sel.length%20==%200)%20%7B%5Cn%5Ctvar%20p%20=%20Prompt.create();%5Cn%5Ctp.title%20=%20%5C%22Search%5C%22;%5Cn%5Ctp.message%20=%20%5C%22Enter%20your%20search%20terms%5C%22;%5Cn%5Ctp.addTextField(%5C%22searchTerms%5C%22,%20%5C%22Terms%5C%22,%20%5C%22%5C%22);%5Cn%5Ctp.addButton(%5C%22Search%5C%22);%5Cn%5Ct//p.isCancellable%20=%20false;%20%20%5Cu003c--%20Kill%20this%20too%5Cn%5Ctp.show();%5Cn%5Ct%5Cn%5Ctvar%20queryTerm%20=%20p.fieldValues[%5C%22searchTerms%5C%22];%5Cn%5Ct%7D%5Cn%5Ct%5Cn//%204.%20Should%20never%20reach%20this%20point%20BUT%20lets%20you%20know%20if%20a%20scenario%20was%20missed%5Cnelse%20%7B%5Cn%5Ctalert(%5C%22Something%20went%20wrong.%20:(%5C%22);%5Cn%5Ctvar%20queryTerm%20=%20%5C%22%5C%22;%5Cn%7D%5Cn%5Cnlet%20queryString%20=%20queryTerm;%5Cn%5Cn//%20Create%20temporary%20search%20workspace%5Cnlet%20ws%20=%20Workspace.create();%5Cnws.name%20=%20workspaceName;%5Cnws.tagFilter%20=%20tagFilter;%5Cnws.queryString%20=%20queryString;%5Cnws.setInboxSort(%5C%22created%5C%22,%20true);%5Cnws.showPreview%20=%20false;%5Cnws.showLastAction%20=%20false;%5Cn%5Cnapp.applyWorkspace(ws);%5Cnapp.showDraftList();%22%7D,%22type%22:%22script%22,%22isEnabled%22:true,%22uuid%22:%220467FD8F-C87A-42A1-A714-A361AAFC83B4%22%7D],%22backingPlatforms%22:3,%22shortName%22:%22%22,%22shouldConfirm%22:false,%22disposition%22:3,%22keyCommand%22:%7B%22optionKey%22:false,%22input%22:%22%22,%22controlKey%22:false,%22commandKey%22:false,%22type%22:%22action%22,%22discoverabilityTitle%22:%22Double%20Bracket%20Search%22,%22shiftKey%22:false%7D,%22logLevel%22:2,%22groupDisposition%22:0,%22notificationType%22:2,%22tintColor%22:%22none%22,%22actionDescription%22:%22%23%20Description%5Cn%5CnThis%20action%20is%20an%20advanced%20search%20function%20meant%20to%20mimic%20the%20double%20bracket%20searching%20found%20in%20applications%20like%20nvALT%20and%20Bear.%20Note%20however,%20it%20overrides%20the%20double%20bracket%20search%20if%20any%20text%20is%20selected.%20%5Cn%5Cn%23%20Search%20Order%5CnThe%20search%20order%20is%20as%20follows:%5Cn%5Cn1.%20If%20a%20selection%20is%20made,%20search%20for%20that%5Cn2.%20If%20no%20selection%20is%20made%20but%20one%20double%20bracket%20exists,%20search%20for%20that%5Cn3.%20If%20multiple%20double%20brackets%20exist,%20prompt%20for%20which%20one%20to%20search%5Cn4.%20Else,%20prompt%20for%20a%20search%20term%22,%22keyUseIcon%22:false,%22icon%22:%22search%22,%22visibility%22:2,%22backingIsSeparator%22:false,%22groupUUID%22:%22657D430F-02C6-4E8F-9D42-79B00838ABAB%22,%22assignTags%22:[],%22name%22:%22Double%20Bracket%20Search%22%7D">Install</a>
</div>

<div>
  <h4>Steps</h4>
<ul class='steps'>
  <li>
    <div class='step'><h3>script</h3><pre><code class='language-javascript'>// Double Bracket Search
// Search for selected text first, then double brackets

// Modifiable parameters
let workspaceName = &quot;[[?]]&quot;; // Name of the search workspace
let tagFilter = &quot;!script&quot;; // tag filters; use &quot;!&quot; to omit tags

// Identify selection
var sel = editor.getSelectedText();
var selRange = editor.getSelectedRange();
var dContent = draft.content;

// Bracket Regex
const findRegex = /\[\[(.*?)\]\]/g; //  /(\[\[)([0-9]{1,8})(\]\])/g;
var findRegexS = String(findRegex);
var matches = dContent.match(findRegex)
var search = String(matches);

// Search scenarios
// 1. Use selection if available
if (sel.length &gt; 0) {
	var queryTerm = sel;
	}

// 2. Look for double brackets
else if (matches !== null) {
	// 2a. If multiple sets of double brackets, prompt for which one to search
	if (matches.length &gt; 1) {
		var p = Prompt.create();
		p.title = &quot;Choose&quot;;
		p.message = &quot;Pick a phrase to search for&quot;;

		// Parse multiple brackets into separate options for prompt
		for(i=0; i&lt;matches.length; i++) {
			p.addButton(matches[i])
			}

		// Show prompt
		p.show();
		var queryTerm = p.buttonPressed;
		queryTerm = queryTerm.substring(2, queryTerm.length - 2);
		}

	// 2b. If only one set of double brackets, skip prompt
	else if (matches.length == 1) {
		var queryTerm = search.substring(2, search.length - 2);
		}
}

// 3. If no selection and no double brackets, prompt for search term
else if (!sel || sel.length == 0) {
	var p = Prompt.create();
	p.title = &quot;Search&quot;;
	p.message = &quot;Enter your search terms&quot;;
	p.addTextField(&quot;searchTerms&quot;, &quot;Terms&quot;, &quot;&quot;);
	p.addButton(&quot;Search&quot;);
	//p.isCancellable = false;  &lt;-- Kill this too
	p.show();
	
	var queryTerm = p.fieldValues[&quot;searchTerms&quot;];
	}
	
// 4. Should never reach this point BUT lets you know if a scenario was missed
else {
	alert(&quot;Something went wrong. :(&quot;);
	var queryTerm = &quot;&quot;;
}

let queryString = queryTerm;

// Create temporary search workspace
let ws = Workspace.create();
ws.name = workspaceName;
ws.tagFilter = tagFilter;
ws.queryString = queryString;
ws.setInboxSort(&quot;created&quot;, true);
ws.showPreview = false;
ws.showLastAction = false;

app.applyWorkspace(ws);
app.showDraftList();</code></pre></div>
  </li>
</ul>
</div>

<div>
  <h4>Options</h4>
  <ul class="steps">
    <li>
  <table class='action-detail'>
    <tr>
      <td class="cell-label">After Success</td>
      <td class="value">
        Default
        
      </td>
    </tr>
    <tr>
      <td class="cell-label">Notification</td>
      <td class="value">Info</td>
    </tr>
    <tr>
      <td class="cell-label">Log Level</td>
      <td class="value">Info</td>
    </tr>
  </table>
</li>
</ul>
</div>

<div class="disclaimer">
  Items available in the Drafts Directory are uploaded by community members. Use appropriate caution reviewing downloaded items before use.
</div>


                  </div>
                  <div class="footer-content">
                  <p>
                  <a href="https://itunes.apple.com/app/id1236254471?ls=1&mt=8&at=11l4Cf&ct=site">
                    <img alt="Download on App Store" src="../assets/appstore-deaf597bd57239c5054c59099e54ab9014f1e15eddb961085428e0ce94d4385b.svg" />
                  </a>
                  <a href="https://itunes.apple.com/app/id1435957248?mt=12&at=11l4Cf&ct=site">
                    <img alt="Download on Mac App Store" src="../assets/macappstore-05f5eed00e6bb26b68c1368217276158329862682e6d61b3ed193f819fe02f2f.svg" />
                  </a>
                  </p>
                    &copy; 2012-2022 by Agile Tortoise, Inc.<br/>
                    Drafts is a registered Trademark of Agile Tortoise, Inc.<br/>
                    <a href="../../getdrafts.com/support/privacy.html">Privacy</a> | <a href="../../getdrafts.com/support/terms.html">Terms</a>
                </div>
                </div>
            </div>
        </div>
    </div>

  </body>
  </html>
