<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Open Cross-Link at Cursor | Drafts Directory</title>
    <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="Ph/GeeBmSviIe88RAGNilf0ahal+IIuyEG6lxPjM6+8z5Y2k5jQidwLumy6rVFlRldAMI/7J6ZBeID63c/nyYA==" />
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta http-equiv="content-language" content="en">
    <meta http-equiv="content-language" content="en-us">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta property="og:title" content="Drafts Directory: Open Cross-Link at Cursor" />
    <meta property="og:url" content="https://directory.getdrafts.com/a/19S" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="Example actions and other extensions for Drafts, the quick-capture notes app." />
    <meta property="og:image" content="https://directory.getdrafts.com/assets/drafts-ogimage-action-d9c60102fd45e0cb516e1b49ed50a81e3c3a2b90f81f55df8f43d0feb0512978.png" />
    <meta property="twitter:title" content="Drafts Directory: Open Cross-Link at Cursor" />
    <meta property="twitter:url" content="https://directory.getdrafts.com/a/19S" />
    <meta property="twitter:type" content="website" />
    <meta property="twitter:description" content="Example actions and other extensions for Drafts, the quick-capture notes app." />
    <meta property="twitter:image" content="https://directory.getdrafts.com/assets/drafts-ogimage-action-d9c60102fd45e0cb516e1b49ed50a81e3c3a2b90f81f55df8f43d0feb0512978.png" />

    <link rel="shortcut icon" type="image/x-icon" href="../assets/favicon-114dbb66b0ef0399a14fa5dfcad7e6210bb558c30cea665e04d49b59fec87f70.png" />

    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/default.min.css">
    <link rel="stylesheet" media="all" href="../assets/application-6e4f014b4c48cd673942dbfbbeb3e571a732b05562ddde5904f3a5c3833e54ff.css" />
    <script src="../assets/application-13492939cb10be5be76b5abb3e9ae0bef0bbae3202cec2b85cf6fca5bc8429c8.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script async defer data-domain="directory.getdrafts.com" src="https://plausible.io/js/plausible.js"></script>
  </head>

<body data-no-turbolink>

    <div class="page-wrap">
        <div class="side-bar">
            <a href="https://directory.getdrafts.com/index.html" class="site-title fs-6 lh-tight" title="{{ site.title }}">
                <img src="../assets/drafts-directory-header-4d826bd007f515c8e5a10f654e56ad76fbb3bd3103a67ce342283f701f1677fe.svg" alt="Drafts Directory" style="max-height: 30px;" />
            </a>
            <span class="fs-3"><button class="js-main-nav-trigger navigation-list-toggle btn btn-outline" type="button"
                    data-text-toggle="Hide">Menu</button></span>
            <div class="navigation main-nav js-main-nav">
              <ul class="navigation-list">
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://directory.getdrafts.com/index.html">Home</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://directory.getdrafts.com/drafts_actions.html">Actions</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://directory.getdrafts.com/drafts_action_groups.html">Action Groups</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://directory.getdrafts.com/syntax_definitions.html">Syntaxes</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://directory.getdrafts.com/theme_definitions.html">Themes</a>
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://directory.getdrafts.com/workspaces.html">Workspaces</a>
                </li>
                <li class="navigation-list-item">
                  <hr style="margin:1em; padding: 0;" />
                </li>
                <li class="navigation-list-item">
                  <a class="navigation-list-link" href="https://directory.getdrafts.com/search.html">Search</a>
                </li>
                <li class="navigation-list-item">
                  <hr style="margin:1em; padding: 0;" />
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="About Drafts" href="https://directory.getdrafts.com/getdrafts.com/index.html">Get Drafts &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Detailed documentation" href="https://directory.getdrafts.com/docs.getdrafts.com/index.html">User Guide &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Get your questions answered in the forums" href="https://forums.getdrafts.com/">Community &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Online tools and generators" href="https://directory.getdrafts.com/tools.getdrafts.com/index.html">Tools &#x2192;</a>
                </li>
                <li class="navigation-list-item">
                    <a class="navigation-list-link nav-external" title="Scripting library reference" href="https://directory.getdrafts.com/scripting.getdrafts.com/index.html">Script Reference &#x2192;</a>
                </li>
              </ul>
            </div>
            <footer role="contentinfo" class="site-footer">
                <p class="text-small text-grey-dk-000 mb-0">
                    Download: <a href="https://itunes.apple.com/app/id1236254471?ls=1&mt=8&at=11l4Cf&ct=site">iOS</a> | <a href="https://itunes.apple.com/app/id1435957248?mt=12&at=11l4Cf&ct=site">Mac</a>
                </p>
            </footer>
        </div>
        <div class="main-content-wrap js-main-content" tabindex="0">
            <div class="page-header">
                <div class="main-content">
                    <div class="search js-search">
	<div class="search-input-wrap">
<form class="search-form" action="https://directory.getdrafts.com/search.html" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
	<button style='border:none;background-color:transparent;'>
	<svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"
		class="search-icon">
		<title>Search</title>
		<g fill-rule="nonzero">
			<path
				d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z" />
			<path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z" />
		</g>
	</svg>
	</button>
	<input type="text" name="q" id="q" class="js-search-input search-input search" size="12" tabindex="0" placeholder="Search" />
</form>	</div>
</div>
                    <ul class="list-style-none text-small mt-md-1 mb-md-1 pb-4 pb-md-0 js-aux-nav aux-nav">
                        <li class="d-inline-block my-0 mr-2">
                          <a href="https://directory.getdrafts.com/getdrafts.com/index.html">Get Drafts</a>
                        </li>
                        <li class="d-inline-block my-0">
                          <a href="https://forums.getdrafts.com">Community</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="main-content">
                <div id="main-content" class="page-content" role="main">
                  <div class="type">
                    <h4>Action</h4>
                  </div>
                  <div class="header">
                      <h1><img src="https://config.agiletortoise.com/drafts-icons/share-alt.png" class="action-icon" />Open Cross-Link at Cursor</h1>
                  </div>

                  <div class="content">
                    
<div class='caption'>
        Posted by @mattgemmell,
    Last update
    almost 2 years ago
</div>


    <div class='description'>
        <p>Opens the [[cross-link]] at the text cursor position, or within the text selection. Only intended for use with title links. See the various configurable options at the top of the script.</p>

<p>By Matt Gemmell — @mattgemmell — <a href="https://mattgemmell.com/">https://mattgemmell.com/</a></p>

    </div>

<div class="certification">
  
  
</div>

<div style="margin: 2em 0;">
    <a class="btn btn-blue" href="drafts5://action?identifier=19S&amp;data=%7B%22uuid%22:%225BB94C46-9CB7-4484-B07B-01041A8C20BC%22,%22steps%22:[%7B%22platforms%22:3,%22data%22:%7B%22template%22:%22Cross-Linked%20Draft%20Template%22,%22name%22:%22newDraftTemplateName%22%7D,%22type%22:%22defineTemplateTag%22,%22isEnabled%22:true,%22uuid%22:%2203173AD0-FF1E-43B1-A4B9-56F8A6E20113%22%7D,%7B%22platforms%22:3,%22data%22:%7B%22script%22:%22/*%5Cn%5CnDescription:%20Drafts%2020.0%20and%20later%20supports%20cross-linking%20between%20drafts%20using%20the%20double-bracket%20syntax%20[[like%20this]].%20This%20action%20allows%20the%20user%20to%20open%20such%20links%20programmatically%20while%20editing%20a%20draft,%20for%20example%20using%20a%20keyboard%20shortcut,%20making%20it%20convenient%20and%20efficient%20to%20manage%20a%20corpus%20of%20interconnected%20documents%20without%20removing%20their%20hands%20from%20the%20keyboard.%5Cn%5CnFunctionality:%5Cn1.%20Open%20the%20cross-link%20at%20the%20text-editing%20cursor.%5Cn2.%20Optionally%20ask%20before%20creating%20new%20drafts.%5Cn3.%20A%20basic%20template%20system%20is%20supported.%5Cn%5CnAuthor:%20%5Ct%5CtMatt%20Gemmell%5CnTwitter:%20%5Ct@mattgemmell%5Cthttps://twitter.com/mattgemmell%5CnWeb:%20%5Ct%5Ct%5Cthttps://mattgemmell.com/%5Cn%5Cn*/%5Cn%5Cn/*%20===========================%20*/%5Cn//%20Configuration%5Cn/*%20===========================%20*/%5Cn%5Cn%5Cnvar%20chooseBestMatch%20=%20false;%5Cn/*%5CnWhen%20more%20than%20one%20draft%20could%20be%20the%20destination%20of%20a%20link,%20this%20setting%20determines%20what%20happens.%20If%20true,%20the%20best%20match%20(according%20to%20Drafts&#39;%20own%20internal%20logic)%20will%20be%20opened%20without%20user%20intervention.%20If%20false,%20the%20user%20will%20be%20shown%20a%20list%20of%20matching%20drafts%20to%20choose%20from.%5Cn*/%5Cn%5Cn%5Cnvar%20ensureInitialCapitals%20=%20true;%5Cn/*%5CnIf%20true,%20newly-created%20drafts%20will%20have%20their%20title&#39;s%20first%20letter%20made%20uppercase%20if%20necessary.%5Cn*/%5Cn%5Cn%5Cnvar%20askBeforeCreatingNewDrafts%20=%20false;%5Cn/*%5CnIf%20true,%20when%20a%20link&#39;s%20target%20document%20isn&#39;t%20found,%20the%20user%20will%20be%20asked%20before%20a%20new%20draft%20with%20the%20link&#39;s%20title%20is%20created.%20If%20false,%20new%20drafts%20will%20be%20created%20implicitly.%5Cn*/%5Cn%5Cn%5Cnvar%20newDraftTemplateName%20=%20%5C%22%5C%22;%5Cn/*%5CnTitle%20of%20an%20existing%20draft%20which%20will%20be%20used%20as%20a%20template%20when%20creating%20new%20ones.%5CnIf%20the%20template%20is%20not%20found,%20a%20blank%20draft%20will%20be%20created%20with%20the%20appropriate%20title.%5CnUse%20an%20empty%20string%20(%5C%22%5C%22)%20to%20disable%20the%20template%20functionality.%5Cn%5CnNotes:%5Cn%5Ct-%20The%20new%20draft&#39;s%20title%20%E2%80%94%C2%A0i.e.%20the%20template&#39;s%20first%20non-blank%20line%20%E2%80%94%20will%20be%20replaced%20appropriately.%5Cn%5Ct-%20Any%20leading%20hash/pound%20symbols%20(i.e.%20%5C%22%23%5C%22)%20will%20be%20preserved%20when%20setting%20the%20new%20title.%5Cn%5Ct-%20Drafts%20template%20tags%20will%20be%20processed%20(https://docs.getdrafts.com/docs/actions/templates%20).%5Cn%5Ct-%20Some%20custom%20template%20tags%20are%20available:%5Cn%5Ct%5Cn%5Ct%5Ct-%20source_display_title%20is%20the%20display%20title%20of%20the%20source%20draft%20which%20created%20the%20new%20draft.%5Cn%5Ct%5Ct-%20source_uuid%20is%20the%20UUID%20of%20the%20source%20draft%20which%20created%20the%20new%20draft.%5Cn%5Ct%5Ct-%20source_title_link%20is%20a%20preformatted%20[[backlink]]%20to%20the%20source%20draft&#39;s%20display%20title.%5Cn%5Ct%5Ct-%20source_uuid_link%20is%20a%20preformatted%20[[u:backlink]]%20to%20the%20source%20draft&#39;s%20UUID.%5Cn*/%5Cn%5Cn%5Cnvar%20inheritTagsFromTemplate%20=%20true;%5Cn/*%5CnIf%20true,%20any%20tags%20which%20are%20applied%20to%20the%20template%20will%20also%20be%20applied%20to%20each%20new%20draft%20created%20from%20it.%5Cn*/%5Cn%5Cn%5Cnvar%20excludedTags%20=%20[%5C%22template%5C%22];%5Cn/*%5CnThe%20tags%20present%20in%20this%20array%20will%20NOT%20be%20inherited%20by%20new%20drafts%20created%20from%20the%20template.%20Has%20no%20effect%20if%20inheritTagsFromTemplate%20(above)%20is%20false.%5Cn*/%5Cn%5Cn%5Cnvar%20prependToNewTitles%20=%20%5C%22%5C%22;%5Cn/*%5CnA%20string%20to%20prepend%20to%20the%20titles%20of%20new%20pages%20(but%20after%20any%20leading%20Markdown%20headers%20and%20whitespace%20from%20the%20template).%20This%20string%20will%20be%20processed%20for%20Drafts%20template%20tags%20first,%20in%20the%20contetx%20of%20the%20new%20draft.%20A%20useful%20example%20for%20unique%20identifiers%20would%20be:%20%5C%22[[date%7C%25Y%25m%25d%25H%25M%25S]]%20%5C%22%5Cn*/%5Cn%5Cn%5Cn/*%20===========================%20*/%5Cn//%20END%20of%20Configuration%5Cn/*%20===========================%20*/%5Cn%5Cn%5Cn/*%20===========================%20*/%5Cn//%20A%20few%20useful%20functions.%5Cn/*%20===========================%20*/%5Cn%5Cn%5CnString.prototype.splitLines%20=%20function%20()%20%7B%5Cn%5Ct//%20Splits%20string%20into%20lines,%20each%20ending%20with%20a%20newline%20(%5C%5Cn).%5Cn%5Ct//%20Note:%20the%20last%20fragment%20might%20not%20end%20with%20a%20newline.%5Cn%5Ctreturn%20this.match(/[%5E%5C%5Cn]*%5C%5Cn/g);%5Cn%7D;%5Cn%5Cnfunction%20minRange(theRange)%20%7B%5Cn%5Ct//%20Returns%20index%20of%20start%20of%20theRange.%5Cn%5Ctreturn%20theRange[0];%5Cn%7D%5Cn%5Cnfunction%20maxRange(theRange)%20%7B%5Cn%5Ct//%20Returns%20index%20immediately%20AFTER%20end%20of%20theRange.%5Cn%5Ctreturn%20theRange[0]%20+%20theRange[1];%5Cn%7D%5Cn%5CnString.prototype.lastChar%20=%20function%20()%20%7B%5Cn%5Ctreturn%20this.substring(this.length%20-%201,%20this.length);%5Cn%7D;%5Cn%5CnString.prototype.inRange%20=%20function%20(theRange)%20%7B%5Cn%5Ctreturn%20this.substring(theRange[0],%20theRange[0]%20+%20theRange[1]);%5Cn%7D%5Cn%5Cnfunction%20editorTextInRange(editor,%20range)%20%7B%5Cn%5Ct//%20Returns%20editor&#39;s%20text%20in%20the%20given%20range.%5Cn%5Ctreturn%20editor.getTextInRange(range[0],%20range[1]);%5Cn%7D%5Cn%5Cnfunction%20show(title,%20content)%20%7B%5Cn%5Ct//%20Make%20it%20easier%20to%20see%20where%20whitespace/newlines%20are.%5Cn%5Ctalert(title%20+%20%5C%22%5C%5Cn%23%5C%22%20+%20content%20+%20%5C%22%23%5C%22);%5Cn%7D%5Cn%5Cnfunction%20showInRange(title,%20range,%20text)%20%7B%5Cn%5Ctshow(title,%20text.substring(range[0],%20range[0]%20+%20range[1]));%5Cn%7D%5Cn%5Cnfunction%20rangesOverlap(range1,%20range2)%20%7B%5Cn%5Ct//%20You&#39;re%20looking%20at%20this%20and%20thinking%20WTF,%20aren&#39;t%20you?%5Cn%5Ct//%20If%20range1%20and%20range2%20overlap,%20there%20exists%20a%20number%20which%20both%20ranges%20contain.%5Cn%5Ct//%20Logic%20as%20a%20consequence%20of%20De%20Morgan.%20Have%20fun.%5Cn%5Ctreturn%20((minRange(range1)%20%5Cu003c=%20maxRange(range2))%20%5Cu0026%5Cu0026%20(maxRange(range1)%20%5Cu003e=%20minRange(range2)));%5Cn%7D%5Cn%5Cnfunction%20getTitle(theDraft)%20%7B%5Cn%5Ctreturn%20theDraft.displayTitle;%5Cn%7D%5Cn%5Cnfunction%20openDraft(theDraft)%20%7B%5Cn%5Cteditor.load(theDraft);%5Cn%5Cteditor.activate();%5Cn%7D%5Cn%5Cn%5Cn/*%20===========================%20*/%5Cn//%20End%20of%20functions.%5Cn/*%20===========================%20*/%5Cn%5Cn%5Cn//%20Grab%20entire%20line(s)%20of%20text%20which%20contain%20the%20selection.%5Cnvar%20selectedLineRange%20=%20editor.getSelectedLineRange();%5Cnvar%20selectedLines%20=%20editorTextInRange(editor,%20selectedLineRange);%5Cn%5Cn//%20If%20selection%20spans%20more%20than%20one%20line,%20abort.%5Cnvar%20newLineIndex%20=%20selectedLines.indexOf(%5C%22%5C%5Cn%5C%22);%5Cnif%20(newLineIndex%20!==%20-1%20%5Cu0026%5Cu0026%20newLineIndex!==%20selectedLines.length%20-%201)%20%7B%20//%20i.e.%20Just%20a%20trailing%20newline.%5Cn%5Ctapp.displayInfoMessage(%5C%22Doesn&#39;t%20work%20with%20multi-line%20selections.%5C%22);%5Cn%5Ct%5Cn%7D%20else%20%7B%5Cn%5Ctvar%20selRange%20=%20editor.getSelectedRange();%5Cn%5CtselRange[0]%20-=%20selectedLineRange[0];%20//%20Normalise%20to%20be%20line-relative.%5Cn%5Ct%5Cn%5Ct/*%5Cn%5CtMethodology:%5Cn%5Ct1.%20Find%20a%20link%20either%20intersecting%20or%20immediately%20adjacent%20to%20the%20selection/insertion.%5Cn%5Ct2.%20If%20a%20proposed%20link%20title%20is%20identified,%20attempt%20to%20find%20a%20corresponding%20existing%20draft.%5Cn%5Ct3.%20Either%20open%20or%20create%20the%20corresponding%20draft%20as%20appropriate.%5Cn%5Ct*/%5Cn%5Ct%5Cn%5Ct//%20Limit%20the%20amount%20of%20text%20we&#39;re%20searching%20for%20the%20closest%20match%20to%20a%20reasonable%20length.%5Cn%5Ct//%20In%20effect,%20this%20is%20the%20maximum%20length%20of%20link%20that%20we&#39;ll%20notice.%5Cn%5Ctvar%20searchRadius%20=%20250;%20//%20Num%20chars%20around%20selection/insertion%20to%20search.%5Cn%5Ct%5Cn%5Ctvar%20searchRange%20=%20[0,%20selectedLines.length];%20//%20Entire%20line.%5Cn%5Ctif%20(minRange(selRange)%20%5Cu003e%20searchRadius)%20%7B%5Cn%5Ct%5Ct//%20Move%20beginning%20of%20searchRange%20to%20within%20searchRadius%20of%20selRange&#39;s%20start.%5Cn%5Ct%5CtsearchRange[0]%20=%20minRange(selRange)%20-%20searchRadius;%5Cn%5Ct%5CtsearchRange[1]%20-=%20searchRange[0];%5Cn%5Ct%7D%5Cn%5Ctif%20((maxRange(selRange)%20+%20searchRadius)%20%5Cu003c%20maxRange(searchRange))%20%7B%5Cn%5Ct%5Ct//%20Move%20end%20of%20searchRange%20to%20within%20searchRadius%20of%20selRange&#39;s%20end.%5Cn%5Ct%5CtsearchRange[1]%20=%20maxRange(searchRange)%20+%20searchRadius;%5Cn%5Ct%7D%5Cn%5Ctvar%20searchText%20=%20selectedLines.substring(minRange(searchRange),%20maxRange(searchRange));%5Cn%5Ct%5Cn%5Ct//%20Find%20links%20within%20searchText.%5Cn%5Ct/*%5Cn%5Ct1.%20We%20ignore%20links%20which%20are%20not%20either%20adjacent%20to%20the%20selection%20or%20overlapping%20it.%5Cn%5Ct2.%20We%20prefer%20links%20which%20intersect%20the%20selection,%20as%20an%20indicator%20of%20user%20intent.%5Cn%5Ct3.%20For%20non-intersecting%20(i.e.%20adjacent)%20links,%20we%20prefer%20those%20behind/before%20the%20selection.%5Cn%5Ct4.%20We%20prefer%20the%20first%20link%20of%20multiple%20candidates,%20notwithstanding%20point%202.%5Cn%5Ct*/%5Cn%5Ct%5Cn%5Ctvar%20openingDelimiter%20=%20&#39;%5C%5C%5C%5C[%5C%5C%5C%5C[&#39;;%5Cn%5Ctvar%20closingDelimiter%20=%20&#39;%5C%5C%5C%5C]%5C%5C%5C%5C]&#39;;%5Cn%5Ctvar%20crossLinksPattern%20=%20openingDelimiter%20+%20&#39;(?:d:)?(.+?)&#39;%20+%20closingDelimiter;%5Cn%5Ctvar%20linksRegExp%20=%20new%20RegExp(crossLinksPattern,%20%5C%22g%5C%22);%5Cn%5Ctvar%20abortSearch%20=%20false;%5Cn%5Ctvar%20linkTitle%20=%20null;%5Cn%5Ctvar%20linkRange%20=%20null;%5Cn%5Ctvar%20match;%5Cn%5Ctdo%20%7B%5Cn%5Ct%5Ctmatch%20=%20linksRegExp.exec(searchText);%5Cn%5Ct%5Ctif%20(match)%20%7B%5Cn%5Ct%5Ct%5Ctvar%20matchRange%20=%20[match.index,%20match[0].length];%5Cn%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct//%20We&#39;ll%20abort%20searching%20in%20three%20situations:%5Cn%5Ct%5Ct%5Ct//%201.%20We%20find%20a%20link%20intersecting%20the%20selection.%5Cn%5Ct%5Ct%5Ct//%202.%20We%20find%20a%20second%20(and%20thus%20later,%20less%20preferable)%20non-intersecting%20link.%5Cn%5Ct%5Ct%5Ct//%203.%20Our%20search%20has%20already%20moved%20beyond%20the%20selection.%5Cn%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ctif%20(rangesOverlap(matchRange,%20selRange))%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct//%20Selection%20and%20match%20ranges%20overlap.%5Cn%5Ct%5Ct%5Ct%5CtabortSearch%20=%20true;%5Cn%5Ct%5Ct%5Ct%5CtlinkTitle%20=%20match[1];%5Cn%5Ct%5Ct%5Ct%5CtlinkRange%20=%20matchRange;%5Cn%5Ct%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%7D%20else%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct//%20Determine%20distance%20of%20matchRange%20from%20selRange.%5Cn%5Ct%5Ct%5Ct%5Ct//%20For%20non-overlapping%20ranges,%20we%20define%20this%20as%20the%20clear%20interval%20between%20them.%5Cn%5Ct%5Ct%5Ct%5Ct//%20As%20noted,%20we&#39;ll%20discard%20candidates%20whose%20distance%20is%20%5Cu003e0%20(i.e.%20non-adjacent).%5Cn%5Ct%5Ct%5Ct%5Ctvar%20distance%20=%201;%5Cn%5Ct%5Ct%5Ct%5Ctif%20(minRange(matchRange)%20%5Cu003e%20minRange(selRange))%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct//%20Match%20is%20before%20selection.%5Cn%5Ct%5Ct%5Ct%5Ct%5Ctdistance%20=%20minRange(selRange)%20-%20maxRange(matchRange);%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%5Ct%7D%20else%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct//%20Match%20is%20after%20selection.%5Cn%5Ct%5Ct%5Ct%5Ct%5Ctdistance%20=%20minRange(matchRange)%20-%20maxRange(selRange);%5Cn%5Ct%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%5Ctif%20(distance%20==%200)%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct//%20This%20is%20a%20candidate.%5Cn%5Ct%5Ct%5Ct%5Ct%5Ctif%20(linkTitle%20!=%20null)%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct//%20This%20is%20the%20second%20non-intersecting%20link%20we&#39;ve%20found,%20so%20abort%20search.%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct//%20(Since%20we%20insist%20on%20adjacent%20links,%20if%20we&#39;ve%20found%20two,%20we&#39;re%20already%20past%20the%20selection.)%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5CtabortSearch%20=%20true;%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%7D%20else%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct//%20This%20is%20the%20first%20non-intersecting%20link%20we&#39;ve%20found.%20Make%20it%20our%20fallback%20candidate.%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct//%20Keep%20searching,%20in%20case%20we&#39;re%20before%20the%20selection%20and%20there&#39;s%20an%20intersecting%20link%20later.%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5CtlinkTitle%20=%20match[1];%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5CtlinkRange%20=%20matchRange;%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct//%20Finally,%20we%20can%20abort%20searching%20if%20we&#39;re%20already%20past%20the%20selection.%5Cn%5Ct%5Ct%5Ct%5Ct%5Ctif%20(minRange(matchRange)%20%5Cu003e=%20maxRange(selRange))%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5CtabortSearch%20=%20true;%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%7D%5Cn%5Ct%7D%20while%20(match%20%5Cu0026%5Cu0026%20!abortSearch);%5Cn%5Ct%5Cn%5Ctif%20(linkTitle)%20%7B%5Cn%5Ct%5Ct//%20Try%20to%20find%20a%20draft%20with%20a%20matching%20title.%5Cn%5Ct%5CtlinkTitle%20=%20linkTitle.trim();%5Cn%5Ct%5Ctvar%20draftToOpen%20=%20null;%5Cn%5Ct%5Ctvar%20foundDrafts%20=%20Draft.queryByTitle(linkTitle);%5Cn%5Ct%5Ctif%20(foundDrafts.length%20%5Cu003e%200)%20%7B%5Cn%5Ct%5Ct%5Ct//%20We%20found%20at%20least%20one%20match.%5Cn%5Ct%5Ct%5Ctif%20(foundDrafts.length%20==%201%20%7C%7C%20chooseBestMatch)%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct//%20Open%20the%20first/only%20match.%5Cn%5Ct%5Ct%5Ct%5CtdraftToOpen%20=%20foundDrafts[0];%5Cn%5Ct%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%7D%20else%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct//%20Choose%20one%20of%20the%20matching%20drafts.%5Cn%5Ct%5Ct%5Ct%5Ctvar%20draftTitles%20=%20foundDrafts.map(getTitle);%5Cn%5Ct%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%5Ctvar%20prompt%20=%20Prompt.create();%5Cn%5Ct%5Ct%5Ct%5Ctprompt.isCancellable%20=%20true;%5Cn%5Ct%5Ct%5Ct%5Ctprompt.title%20=%20%5C%22Open%20which%20draft?%5C%22;%5Cn%5Ct%5Ct%5Ct%5Ctprompt.addButton(%5C%22Open%5C%22);%5Cn%5Ct%5Ct%5Ct%5Ctprompt.addSelect(%5C%22select%5C%22,%20%5C%22%5C%22,%20draftTitles,%20[draftTitles[0]],%20false);%5Cn%5Ct%5Ct%5Ct%5Ctvar%20didSelect%20=%20prompt.show();%5Cn%5Ct%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%5Ctvar%20chosenDraftTitle%20=%20prompt.fieldValues[%5C%22select%5C%22][0];%5Cn%5Ct%5Ct%5Ct%5Ctif%20(didSelect)%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct%5Ctvar%20draftIndex%20=%20draftTitles.indexOf(chosenDraftTitle);%5Cn%5Ct%5Ct%5Ct%5Ct%5CtdraftToOpen%20=%20foundDrafts[draftIndex];%5Cn%5Ct%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ctif%20(draftToOpen%20!=%20null)%20%7B%5Cn%5Ct%5Ct%5Ct%5CtopenDraft(draftToOpen);%5Cn%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%7D%20else%20%7B%5Cn%5Ct%5Ct%5Ct//%20We%20have%20to%20create%20a%20new%20draft.%5Cn%5Ct%5Ct%5Ctvar%20createDraft%20=%20true;%5Cn%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct//%20Deal%20with%20initial%20capitals.%5Cn%5Ct%5Ct%5Ctif%20(ensureInitialCapitals)%20%7B%5Cn%5Ct%5Ct%5Ct%5CtlinkTitle%20=%20linkTitle.charAt(0).toUpperCase()%20+%20linkTitle.slice(1);%5Cn%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct//%20Check%20whether%20to%20ask%20the%20user&#39;s%20permission%20first.%5Cn%5Ct%5Ct%5Ctif%20(askBeforeCreatingNewDrafts)%20%7B%5Cn%5Ct%5Ct%5Ct%5Ctvar%20prompt%20=%20Prompt.create();%5Cn%5Ct%5Ct%5Ct%5Ctprompt.isCancellable%20=%20true;%5Cn%5Ct%5Ct%5Ct%5Ctprompt.title%20=%20%5C%22Create%20new%20draft?%5C%22;%5Cn%5Ct%5Ct%5Ct%5Ctprompt.addLabel(%5C%22draftTitle%5C%22,%20%5C%22%E2%80%9C%5C%22%20+%20linkTitle%20+%20%5C%22%E2%80%9D%5C%22,%20%7B%5C%22textSize%5C%22:%20%5C%22headline%5C%22%7D);%5Cn%5Ct%5Ct%5Ct%5Ctprompt.addButton(%5C%22Create%5C%22);%5Cn%5Ct%5Ct%5Ct%5CtcreateDraft%20=%20prompt.show();%5Cn%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ctif%20(createDraft)%20%7B%5Cn%5Ct%5Ct%5Ct%5CtdraftToOpen%20=%20new%20Draft();%5Cn%5Ct%5Cn%5Ct%5Ct%5Ct%5Ct//%20Deal%20with%20prepended%20title%20string,%20if%20set.%5Cn%5Ct%5Ct%5Ct%5Ctif%20(prependToNewTitles.length%20%5Cu003e%200)%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct%5CtlinkTitle%20=%20draftToOpen.processTemplate(prependToNewTitles)%20+%20linkTitle;%5Cn%5Ct%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%5CtdraftToOpen.content%20=%20%5C%22%23%20%5C%22%20+%20linkTitle%20+%20%5C%22%5C%5Cn%5C%5Cn%5C%22;%5Cn%5Ct%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%5Ct//%20Handle%20template%20requirements.%5Cn%5Ct%5Ct%5Ct%5Ctif%20(newDraftTemplateName%20==%20null%20%7C%7C%20newDraftTemplateName%20==%20%5C%22%5C%22)%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct%5CtnewDraftTemplateName%20=%20draft.getTemplateTag(%5C%22newDraftTemplateName%5C%22);%5Cn%5Ct%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%5Ctif%20(newDraftTemplateName%20!=%20null%20%5Cu0026%5Cu0026%20newDraftTemplateName%20!=%20%5C%22%5C%22)%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct//%20Attempt%20to%20locate%20template.%5Cn%5Ct%5Ct%5Ct%5Ct%5Ctvar%20foundTemplates%20=%20Draft.queryByTitle(newDraftTemplateName);%5Cn%5Ct%5Ct%5Ct%5Ct%5Ctif%20(foundTemplates.length%20%5Cu003e%200)%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ctvar%20template%20=%20foundTemplates[0];%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ctvar%20templateContent%20=%20template.content;%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct//%20Replace%20title%20appropriately.%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5CttemplateContent%20=%20templateContent.replace(template.displayTitle,%20linkTitle);%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct//%20Process%20template%20tags.%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5CtdraftToOpen.setTemplateTag(%5C%22source_display_title%5C%22,%20draft.displayTitle);%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5CtdraftToOpen.setTemplateTag(%5C%22source_uuid%5C%22,%20draft.uuid);%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5CtdraftToOpen.setTemplateTag(%5C%22source_title_link%5C%22,%20%5C%22%5C%5C[[%5C%22%20+%20draft.displayTitle%20+%20%5C%22]]%5C%22);%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5CtdraftToOpen.setTemplateTag(%5C%22source_uuid_link%5C%22,%20%5C%22%5C%5C[[u:%5C%22%20+%20draft.uuid%20+%20%5C%22]]%5C%22);%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5CttemplateContent%20=%20draftToOpen.processTemplate(templateContent);%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct//%20Transfer%20tags%20if%20appropriate.%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ctif%20(inheritTagsFromTemplate)%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct%5Ctfor%20(tag%20of%20template.tags)%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct%5Ctif%20(!excludedTags.includes(tag))%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct%5CtdraftToOpen.addTag(tag);%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct//%20Apply%20contents%20to%20our%20new%20draft.%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5CtdraftToOpen.content%20=%20templateContent;%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%7D%20else%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%5Ctapp.displayInfoMessage(%5C%22Couldn&#39;t%20find%20new%20draft%20template.%5C%22);%5Cn%5Ct%5Ct%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%5Ct//%20Open%20draft.%5Ct%5Ct%5Ct%5Cn%5Ct%5Ct%5Ct%5Ctif%20(draftToOpen%20!=%20null)%20%7B%5Cn%5Ct%5Ct%5Ct%5Ct%5CtdraftToOpen.update();%5Cn%5Ct%5Ct%5Ct%5Ct%5CtopenDraft(draftToOpen);%5Cn%5Ct%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%5Ct%7D%5Cn%5Ct%5Ct%7D%5Cn%5Ct%5Ct%5Cn%5Ct%7D%20else%20%7B%5Cn%5Ct%5Ctapp.displayInfoMessage(%5C%22No%20cross-link%20at%20cursor%20position.%5C%22);%5Cn%5Ct%7D%5Cn%7D%5Cn%5Cn/*%5Cn%5CnTest%20test%20[[test%20[and]%20stuff]].%20Can%20also%20do%20[single]%20words%20[[linked]]%20too.%20More%20[[d:tests%20and%20things]].%5CnLink%20to%20a%20[[sample%20document]]%20for%20testing.%5Cn%5Cn*/%22,%22allowAsync%22:%22false%22%7D,%22type%22:%22script%22,%22isEnabled%22:true,%22uuid%22:%22AC150D1C-DCF8-4359-9F1D-F58798453C3C%22%7D],%22backingPlatforms%22:3,%22shortName%22:%22Open%20Cross-Link%22,%22shouldConfirm%22:false,%22disposition%22:0,%22keyCommand%22:%7B%22optionKey%22:true,%22input%22:%22L%22,%22controlKey%22:true,%22commandKey%22:true,%22type%22:%22action%22,%22discoverabilityTitle%22:%22Open%20Cross-Link%20at%20Cursor%22,%22shiftKey%22:false%7D,%22logLevel%22:1,%22groupDisposition%22:0,%22notificationType%22:1,%22tintColor%22:%22none%22,%22actionDescription%22:%22Opens%20the%20[[cross-link]]%20at%20the%20text%20cursor%20position,%20or%20within%20the%20text%20selection.%20Only%20intended%20for%20use%20with%20title%20links.%20A%20template%20system%20is%20supported.%20See%20the%20various%20configurable%20options%20at%20the%20top%20of%20the%20script.%20Requires%20Drafts%2020.1%20or%20later.%5Cn%5CnBy%20Matt%20Gemmell%20%E2%80%94%20@mattgemmell%20%E2%80%94%20https://mattgemmell.com/%22,%22keyUseIcon%22:true,%22icon%22:%22share-alt%22,%22visibility%22:480,%22backingIsSeparator%22:false,%22groupUUID%22:%2239E2821B-F7CA-4A6E-AA47-33C485EF250A%22,%22assignTags%22:[],%22name%22:%22Open%20Cross-Link%20at%20Cursor%22%7D">Install</a>
</div>

<div>
  <h4>Steps</h4>
<ul class='steps'>
  <li>
    <div class='step'><h3>defineTemplateTag</h3><table class='action-detail'><tr><td class='cell-label'>name</td><td class='value'><pre>newDraftTemplateName</pre></td></tr><tr><td class='cell-label'>template</td><td class='value'><pre>Cross-Linked Draft Template</pre></td></tr></table></div>
  </li>
  <li>
    <div class='step'><h3>script</h3><pre><code class='language-javascript'>/*

Description: Drafts 20.0 and later supports cross-linking between drafts using the double-bracket syntax [[like this]]. This action allows the user to open such links programmatically while editing a draft, for example using a keyboard shortcut, making it convenient and efficient to manage a corpus of interconnected documents without removing their hands from the keyboard.

Functionality:
1. Open the cross-link at the text-editing cursor.
2. Optionally ask before creating new drafts.
3. A basic template system is supported.

Author: 		Matt Gemmell
Twitter: 	@mattgemmell	https://twitter.com/mattgemmell
Web: 			https://mattgemmell.com/

*/

/* =========================== */
// Configuration
/* =========================== */


var chooseBestMatch = false;
/*
When more than one draft could be the destination of a link, this setting determines what happens. If true, the best match (according to Drafts&#39; own internal logic) will be opened without user intervention. If false, the user will be shown a list of matching drafts to choose from.
*/


var ensureInitialCapitals = true;
/*
If true, newly-created drafts will have their title&#39;s first letter made uppercase if necessary.
*/


var askBeforeCreatingNewDrafts = false;
/*
If true, when a link&#39;s target document isn&#39;t found, the user will be asked before a new draft with the link&#39;s title is created. If false, new drafts will be created implicitly.
*/


var newDraftTemplateName = &quot;&quot;;
/*
Title of an existing draft which will be used as a template when creating new ones.
If the template is not found, a blank draft will be created with the appropriate title.
Use an empty string (&quot;&quot;) to disable the template functionality.

Notes:
	- The new draft&#39;s title — i.e. the template&#39;s first non-blank line — will be replaced appropriately.
	- Any leading hash/pound symbols (i.e. &quot;#&quot;) will be preserved when setting the new title.
	- Drafts template tags will be processed (https://docs.getdrafts.com/docs/actions/templates ).
	- Some custom template tags are available:
	
		- source_display_title is the display title of the source draft which created the new draft.
		- source_uuid is the UUID of the source draft which created the new draft.
		- source_title_link is a preformatted [[backlink]] to the source draft&#39;s display title.
		- source_uuid_link is a preformatted [[u:backlink]] to the source draft&#39;s UUID.
*/


var inheritTagsFromTemplate = true;
/*
If true, any tags which are applied to the template will also be applied to each new draft created from it.
*/


var excludedTags = [&quot;template&quot;];
/*
The tags present in this array will NOT be inherited by new drafts created from the template. Has no effect if inheritTagsFromTemplate (above) is false.
*/


var prependToNewTitles = &quot;&quot;;
/*
A string to prepend to the titles of new pages (but after any leading Markdown headers and whitespace from the template). This string will be processed for Drafts template tags first, in the contetx of the new draft. A useful example for unique identifiers would be: &quot;[[date|%Y%m%d%H%M%S]] &quot;
*/


/* =========================== */
// END of Configuration
/* =========================== */


/* =========================== */
// A few useful functions.
/* =========================== */


String.prototype.splitLines = function () {
	// Splits string into lines, each ending with a newline (\n).
	// Note: the last fragment might not end with a newline.
	return this.match(/[^\n]*\n/g);
};

function minRange(theRange) {
	// Returns index of start of theRange.
	return theRange[0];
}

function maxRange(theRange) {
	// Returns index immediately AFTER end of theRange.
	return theRange[0] + theRange[1];
}

String.prototype.lastChar = function () {
	return this.substring(this.length - 1, this.length);
};

String.prototype.inRange = function (theRange) {
	return this.substring(theRange[0], theRange[0] + theRange[1]);
}

function editorTextInRange(editor, range) {
	// Returns editor&#39;s text in the given range.
	return editor.getTextInRange(range[0], range[1]);
}

function show(title, content) {
	// Make it easier to see where whitespace/newlines are.
	alert(title + &quot;\n#&quot; + content + &quot;#&quot;);
}

function showInRange(title, range, text) {
	show(title, text.substring(range[0], range[0] + range[1]));
}

function rangesOverlap(range1, range2) {
	// You&#39;re looking at this and thinking WTF, aren&#39;t you?
	// If range1 and range2 overlap, there exists a number which both ranges contain.
	// Logic as a consequence of De Morgan. Have fun.
	return ((minRange(range1) &lt;= maxRange(range2)) &amp;&amp; (maxRange(range1) &gt;= minRange(range2)));
}

function getTitle(theDraft) {
	return theDraft.displayTitle;
}

function openDraft(theDraft) {
	editor.load(theDraft);
	editor.activate();
}


/* =========================== */
// End of functions.
/* =========================== */


// Grab entire line(s) of text which contain the selection.
var selectedLineRange = editor.getSelectedLineRange();
var selectedLines = editorTextInRange(editor, selectedLineRange);

// If selection spans more than one line, abort.
var newLineIndex = selectedLines.indexOf(&quot;\n&quot;);
if (newLineIndex !== -1 &amp;&amp; newLineIndex!== selectedLines.length - 1) { // i.e. Just a trailing newline.
	app.displayInfoMessage(&quot;Doesn&#39;t work with multi-line selections.&quot;);
	
} else {
	var selRange = editor.getSelectedRange();
	selRange[0] -= selectedLineRange[0]; // Normalise to be line-relative.
	
	/*
	Methodology:
	1. Find a link either intersecting or immediately adjacent to the selection/insertion.
	2. If a proposed link title is identified, attempt to find a corresponding existing draft.
	3. Either open or create the corresponding draft as appropriate.
	*/
	
	// Limit the amount of text we&#39;re searching for the closest match to a reasonable length.
	// In effect, this is the maximum length of link that we&#39;ll notice.
	var searchRadius = 250; // Num chars around selection/insertion to search.
	
	var searchRange = [0, selectedLines.length]; // Entire line.
	if (minRange(selRange) &gt; searchRadius) {
		// Move beginning of searchRange to within searchRadius of selRange&#39;s start.
		searchRange[0] = minRange(selRange) - searchRadius;
		searchRange[1] -= searchRange[0];
	}
	if ((maxRange(selRange) + searchRadius) &lt; maxRange(searchRange)) {
		// Move end of searchRange to within searchRadius of selRange&#39;s end.
		searchRange[1] = maxRange(searchRange) + searchRadius;
	}
	var searchText = selectedLines.substring(minRange(searchRange), maxRange(searchRange));
	
	// Find links within searchText.
	/*
	1. We ignore links which are not either adjacent to the selection or overlapping it.
	2. We prefer links which intersect the selection, as an indicator of user intent.
	3. For non-intersecting (i.e. adjacent) links, we prefer those behind/before the selection.
	4. We prefer the first link of multiple candidates, notwithstanding point 2.
	*/
	
	var openingDelimiter = &#39;\\[\\[&#39;;
	var closingDelimiter = &#39;\\]\\]&#39;;
	var crossLinksPattern = openingDelimiter + &#39;(?:d:)?(.+?)&#39; + closingDelimiter;
	var linksRegExp = new RegExp(crossLinksPattern, &quot;g&quot;);
	var abortSearch = false;
	var linkTitle = null;
	var linkRange = null;
	var match;
	do {
		match = linksRegExp.exec(searchText);
		if (match) {
			var matchRange = [match.index, match[0].length];
			
			// We&#39;ll abort searching in three situations:
			// 1. We find a link intersecting the selection.
			// 2. We find a second (and thus later, less preferable) non-intersecting link.
			// 3. Our search has already moved beyond the selection.
			
			if (rangesOverlap(matchRange, selRange)) {
				// Selection and match ranges overlap.
				abortSearch = true;
				linkTitle = match[1];
				linkRange = matchRange;
				
			} else {
				// Determine distance of matchRange from selRange.
				// For non-overlapping ranges, we define this as the clear interval between them.
				// As noted, we&#39;ll discard candidates whose distance is &gt;0 (i.e. non-adjacent).
				var distance = 1;
				if (minRange(matchRange) &gt; minRange(selRange)) {
					// Match is before selection.
					distance = minRange(selRange) - maxRange(matchRange);
					
				} else {
					// Match is after selection.
					distance = minRange(matchRange) - maxRange(selRange);
				}
				
				if (distance == 0) {
					// This is a candidate.
					if (linkTitle != null) {
						// This is the second non-intersecting link we&#39;ve found, so abort search.
						// (Since we insist on adjacent links, if we&#39;ve found two, we&#39;re already past the selection.)
						abortSearch = true;
						
					} else {
						// This is the first non-intersecting link we&#39;ve found. Make it our fallback candidate.
						// Keep searching, in case we&#39;re before the selection and there&#39;s an intersecting link later.
						linkTitle = match[1];
						linkRange = matchRange;
					}
					
					// Finally, we can abort searching if we&#39;re already past the selection.
					if (minRange(matchRange) &gt;= maxRange(selRange)) {
						abortSearch = true;
					}
				}
			}
		}
	} while (match &amp;&amp; !abortSearch);
	
	if (linkTitle) {
		// Try to find a draft with a matching title.
		linkTitle = linkTitle.trim();
		var draftToOpen = null;
		var foundDrafts = Draft.queryByTitle(linkTitle);
		if (foundDrafts.length &gt; 0) {
			// We found at least one match.
			if (foundDrafts.length == 1 || chooseBestMatch) {
				// Open the first/only match.
				draftToOpen = foundDrafts[0];
				
			} else {
				// Choose one of the matching drafts.
				var draftTitles = foundDrafts.map(getTitle);
				
				var prompt = Prompt.create();
				prompt.isCancellable = true;
				prompt.title = &quot;Open which draft?&quot;;
				prompt.addButton(&quot;Open&quot;);
				prompt.addSelect(&quot;select&quot;, &quot;&quot;, draftTitles, [draftTitles[0]], false);
				var didSelect = prompt.show();
				
				var chosenDraftTitle = prompt.fieldValues[&quot;select&quot;][0];
				if (didSelect) {
					var draftIndex = draftTitles.indexOf(chosenDraftTitle);
					draftToOpen = foundDrafts[draftIndex];
				}
			}
			
			if (draftToOpen != null) {
				openDraft(draftToOpen);
			}
			
		} else {
			// We have to create a new draft.
			var createDraft = true;
			
			// Deal with initial capitals.
			if (ensureInitialCapitals) {
				linkTitle = linkTitle.charAt(0).toUpperCase() + linkTitle.slice(1);
			}
			
			// Check whether to ask the user&#39;s permission first.
			if (askBeforeCreatingNewDrafts) {
				var prompt = Prompt.create();
				prompt.isCancellable = true;
				prompt.title = &quot;Create new draft?&quot;;
				prompt.addLabel(&quot;draftTitle&quot;, &quot;“&quot; + linkTitle + &quot;”&quot;, {&quot;textSize&quot;: &quot;headline&quot;});
				prompt.addButton(&quot;Create&quot;);
				createDraft = prompt.show();
			}
			
			if (createDraft) {
				draftToOpen = new Draft();
	
				// Deal with prepended title string, if set.
				if (prependToNewTitles.length &gt; 0) {
					linkTitle = draftToOpen.processTemplate(prependToNewTitles) + linkTitle;
				}
				
				draftToOpen.content = &quot;# &quot; + linkTitle + &quot;\n\n&quot;;
				
				// Handle template requirements.
				if (newDraftTemplateName == null || newDraftTemplateName == &quot;&quot;) {
					newDraftTemplateName = draft.getTemplateTag(&quot;newDraftTemplateName&quot;);
				}
				
				if (newDraftTemplateName != null &amp;&amp; newDraftTemplateName != &quot;&quot;) {
					// Attempt to locate template.
					var foundTemplates = Draft.queryByTitle(newDraftTemplateName);
					if (foundTemplates.length &gt; 0) {
						var template = foundTemplates[0];
						var templateContent = template.content;
						
						// Replace title appropriately.
						templateContent = templateContent.replace(template.displayTitle, linkTitle);
						
						// Process template tags.
						draftToOpen.setTemplateTag(&quot;source_display_title&quot;, draft.displayTitle);
						draftToOpen.setTemplateTag(&quot;source_uuid&quot;, draft.uuid);
						draftToOpen.setTemplateTag(&quot;source_title_link&quot;, &quot;\[[&quot; + draft.displayTitle + &quot;]]&quot;);
						draftToOpen.setTemplateTag(&quot;source_uuid_link&quot;, &quot;\[[u:&quot; + draft.uuid + &quot;]]&quot;);
						templateContent = draftToOpen.processTemplate(templateContent);
						
						// Transfer tags if appropriate.
						if (inheritTagsFromTemplate) {
							for (tag of template.tags) {
								if (!excludedTags.includes(tag)) {
									draftToOpen.addTag(tag);
								}
							}
						}
						
						// Apply contents to our new draft.
						draftToOpen.content = templateContent;
						
					} else {
						app.displayInfoMessage(&quot;Couldn&#39;t find new draft template.&quot;);
					}
				}
				
				// Open draft.			
				if (draftToOpen != null) {
					draftToOpen.update();
					openDraft(draftToOpen);
				}
			}
		}
		
	} else {
		app.displayInfoMessage(&quot;No cross-link at cursor position.&quot;);
	}
}

/*

Test test [[test [and] stuff]]. Can also do [single] words [[linked]] too. More [[d:tests and things]].
Link to a [[sample document]] for testing.

*/</code></pre></div>
  </li>
</ul>
</div>

<div>
  <h4>Options</h4>
  <ul class="steps">
    <li>
  <table class='action-detail'>
    <tr>
      <td class="cell-label">After Success</td>
      <td class="value">
        Nothing
        
      </td>
    </tr>
    <tr>
      <td class="cell-label">Notification</td>
      <td class="value">Error</td>
    </tr>
    <tr>
      <td class="cell-label">Log Level</td>
      <td class="value">Error</td>
    </tr>
  </table>
</li>
</ul>
</div>

<div class="disclaimer">
  Items available in the Drafts Directory are uploaded by community members. Use appropriate caution reviewing downloaded items before use.
</div>


                  </div>
                  <div class="footer-content">
                  <p>
                  <a href="https://itunes.apple.com/app/id1236254471?ls=1&mt=8&at=11l4Cf&ct=site">
                    <img alt="Download on App Store" src="../assets/appstore-deaf597bd57239c5054c59099e54ab9014f1e15eddb961085428e0ce94d4385b.svg" />
                  </a>
                  <a href="https://itunes.apple.com/app/id1435957248?mt=12&at=11l4Cf&ct=site">
                    <img alt="Download on Mac App Store" src="../assets/macappstore-05f5eed00e6bb26b68c1368217276158329862682e6d61b3ed193f819fe02f2f.svg" />
                  </a>
                  </p>
                    &copy; 2012-2022 by Agile Tortoise, Inc.<br/>
                    Drafts is a registered Trademark of Agile Tortoise, Inc.<br/>
                    <a href="https://directory.getdrafts.com/getdrafts.com/support/privacy.html">Privacy</a> | <a href="https://directory.getdrafts.com/getdrafts.com/support/terms.html">Terms</a>
                </div>
                </div>
            </div>
        </div>
    </div>

  </body>
  </html>
